var StarRating=function(){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function s(e,t,s){return t&&n(e.prototype,t),s&&n(e,s),e}var r={classNames:{active:"gl-active",base:"gl-star-rating",selected:"gl-selected"},clearable:!0,maxStars:10,prebuilt:!1,stars:null,tooltip:"Select a Rating"},i=function(t,n,s){t.classList[n?"add":"remove"](s)},a=function(t){var s,n=document.createElement("span");t=t||{};for(s in t)n.setAttribute(s,t[s]);return n},l=function(t,n,s){return/^\d+$/.test(t)&&n<=t&&t<=s},t=function(t,n,s){var o=a(s);return t.parentNode.insertBefore(o,n?t.nextSibling:t),o},c=function t(){for(var n,i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return n={},o.forEach(function(s){Object.keys(s||{}).forEach(function(i){if(o[0][i]===void 0)return;var a=s[i];if(e(a)==="Object"&&e(n[i])==="Object"){n[i]=t(n[i],a);return}n[i]=a})}),n},e=function(t){return{}.toString.call(t).slice(8,-1)},d=function e(t){var e=[];return[].forEach.call(t.options,function(t){var n=parseInt(t.value,10)||0;n>0&&e.push({index:t.index,text:t.text,value:n})}),e.sort(function(e,t){return e.value-t.value})},u=function(){function e(t,n){o(this,e),this.direction=window.getComputedStyle(t,null).getPropertyValue("direction"),this.el=t,this.events={change:this.onChange.bind(this),keydown:this.onKeyDown.bind(this),mousedown:this.onPointerDown.bind(this),mouseleave:this.onPointerLeave.bind(this),mousemove:this.onPointerMove.bind(this),reset:this.onReset.bind(this),touchend:this.onPointerDown.bind(this),touchmove:this.onPointerMove.bind(this)},this.indexActive=null,this.indexSelected=null,this.props=n,this.tick=null,this.ticking=!1,this.values=d(t),this.widgetEl=null,this.el.widget&&this.el.widget.destroy(),l(this.values.length,1,this.props.maxStars)?this.build():this.destroy()}return s(e,[{key:"build",value:function(){this.destroy(),this.buildWidget(),this.selectValue(this.indexSelected=this.selected(),!1),this.handleEvents("add"),this.el.widget=this}},{key:"buildWidget",value:function(){var n,s,o=this;this.props.prebuilt?(n=this.el.parentNode,s=n.querySelector("."+this.props.classNames.base+"--stars")):(n=t(this.el,!1,{class:this.props.classNames.base}),n.appendChild(this.el),s=t(this.el,!0,{class:this.props.classNames.base+"--stars"}),this.values.forEach(function(e,t){var n=a({"data-index":t,"data-value":e.value});"function"==typeof o.props.stars&&o.props.stars.call(o,n,e,t),[].forEach.call(n.children,function(e){return e.style.pointerEvents="none"}),s.innerHTML+=n.outerHTML})),n.dataset.starRating="",n.classList.add(this.props.classNames.base+"--"+this.direction),this.props.tooltip&&s.setAttribute("role","tooltip"),this.widgetEl=s}},{key:"changeIndexTo",value:function(t,n){var o,a,s=this;(this.indexActive!==t||n)&&([].forEach.call(this.widgetEl.children,function(e,n){i(e,n<=t,s.props.classNames.active),i(e,n===s.indexSelected,s.props.classNames.selected)}),this.widgetEl.setAttribute("data-rating",t+1),"function"!=typeof this.props.stars&&!this.props.prebuilt&&(this.widgetEl.classList.remove("s"+10*(this.indexActive+1)),this.widgetEl.classList.add("s"+10*(t+1))),this.props.tooltip&&(a=t<0?this.props.tooltip:(o=this.values[t])===null||o===void 0?void 0:o.text,this.widgetEl.setAttribute("aria-label",a)),this.indexActive=t),this.ticking=!1}},{key:"destroy",value:function(){this.indexActive=null,this.indexSelected=this.selected();var t=this.el.parentNode;t.classList.contains(this.props.classNames.base)&&(this.props.prebuilt?(this.widgetEl=t.querySelector("."+this.props.classNames.base+"--stars"),t.classList.remove(this.props.classNames.base+"--"+this.direction),delete t.dataset.starRating):t.parentNode.replaceChild(this.el,t),this.handleEvents("remove")),delete this.el.widget}},{key:"eventListener",value:function(t,n,s,o){var i=this;s.forEach(function(e){return t[n+"EventListener"](e,i.events[e],o||!1)})}},{key:"handleEvents",value:function(t){var n=this.el.closest("form");if(n&&n.tagName==="FORM"&&this.eventListener(n,t,["reset"]),this.eventListener(this.el,t,["change"]),"add"===t&&this.el.disabled)return;this.eventListener(this.el,t,["keydown"]),this.eventListener(this.widgetEl,t,["mousedown","mouseleave","mousemove","touchend","touchmove"],!1)}},{key:"indexFromEvent",value:function(t){var n,s,i=((n=t.touches)===null||n===void 0?void 0:n[0])||((s=t.changedTouches)===null||s===void 0?void 0:s[0])||t,o=document.elementFromPoint(i.clientX,i.clientY);return o.parentNode===this.widgetEl?[].slice.call(o.parentNode.children).indexOf(o):this.indexActive}},{key:"onChange",value:function(){this.changeIndexTo(this.selected(),!0)}},{key:"onKeyDown",value:function(t){var n,o,i,a,s=t.key.slice(5);if(!~["Left","Right"].indexOf(s))return;t.preventDefault(),n=s==="Left"?-1:1,this.direction==="rtl"&&(n*=-1),o=this.values.length-1,i=-1,a=Math.min(Math.max(this.selected()+n,i),o),this.selectValue(a,!0)}},{key:"onPointerDown",value:function(t){t.preventDefault();var n=this.indexFromEvent(t);this.props.clearable&&n===this.indexSelected&&(n=-1),this.selectValue(n,!0)}},{key:"onPointerLeave",value:function(t){var n=this;t.preventDefault(),cancelAnimationFrame(this.tick),requestAnimationFrame(function(){return n.changeIndexTo(n.indexSelected)})}},{key:"onPointerMove",value:function(t){var n=this;t.preventDefault(),this.ticking||(this.tick=requestAnimationFrame(function(){return n.changeIndexTo(n.indexFromEvent(t))}),this.ticking=!0)}},{key:"onReset",value:function(){var t,n=this.valueIndex((t=this.el.querySelector("[selected]"))===null||t===void 0?void 0:t.value);this.selectValue(n||-1,!1)}},{key:"selected",value:function(){return this.valueIndex(this.el.value)}},{key:"selectValue",value:function(t,n){var s;this.el.value=((s=this.values[t])===null||s===void 0?void 0:s.value)||"",this.indexSelected=this.selected(),!1===n?this.changeIndexTo(this.selected(),!0):this.el.dispatchEvent(new Event("change"))}},{key:"valueIndex",value:function(t){return this.values.findIndex(function(e){return e.value===+t})}}]),e}(),h=function(){function t(e,n){o(this,t),this.destroy=this.destroy.bind(this),this.props=n,this.rebuild=this.rebuild.bind(this),this.selector=e,this.widgets=[],this.build()}return s(t,[{key:"build",value:function(){var t=this;this.queryElements(this.selector).forEach(function(e){var n=c(r,t.props,JSON.parse(e.getAttribute("data-options")));"SELECT"===e.tagName&&!e.widget&&(!n.prebuilt&&e.parentNode.classList.contains(n.classNames.base)&&t.unwrap(e),t.widgets.push(new u(e,n)))})}},{key:"destroy",value:function(){this.widgets.forEach(function(e){return e.destroy()}),this.widgets=[]}},{key:"queryElements",value:function(n){return"HTMLSelectElement"===e(n)?[n]:"NodeList"===e(n)?[].slice.call(n):"String"===e(n)?[].slice.call(document.querySelectorAll(n)):[]}},{key:"rebuild",value:function(){this.destroy(),this.build()}},{key:"unwrap",value:function(t){var n=t.parentNode,s=n.parentNode;s.insertBefore(t,n),s.removeChild(n)}}]),t}();return h}()