function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function i(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}var s={classNames:{active:"gl-active",base:"gl-star-rating",selected:"gl-selected"},clearable:!0,maxStars:10,prebuilt:!1,stars:null,tooltip:"Select a Rating"},n=function(e,t,n){e.classList[t?"add":"remove"](n)},a=function(e){var n,t=document.createElement("span");for(n in e=e||{})t.setAttribute(n,e[n]);return t},l=function(e,t,n){var s=a(n);return e.parentNode.insertBefore(s,t?e.nextSibling:e),s},r=function e(){for(var t,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return t={},s.forEach(function(n){Object.keys(n||{}).forEach(function(i){if(void 0!==s[0][i]){var a=n[i];"Object"!==o(a)||"Object"!==o(t[i])?t[i]=a:t[i]=e(t[i],a)}})}),t},o=function(e){return{}.toString.call(e).slice(8,-1)},h=function(){function t(n,s){var o,i,a;e(this,t),this.direction=window.getComputedStyle(n,null).getPropertyValue("direction"),this.el=n,this.events={change:this.onChange.bind(this),keydown:this.onKeyDown.bind(this),mousedown:this.onPointerDown.bind(this),mouseleave:this.onPointerLeave.bind(this),mousemove:this.onPointerMove.bind(this),reset:this.onReset.bind(this),touchend:this.onPointerDown.bind(this),touchmove:this.onPointerMove.bind(this)},this.indexActive=null,this.indexSelected=null,this.props=s,this.tick=null,this.ticking=!1,this.values=function(e){var t=[];return[].forEach.call(e.options,function(e){var n=parseInt(e.value,10)||0;n>0&&t.push({index:e.index,text:e.text,value:n})}),t.sort(function(e,t){return e.value-t.value})}(n),this.widgetEl=null,this.el.widget&&this.el.widget.destroy(),o=this.values.length,i=1,a=this.props.maxStars,/^\d+$/.test(o)&&i<=o&&o<=a?this.build():this.destroy()}return i(t,[{key:"build",value:function(){this.destroy(),this.buildWidget(),this.selectValue(this.indexSelected=this.selected(),!1),this.handleEvents("add"),this.el.widget=this}},{key:"buildWidget",value:function(){var e,t,n=this;this.props.prebuilt?(e=this.el.parentNode,t=e.querySelector("."+this.props.classNames.base+"--stars")):((e=l(this.el,!1,{class:this.props.classNames.base})).appendChild(this.el),t=l(this.el,!0,{class:this.props.classNames.base+"--stars"}),this.values.forEach(function(e,s){var o=a({"data-index":s,"data-value":e.value});"function"==typeof n.props.stars&&n.props.stars.call(n,o,e,s),[].forEach.call(o.children,function(e){return e.style.pointerEvents="none"}),t.innerHTML+=o.outerHTML})),e.dataset.starRating="",e.classList.add(this.props.classNames.base+"--"+this.direction),this.props.tooltip&&t.setAttribute("role","tooltip"),this.widgetEl=t}},{key:"changeIndexTo",value:function(e,t){var o,i,s=this;(this.indexActive!==e||t)&&(([].forEach.call(this.widgetEl.children,function(t,o){n(t,o<=e,s.props.classNames.active),n(t,o===s.indexSelected,s.props.classNames.selected)}),this.widgetEl.setAttribute("data-rating",e+1),"function"==typeof this.props.stars||this.props.prebuilt||(this.widgetEl.classList.remove("s"+10*(this.indexActive+1)),this.widgetEl.classList.add("s"+10*(e+1))),this.props.tooltip)&&(i=e<0?this.props.tooltip:null===(o=this.values[e])||void 0===o?void 0:o.text,this.widgetEl.setAttribute("aria-label",i)),this.indexActive=e),this.ticking=!1}},{key:"destroy",value:function(){this.indexActive=null,this.indexSelected=this.selected();var e=this.el.parentNode;e.classList.contains(this.props.classNames.base)&&(this.props.prebuilt?(this.widgetEl=e.querySelector("."+this.props.classNames.base+"--stars"),e.classList.remove(this.props.classNames.base+"--"+this.direction),delete e.dataset.starRating):e.parentNode.replaceChild(this.el,e),this.handleEvents("remove")),delete this.el.widget}},{key:"eventListener",value:function(e,t,n,s){var o=this;n.forEach(function(n){return e[t+"EventListener"](n,o.events[n],s||!1)})}},{key:"handleEvents",value:function(e){var t=this.el.closest("form");t&&"FORM"===t.tagName&&this.eventListener(t,e,["reset"]),this.eventListener(this.el,e,["change"]),"add"===e&&this.el.disabled||(this.eventListener(this.el,e,["keydown"]),this.eventListener(this.widgetEl,e,["mousedown","mouseleave","mousemove","touchend","touchmove"],!1))}},{key:"indexFromEvent",value:function(e){var t,n,o=(null===(t=e.touches)||void 0===t?void 0:t[0])||(null===(n=e.changedTouches)||void 0===n?void 0:n[0])||e,s=document.elementFromPoint(o.clientX,o.clientY);return s.parentNode===this.widgetEl?[].slice.call(s.parentNode.children).indexOf(s):this.indexActive}},{key:"onChange",value:function(){this.changeIndexTo(this.selected(),!0)}},{key:"onKeyDown",value:function(e){if(t=e.key.slice(5),~["Left","Right"].indexOf(t)){n="Left"===t?-1:1,"rtl"===this.direction&&(n*=-1);var t,n,s=this.values.length-1,o=Math.min(Math.max(this.selected()+n,-1),s);this.selectValue(o,!0)}}},{key:"onPointerDown",value:function(e){e.preventDefault();var t=this.indexFromEvent(e);this.props.clearable&&t===this.indexSelected&&(t=-1),this.selectValue(t,!0)}},{key:"onPointerLeave",value:function(e){var t=this;e.preventDefault(),cancelAnimationFrame(this.tick),requestAnimationFrame(function(){return t.changeIndexTo(t.indexSelected)})}},{key:"onPointerMove",value:function(e){var t=this;e.preventDefault(),this.ticking||(this.tick=requestAnimationFrame(function(){return t.changeIndexTo(t.indexFromEvent(e))}),this.ticking=!0)}},{key:"onReset",value:function(){var e,t=this.valueIndex(null===(e=this.el.querySelector("[selected]"))||void 0===e?void 0:e.value);this.selectValue(t||-1,!1)}},{key:"selected",value:function(){return this.valueIndex(this.el.value)}},{key:"selectValue",value:function(e,t){var n;this.el.value=(null===(n=this.values[e])||void 0===n?void 0:n.value)||"",this.indexSelected=this.selected(),!1===t?this.changeIndexTo(this.selected(),!0):this.el.dispatchEvent(new Event("change"))}},{key:"valueIndex",value:function(e){return this.values.findIndex(function(t){return t.value===+e})}}]),t}(),u=function(){function t(n,s){e(this,t),this.destroy=this.destroy.bind(this),this.props=s,this.rebuild=this.rebuild.bind(this),this.selector=n,this.widgets=[],this.build()}return i(t,[{key:"build",value:function(){var e=this;this.queryElements(this.selector).forEach(function(t){var n=r(s,e.props,JSON.parse(t.getAttribute("data-options")));"SELECT"!==t.tagName||t.widget||(!n.prebuilt&&t.parentNode.classList.contains(n.classNames.base)&&e.unwrap(t),e.widgets.push(new h(t,n)))})}},{key:"destroy",value:function(){this.widgets.forEach(function(e){return e.destroy()}),this.widgets=[]}},{key:"queryElements",value:function(e){return"HTMLSelectElement"===o(e)?[e]:"NodeList"===o(e)?[].slice.call(e):"String"===o(e)?[].slice.call(document.querySelectorAll(e)):[]}},{key:"rebuild",value:function(){this.destroy(),this.build()}},{key:"unwrap",value:function(e){var t=e.parentNode,n=t.parentNode;n.insertBefore(e,t),n.removeChild(t)}}]),t}();export default u