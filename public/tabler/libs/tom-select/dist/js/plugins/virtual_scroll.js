(function(e,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis!="undefined"?globalThis:e||self,e.virtual_scroll=t())})(this,function(){"use strict";const n="[̀-ͯ·ʾʼ]",e={},t={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let n in t){let s=t[n]||"";for(let t=0;t<s.length;t++){let o=s.substring(t,t+1);e[o]=n}}new RegExp(Object.keys(e).join("|")+"|"+n,"gu");const s=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)},o=(e,...t)=>{var n=i(t);e=a(e),e.map(e=>{n.map(t=>{e.classList.add(t)})})},i=e=>{var t=[];return s(e,e=>{typeof e=="string"&&(e=e.trim().split(/[\11\12\14\15\40]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},a=e=>(Array.isArray(e)||(e=[e]),e);function r(){const e=this,c=e.canLoad,l=e.clearActiveOption,d=e.loadCallback;var n,i,t={},s=!1,r=[];if(e.settings.shouldLoadMore||(e.settings.shouldLoadMore=()=>{const s=n.clientHeight/(n.scrollHeight-n.scrollTop);if(s>.9)return!0;if(e.activeOption){var t=e.selectable(),o=Array.from(t).indexOf(e.activeOption);if(o>=t.length-2)return!0}return!1}),!e.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";e.settings.sortField=[{field:"$order"},{field:"$score"}];const a=s=>!(typeof e.settings.maxOptions=="number"&&n.children.length>=e.settings.maxOptions)&&!!(s in t&&t[s]),u=(t,n)=>e.items.indexOf(n)>=0||r.indexOf(n)>=0;e.setNextUrl=(e,n)=>{t[e]=n},e.getUrl=n=>{if(n in t){const e=t[n];return t[n]=!1,e}return t={},e.settings.firstUrl.call(e,n)},e.hook("instead","clearActiveOption",()=>{if(s)return;return l.call(e)}),e.hook("instead","canLoad",n=>n in t?a(n):c.call(e,n)),e.hook("instead","loadCallback",(t,n)=>{if(s){if(i){const n=t[0];n!==void 0&&(i.dataset.value=n[e.settings.valueField])}}else e.clearOptions(u);d.call(e,t,n),s=!1}),e.hook("after","refreshOptions",()=>{const r=e.lastValue;var s;a(r)?(s=e.render("loading_more",{query:r}),s&&(s.setAttribute("data-selectable",""),i=s)):r in t&&!n.querySelector(".no-results")&&(s=e.render("no_more_results",{query:r})),s&&(o(s,e.settings.optionClass),n.append(s))}),e.on("initialize",()=>{r=Object.keys(e.options),n=e.dropdown_content,e.settings.render=Object.assign({},{loading_more:()=>`<div class="loading-more-results">Loading more results ... </div>`,no_more_results:()=>`<div class="no-more-results">No more results</div>`},e.settings.render),n.addEventListener("scroll",()=>{if(!e.settings.shouldLoadMore.call(e))return;if(!a(e.lastValue))return;if(s)return;s=!0,e.load.call(e,e.lastValue)})})}return r})