!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).TomSelect=t()}(this,function(){"use strict";function O(e,t){e.split(/\s+/).forEach(e=>{t(e)})}class de{constructor(){this._events=void 0,this._events={}}on(e,t){O(e,e=>{const n=this._events[e]||[];n.push(t),this._events[e]=n})}off(e,t){var n=arguments.length;0!==n?O(e,e=>{if(1===n)return void delete this._events[e];const s=this._events[e];void 0!==s&&(s.splice(s.indexOf(t),1),this._events[e]=s)}):this._events={}}trigger(t,...n){var e=this;O(t,t=>{const s=e._events[t];void 0!==s&&s.forEach(t=>{t.apply(e,n)})})}}const j=e=>(e=e.filter(Boolean)).length<2?e[0]||"":1==oe(e)?"["+e.join("")+"]":"(?:"+e.join("|")+")",D=e=>{if(!ie(e))return e.join("");let n="",t=0;const s=()=>{t>1&&(n+="{"+t+"}")};return e.forEach((o,i)=>{o!==e[i-1]?(s(),n+=o,t=1):t++}),s(),n},R=e=>{let t=F(e);return j(t)},ie=e=>new Set(e).size!==e.length,h=e=>(e+"").replace(/([$()*+.?[\]^{|}\\])/gu,"\\$1"),oe=e=>e.reduce((e,t)=>Math.max(e,se(t)),0),se=e=>F(e).length,F=e=>Array.from(e),H=e=>{if(1===e.length)return[[e]];let t=[];const n=e.substring(1);return H(n).forEach(function(n){let s=n.slice(0);s[0]=e.charAt(0)+s[0],t.push(s),s=n.slice(0),s.unshift(e.charAt(0)),t.push(s)}),t},J=[[0,65535]];let v,U;const E={},K={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let e in K){let t=K[e]||"";for(let n=0;n<t.length;n++){let s=t.substring(n,n+1);E[s]=e}}const q=new RegExp(Object.keys(E).join("|")+"|[̀-ͯ·ʾʼ]","gu"),T=(e,t="NFKD")=>e.normalize(t),b=e=>F(e).reduce((e,t)=>e+X(t),""),X=e=>(e=T(e).toLowerCase().replace(q,e=>E[e]||""),T(e,"NFC")),Q=e=>{const t={},n=(e,n)=>{const s=t[e]||new Set,o=new RegExp("^"+R(s)+"$","iu");n.match(o)||(s.add(h(n)),t[e]=s)};for(let t of function*(e){for(const[t,n]of e)for(let e=t;e<=n;e++){let o=String.fromCharCode(e),s=b(o);s!=o.toLowerCase()&&(s.length>3||0!=s.length&&(yield{folded:s,composed:o,code_point:e}))}}(e))n(t.folded,t.folded),n(t.folded,t.composed);return t},Z=e=>{const n=Q(e),s={};let t=[];for(let e in n){let o=n[e];o&&(s[e]=R(o)),e.length>1&&t.push(h(e))}t.sort((e,t)=>t.length-e.length);const o=j(t);return U=new RegExp("^"+o,"u"),s},te=(e,t=1)=>(t=Math.max(t,e.length-1),j(H(e).map(e=>((e,t=1)=>{let n=0;return e=e.map(e=>(v[e]&&(n+=e.length),v[e]||e)),n>=t?D(e):""})(e,t)))),I=(e,t=!0)=>{let n=e.length>1?1:0;return j(e.map(e=>{let s=[];const o=t?e.length():e.length()-1;for(let t=0;t<o;t++)s.push(te(e.substrs[t]||"",n));return D(s)}))},Y=(e,t)=>{for(const n of t){if(n.start!=e.start||n.end!=e.end)continue;if(n.substrs.join("")!==e.substrs.join(""))continue;let s=e.parts;const o=e=>{for(const t of s){if(t.start===e.start&&t.substr===e.substr)return!1;if(1!=e.length&&1!=t.length){if(e.start<t.start&&e.end>t.start)return!0;if(t.start<e.start&&t.end>e.start)return!0}}return!1};if(!(n.parts.filter(o).length>0))return!0}return!1};class C{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new C,o=JSON.parse(JSON.stringify(this.parts)),s=o.pop();for(const e of o)n.add(e);let i=t.substr.substring(0,e-s.start),a=i.length;return n.add({start:s.start,end:s.start+a,length:a,substr:i}),n}}const ae=e=>{var s;void 0===v&&(v=Z(s||J)),e=b(e);let n="",t=[new C];for(let s=0;s<e.length;s++){let r=e.substring(s).match(U);const c=e.substring(s,s+1),o=r?r[0]:null;let i=[],a=new Set;for(const e of t){const n=e.last();if(!n||1==n.length||n.end<=s)if(o){const t=o.length;e.add({start:s,end:s+t,length:t,substr:o}),a.add("1")}else e.add({start:s,end:s+1,length:1,substr:c}),a.add("2");else if(o){let t=e.clone(s,n);const a=o.length;t.add({start:s,end:s+a,length:a,substr:o}),i.push(t)}else a.add("3")}if(i.length>0){i=i.sort((e,t)=>e.length()-t.length());for(let e of i)Y(e,t)||t.push(e)}else if(s>0&&1==a.size&&!a.has("3")){n+=I(t,!1);let e=new C;const s=t[0];s&&e.add(s.last()),t=[e]}}return n+=I(t,!0),n},re=(e,t)=>{if(e)return e[t]},ce=(e,t)=>{if(e){for(var n,s=t.split(".");(n=s.shift())&&(e=e[n]););return e}},S=(e,t,n)=>{var s,o;return e?(e+="",null==t.regex||-1===(o=e.search(t.regex))?0:(s=t.string.length/e.length,0===o&&(s+=.5),s*n)):0},M=(e,t)=>{var n=e[t];if("function"==typeof n)return n;n&&!Array.isArray(n)&&(e[t]=[n])},s=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)},le=(e,t)=>"number"==typeof e&&"number"==typeof t?e>t?1:e<t?-1:0:(e=b(e+"").toLowerCase())>(t=b(t+"").toLowerCase())?1:t>e?-1:0;class G{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const o=[],i=e.split(/\s+/);var s;return n&&(s=new RegExp("^("+Object.keys(n).map(h).join("|")+"):(.*)$")),i.forEach(e=>{let i,a=null,n=null;s&&(i=e.match(s))&&(a=i[1],e=i[2]),e.length>0&&(n=this.settings.diacritics?ae(e)||null:h(e),n&&t&&(n="\\b"+n)),o.push({string:e,regex:n?new RegExp(n,"iu"):null,field:a})}),o}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const r=e.options.fields,c=e.weights,o=r.length,i=e.getAttrFn;if(!o)return function(){return 1};const a=1===o?function(e,t){const n=r[0].field;return S(i(t,n),e,c[n]||1)}:function(e,t){var n=0;if(e.field){const s=i(t,e.field);!e.regex&&s?n+=1/o:n+=S(s,e,1)}else s(c,(s,o)=>{n+=S(i(t,o),e,s)});return n/o};return 1===n?function(e){return a(t[0],e)}:"and"===e.options.conjunction?function(e){var s,o=0;for(let n of t){if((s=a(n,e))<=0)return 0;o+=s}return o/n}:function(e){var o=0;return s(t,t=>{o+=a(t,e)}),o/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var s,t=[];const a=this,o=e.options,n=!e.query&&o.sort_empty?o.sort_empty:o.sort;if("function"==typeof n)return n.bind(this);const i=function(t,n){return"$score"===t?n.score:e.getAttrFn(a.items[n.id],t)};if(n)for(let s of n)(e.query||"$score"!==s.field)&&t.push(s);if(e.query){s=!0;for(let e of t)if("$score"===e.field){s=!1;break}s&&t.unshift({field:"$score",direction:"desc"})}else t=t.filter(e=>"$score"!==e.field);return t.length?function(e,n){var s,o;for(let a of t)if(s=a.field,o=("desc"===a.direction?-1:1)*le(i(s,e),i(s,n)))return o;return 0}:null}prepareSearch(e,t){const s={};var n=Object.assign({},t);if(M(n,"sort"),M(n,"sort_empty"),n.fields){M(n,"fields");const e=[];n.fields.forEach(t=>{"string"==typeof t&&(t={field:t,weight:1}),e.push(t),s[t.field]="weight"in t?t.weight:1}),n.fields=e}return{options:n,query:e.toLowerCase().trim(),tokens:this.tokenize(e,n.respect_word_boundaries,s),total:0,items:[],weights:s,getAttrFn:n.nesting?ce:re}}search(e,t){var i,o=this,n=this.prepareSearch(e,t);t=n.options,e=n.query;const r=t.score||o._getScoreFunction(n);e.length?s(o.items,(e,s)=>{i=r(e),(!1===t.filter||i>0)&&n.items.push({score:i,id:s})}):s(o.items,(e,t)=>{n.items.push({score:1,id:t})});const a=o._getSortFunction(n);return a&&n.items.sort(a),n.total=n.items.length,"number"==typeof t.limit&&(n.items=n.items.slice(0,t.limit)),n}}const u=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)},i=e=>{if(e.jquery)return e[0];if(e instanceof HTMLElement)return e;if(L(e)){var t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}return document.querySelector(e)},L=e=>"string"==typeof e&&e.indexOf("<")>-1,k=(e,t)=>{var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!1),e.dispatchEvent(n)},f=(e,t)=>{Object.assign(e.style,t)},o=(e,...t)=>{var n=B(t);(e=V(e)).map(e=>{n.map(t=>{e.classList.add(t)})})},r=(e,...t)=>{var n=B(t);(e=V(e)).map(e=>{n.map(t=>{e.classList.remove(t)})})},B=e=>{var t=[];return u(e,e=>{"string"==typeof e&&(e=e.trim().split(/[\11\12\14\15\40]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},V=e=>(Array.isArray(e)||(e=[e]),e),w=(e,t,n)=>{if(!n||n.contains(e))for(;e&&e.matches;){if(e.matches(t))return e;e=e.parentNode}},W=(e,t=0)=>t>0?e[e.length-1]:e[0],_=(e,t)=>{if(!e)return-1;t=t||e.nodeName;for(var n=0;e=e.previousElementSibling;)e.matches(t)&&n++;return n},e=(e,t)=>{u(t,(t,n)=>{t==null?e.removeAttribute(n):e.setAttribute(n,""+t)})},y=(e,t)=>{e.parentNode&&e.parentNode.replaceChild(t,e)},ne=(e,t)=>{if(null===t)return;if("string"==typeof t){if(!t.length)return;t=new RegExp(t,"i")}const n=e=>3===e.nodeType?(e=>{var n,s,i,o=e.data.match(t);return o&&e.data.length>0?(n=document.createElement("span"),n.className="highlight",s=e.splitText(o.index),s.splitText(o[0].length),i=s.cloneNode(!0),n.appendChild(i),y(s,n),1):0})(e):((e=>{1!==e.nodeType||!e.childNodes||/(script|style)/i.test(e.tagName)||"highlight"===e.className&&"SPAN"===e.tagName||Array.from(e.childNodes).forEach(e=>{n(e)})})(e),0);n(e)},g="undefined"!=typeof navigator&&/Mac/.test(navigator.userAgent)?"metaKey":"ctrlKey";var A,z={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(e){return e.length>0},render:{}};const a=e=>e==null?null:p(e),p=e=>"boolean"==typeof e?e?"1":"0":e+"",m=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),ee=(e,t)=>{var n;return function(s,o){var i=this;n&&(i.loading=Math.max(i.loading-1,0),clearTimeout(n)),n=setTimeout(function(){n=null,i.loadedSearches[s]=!0,e.call(i,s,o)},t)}},$=(e,t,n)=>{var s,o=e.trigger,i={};for(s of(e.trigger=function(){var n=arguments[0];if(-1===t.indexOf(n))return o.apply(e,arguments);i[n]=arguments},n.apply(e,[]),e.trigger=o,t))s in i&&o.apply(e,i[s])},t=(e,t=!1)=>{e&&(e.preventDefault(),t&&e.stopPropagation())},n=(e,t,n,s)=>{e.addEventListener(t,n,s)},c=(e,t)=>!!t&&!!t[e]&&1===(t.altKey?1:0)+(t.ctrlKey?1:0)+(t.shiftKey?1:0)+(t.metaKey?1:0),x=(e,t)=>{const n=e.getAttribute("id");return n||(e.setAttribute("id",t),t)},P=e=>e.replace(/[\\"']/g,"\\$&"),l=(e,t)=>{t&&e.append(t)};function N(e,t){var s,o,m,f,v,b,j,n=Object.assign({},z,t),p=n.dataAttr,h=n.labelField,c=n.valueField,r=n.disabledField,i=n.optgroupField,g=n.optgroupLabelField,l=n.optgroupValueField,y=e.tagName.toLowerCase(),d=e.getAttribute("placeholder")||e.getAttribute("data-placeholder");if(!d&&!n.allowEmptyOption){let t=e.querySelector('option[value=""]');t&&(d=t.textContent)}return s={placeholder:d,options:[],optgroups:[],items:[],maxItems:null},"select"===y?(b=s.options,o={},j=1,m=e=>{var t=Object.assign({},e.dataset),n=p&&t[p];return"string"==typeof n&&n.length&&(t=Object.assign(t,JSON.parse(n))),t},f=(e,t)=>{var l,u,d=a(e.value);d!=null&&(d||n.allowEmptyOption)&&(o.hasOwnProperty(d)?t&&(u=o[d][i],u?Array.isArray(u)?u.push(t):o[d][i]=[u,t]:o[d][i]=t):(l=m(e),l[h]=l[h]||e.textContent,l[c]=l[c]||d,l[r]=l[r]||e.disabled,l[i]=l[i]||t,l.$option=e,o[d]=l,b.push(l)),e.selected&&s.items.push(d))},s.maxItems=e.hasAttribute("multiple")?null:1,u(e.children,e=>{var t,n,o;"optgroup"===(v=e.tagName.toLowerCase())?((t=m(n=e))[g]=t[g]||n.getAttribute("label")||"",t[l]=t[l]||j++,t[r]=t[r]||n.disabled,s.optgroups.push(t),o=t[l],u(n.children,e=>{f(e,o)})):"option"===v&&f(e)})):(()=>{const t=e.getAttribute(p);if(t)s.options=JSON.parse(t),u(s.options,e=>{s.items.push(e[c])});else{var o=e.value.trim()||"";if(!n.allowEmptyOption&&!o.length)return;const t=o.split(n.delimiter);u(t,e=>{const t={};t[h]=e,t[c]=e,s.options.push(t)}),s.items=t}})(),Object.assign({},z,s,t)}A=0;class d extends function(e){return e.plugins={},class extends e{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(t,n){e.plugins[t]={name:t,fn:n}}initializePlugins(e){const s=this,n=[];if(Array.isArray(e))e.forEach(e=>{"string"==typeof e?n.push(e):(s.plugins.settings[e.name]=e.options,n.push(e.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(s.plugins.settings[t]=e[t],n.push(t));for(var t,o;o=n.shift();)s.require(o)}loadPlugin(t){var n=this,s=n.plugins,o=e.plugins[t];if(!e.plugins.hasOwnProperty(t))throw new Error('Unable to find "'+t+'" plugin');s.requested[t]=!0,s.loaded[t]=o.fn.apply(n,[n.plugins.settings[t]||{}]),s.names.push(t)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}(de){constructor(t,n){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],A++;var c,d,p,r=i(t);if(r.tomselect)throw new Error("Tom Select already initialized on this element");r.tomselect=this,p=(window.getComputedStyle&&window.getComputedStyle(r,null)).getPropertyValue("direction");const a=N(r,n);this.settings=a,this.input=r,this.tabIndex=r.tabIndex||0,this.is_select_tag="select"===r.tagName.toLowerCase(),this.rtl=/rtl/i.test(p),this.inputId=x(r,"tomselect-"+A),this.isRequired=r.required,this.sifter=new G(this.options,{diacritics:a.diacritics}),a.mode=a.mode||(1===a.maxItems?"single":"multi"),"boolean"!=typeof a.hideSelected&&(a.hideSelected="multi"===a.mode),"boolean"!=typeof a.hidePlaceholder&&(a.hidePlaceholder="multi"!==a.mode),d=a.createFilter,"function"!=typeof d&&("string"==typeof d&&(d=new RegExp(d)),d instanceof RegExp?a.createFilter=e=>d.test(e):a.createFilter=e=>this.settings.duplicates||!this.options[e]),this.initializePlugins(a.plugins),this.setupCallbacks(),this.setupTemplates();const m=i("<div>"),u=i("<div>"),h=this._render("dropdown"),f=i('<div role="listbox" tabindex="-1">'),g=this.input.getAttribute("class")||"",v=a.mode;o(m,a.wrapperClass,g,v),o(u,a.controlClass),l(m,u),o(h,a.dropdownClass,v),a.copyClassesToDropdown&&o(h,g),o(f,a.dropdownContentClass),l(h,f),i(a.dropdownParent||m).appendChild(h),L(a.controlInput)?(c=i(a.controlInput),s(["autocorrect","autocapitalize","autocomplete"],t=>{r.getAttribute(t)&&e(c,{[t]:r.getAttribute(t)})}),c.tabIndex=-1,u.appendChild(c),this.focus_node=c):a.controlInput?(c=i(a.controlInput),this.focus_node=c):(c=i("<input/>"),this.focus_node=u),this.wrapper=m,this.dropdown=h,this.dropdown_content=f,this.control=u,this.control_input=c,this.setup()}setup(){const s=this,i=s.settings,c=s.control_input,l=s.dropdown,f=s.dropdown_content,m=s.wrapper,j=s.control,a=s.input,d=s.focus_node,g={passive:!0},p=s.inputId+"-ts-dropdown";e(f,{id:p}),e(d,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":p});const y=x(d,s.inputId+"-ts-control"),_="label[for='"+(e=>e.replace(/['"\\]/g,"\\$&"))(s.inputId)+"']",r=document.querySelector(_),v=s.focus.bind(s);if(r){n(r,"click",v),e(r,{for:y});const t=x(r,s.inputId+"-ts-label");e(d,{"aria-labelledby":t}),e(f,{"aria-labelledby":t})}if(m.style.width=a.style.width,s.plugins.names.length){const e="plugin-"+s.plugins.names.join(" plugin-");o([m,l],e)}(null===i.maxItems||i.maxItems>1)&&s.is_select_tag&&e(a,{multiple:"multiple"}),i.placeholder&&e(c,{placeholder:i.placeholder}),!i.splitOn&&i.delimiter&&(i.splitOn=new RegExp("\\s*"+h(i.delimiter)+"+\\s*")),i.load&&i.loadThrottle&&(i.load=ee(i.load,i.loadThrottle)),s.control_input.type=a.type,n(l,"mousemove",()=>{s.ignoreHover=!1}),n(l,"mouseenter",e=>{var t=w(e.target,"[data-selectable]",l);t&&s.onOptionHover(e,t)},{capture:!0}),n(l,"click",e=>{const n=w(e.target,"[data-selectable]");n&&(s.onOptionSelect(e,n),t(e,!0))}),n(j,"click",e=>{var n=w(e.target,"[data-ts-item]",j);n&&s.onItemSelect(e,n)?t(e,!0):""==c.value&&(s.onClick(),t(e,!0))}),n(d,"keydown",e=>s.onKeyDown(e)),n(c,"keypress",e=>s.onKeyPress(e)),n(c,"input",e=>s.onInput(e)),n(d,"blur",e=>s.onBlur(e)),n(d,"focus",e=>s.onFocus(e)),n(c,"paste",e=>s.onPaste(e));const b=e=>{const n=e.composedPath()[0];if(!m.contains(n)&&!l.contains(n))return s.isFocused&&s.blur(),void s.inputState();n==c&&s.isOpen?e.stopPropagation():t(e,!0)},u=()=>{s.isOpen&&s.positionDropdown()};n(document,"mousedown",b),n(window,"scroll",u,g),n(window,"resize",u,g),this._destroy=()=>{document.removeEventListener("mousedown",b),window.removeEventListener("scroll",u),window.removeEventListener("resize",u),r&&r.removeEventListener("click",v)},this.revertSettings={innerHTML:a.innerHTML,tabIndex:a.tabIndex},a.tabIndex=-1,a.insertAdjacentElement("afterend",s.wrapper),s.sync(!1),i.items=[],delete i.optgroups,delete i.options,n(a,"invalid",()=>{s.isValid&&(s.isValid=!1,s.isInvalid=!0,s.refreshState())}),s.updateOriginalInput(),s.refreshItems(),s.close(!1),s.inputState(),s.isSetup=!0,a.disabled?s.disable():s.enable(),s.on("change",this.onChange),o(a,"tomselected","ts-hidden-accessible"),s.trigger("initialize"),!0===i.preload&&s.preload()}setupOptions(e=[],t=[]){this.addOptions(e),s(t,e=>{this.registerOptionGroup(e)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,s={optgroup:e=>{let t=document.createElement("div");return t.className="optgroup",t.appendChild(e.options),t},optgroup_header:(e,t)=>'<div class="optgroup-header">'+t(e[n])+"</div>",option:(e,n)=>"<div>"+n(e[t])+"</div>",item:(e,n)=>"<div>"+n(e[t])+"</div>",option_create:(e,t)=>'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},s,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)(t=this.settings[n[e]])&&this.on(e,t)}sync(e=!0){const t=this,n=e?N(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0)return e.clearActiveItems(),void e.focus();e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){k(this.input,"input"),k(this.input,"change")}onPaste(e){var n=this;n.isInputHidden||n.isLocked?t(e):n.settings.splitOn&&setTimeout(()=>{var t,e=n.inputValue();e.match(n.settings.splitOn)&&(t=e.trim().split(n.settings.splitOn),s(t,e=>{a(e)&&(this.options[e]?n.addItem(e):n.createItem(e))}))},0)}onKeyPress(e){var s,n=this;if(!n.isLocked)return s=String.fromCharCode(e.keyCode||e.which),n.settings.create&&"multi"===n.settings.mode&&s===n.settings.delimiter?(n.createItem(),void t(e)):void 0;t(e)}onKeyDown(e){var n=this;if(n.ignoreHover=!0,n.isLocked)9!==e.keyCode&&t(e);else{switch(e.keyCode){case 65:if(c(g,e)&&""==n.control_input.value)return t(e),void n.selectAll();break;case 27:return n.isOpen&&(t(e,!0),n.close()),void n.clearActiveItems();case 40:if(!n.isOpen&&n.hasOptions)n.open();else if(n.activeOption){let e=n.getAdjacent(n.activeOption,1);e&&n.setActiveOption(e)}return void t(e);case 38:if(n.activeOption){let e=n.getAdjacent(n.activeOption,-1);e&&n.setActiveOption(e)}return void t(e);case 13:return void(n.canSelect(n.activeOption)?(n.onOptionSelect(e,n.activeOption),t(e)):(n.settings.create&&n.createItem()||document.activeElement==n.control_input&&n.isOpen)&&t(e));case 37:return void n.advanceSelection(-1,e);case 39:return void n.advanceSelection(1,e);case 9:return void(n.settings.selectOnTab&&(n.canSelect(n.activeOption)&&(n.onOptionSelect(e,n.activeOption),t(e)),n.settings.create&&n.createItem()&&t(e)));case 8:case 46:return void n.deleteSelection(e)}n.isInputHidden&&!c(g,e)&&t(e)}}onInput(){var n,t=this;t.isLocked||(n=t.inputValue(),t.lastValue!==n&&(t.lastValue=n,t.settings.shouldLoad.call(t,n)&&t.load(n),t.refreshOptions(),t.trigger("type",n)))}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var n=this,s=n.isFocused;if(n.isDisabled)return n.blur(),void t(e);n.ignoreFocus||(n.isFocused=!0,"focus"===n.settings.preload&&n.preload(),s||n.trigger("focus"),n.activeItems.length||(n.showInput(),n.refreshOptions(!!n.settings.openOnFocus)),n.refreshState())}onBlur(){if(!1!==document.hasFocus()){var n,t=this;t.isFocused&&(t.isFocused=!1,t.ignoreFocus=!1,n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")},t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n())}}onOptionSelect(e,t){var s,n=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?n.createItem(null,()=>{n.settings.closeAfterSelect&&n.close()}):void 0!==(s=t.dataset.value)&&(n.lastQuery=null,n.addItem(s),n.settings.closeAfterSelect&&n.close(),!n.settings.hideSelected&&e.type&&/click/.test(e.type)&&n.setActiveOption(t)))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,n){var s=this;return!s.isLocked&&"multi"===s.settings.mode&&(t(e),s.setActiveItem(n,e),!0)}canLoad(e){return!!this.settings.load&&!this.loadedSearches.hasOwnProperty(e)}load(e){const t=this;if(!t.canLoad(e))return;o(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||r(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input;t.value!==e&&(t.value=e,k(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){$(this,t?[]:["change"],()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){0===e&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,n){var o,i,a,r,l,d,s=this;if("single"!==s.settings.mode){if(!e)return s.clearActiveItems(),void(s.isFocused&&s.showInput());if("click"===(r=n&&n.type.toLowerCase())&&c("shiftKey",n)&&s.activeItems.length){for(d=s.getLastActive(),(i=Array.prototype.indexOf.call(s.control.children,d))>(a=Array.prototype.indexOf.call(s.control.children,e))&&(l=i,i=a,a=l),o=i;o<=a;o++)e=s.control.children[o],-1===s.activeItems.indexOf(e)&&s.setActiveItemClass(e);t(n)}else"click"===r&&c(g,n)||"keydown"===r&&c("shiftKey",n)?e.classList.contains("active")?s.removeActiveItem(e):s.setActiveItemClass(e):(s.clearActiveItems(),s.setActiveItemClass(e));s.hideInput(),s.isFocused||s.focus()}}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&r(n,"last-active"),o(e,"active last-active"),t.trigger("item_select",e),-1==t.activeItems.indexOf(e)&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),r(e,"active")}clearActiveItems(){r(this.activeItems,"active"),this.activeItems=[]}setActiveOption(t,n=!0){t!==this.activeOption&&(this.clearActiveOption(),t&&(this.activeOption=t,e(this.focus_node,{"aria-activedescendant":t.getAttribute("id")}),e(t,{"aria-selected":"true"}),o(t,"active"),n&&this.scrollToOption(t)))}scrollToOption(e,t){if(!e)return;const s=this.dropdown_content,i=s.clientHeight,o=s.scrollTop||0,a=e.offsetHeight,n=e.getBoundingClientRect().top-s.getBoundingClientRect().top+o;n+a>i+o?this.scroll(n-i+a,t):n<o&&this.scroll(n,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(r(this.activeOption,"active"),e(this.activeOption,{"aria-selected":null})),this.activeOption=null,e(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if("single"===e.settings.mode)return;const t=e.controlChildren();t.length&&(e.hideInput(),e.close(),e.activeItems=t,s(t,t=>{e.setActiveItemClass(t)}))}inputState(){var t=this;t.control.contains(t.control_input)&&(e(t.control_input,{placeholder:t.settings.placeholder}),t.activeItems.length>0||!t.isFocused&&t.settings.hidePlaceholder&&t.items.length>0?(t.setTextboxValue(),t.isInputHidden=!0):(t.settings.hidePlaceholder&&t.items.length>0&&e(t.control_input,{placeholder:""}),t.isInputHidden=!1),t.wrapper.classList.toggle("input-hidden",t.isInputHidden))}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return"string"==typeof e.sortField&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var n,s,t=this,o=this.getSearchOptions();if(t.settings.score&&"function"!=typeof(s=t.settings.score.call(t,e)))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==t.lastQuery?(t.lastQuery=e,n=t.sifter.search(e,Object.assign(o,{score:s})),t.currentResults=n):n=Object.assign({},t.currentResults),t.settings.hideSelected&&(n.items=n.items.filter(e=>{let n=a(e.id);return!n||-1===t.items.indexOf(n)})),n}refreshOptions(t=!0){const b={},j=[];n=this,d=n.inputValue();const E=d===n.lastQuery||""==d&&null==n.lastQuery;var n,o,d,u,h,m,f,g,v,y,w,O,x,C,a=n.search(d),i=null,_=n.settings.shouldOpen||!1,c=n.dropdown_content;for(E&&(i=n.activeOption)&&(y=i.closest("[data-group]")),m=a.items.length,"number"==typeof n.settings.maxOptions&&(m=Math.min(m,n.settings.maxOptions)),m>0&&(_=!0),v=0;v<m;v++){let l=a.items[v];if(!l)continue;let s=l.id,c=n.options[s];if(void 0===c)continue;let d=p(s),t=n.getOption(d,!0);for(n.settings.hideSelected||t.classList.toggle("selected",n.items.includes(d)),o=c[n.settings.optgroupField]||"",u=0,C=(w=Array.isArray(o)?o:[o])&&w.length;u<C;u++){o=w[u],n.optgroups.hasOwnProperty(o)||(o="");let a=b[o];void 0===a&&(a=document.createDocumentFragment(),j.push(o)),u>0&&(t=t.cloneNode(!0),e(t,{id:c.$id+"-clone-"+u,"aria-selected":null}),t.classList.add("ts-cloned"),r(t,"active"),n.activeOption&&n.activeOption.dataset.value==s&&y&&y.dataset.group===o.toString()&&(i=t)),a.appendChild(t),b[o]=a}}if(n.settings.lockOptgroupOrder&&j.sort((e,t)=>{const s=n.optgroups[e],o=n.optgroups[t];return(s&&s.$order||0)-(o&&o.$order||0)}),f=document.createDocumentFragment(),s(j,e=>{let t=b[e];if(!t||!t.children.length)return;let s=n.optgroups[e];if(void 0!==s){let e=document.createDocumentFragment(),o=n.render("optgroup_header",s);l(e,o),l(e,t);let i=n.render("optgroup",{group:s,options:e});l(f,i)}else l(f,t)}),c.innerHTML="",l(c,f),n.settings.highlight&&(O=c.querySelectorAll("span.highlight"),Array.prototype.forEach.call(O,function(e){var t=e.parentNode;t.replaceChild(e.firstChild,e),t.normalize()}),a.query.length&&a.tokens.length&&s(a.tokens,e=>{ne(c,e.regex)})),h=e=>{let t=n.render(e,{input:d});return t&&(_=!0,c.insertBefore(t,c.firstChild)),t},n.loading?h("loading"):n.settings.shouldLoad.call(n,d)?0===a.items.length&&h("no_results"):h("not_loading"),(x=n.canCreate(d))&&(g=h("option_create")),n.hasOptions=a.items.length>0||x,_){if(a.items.length>0){if(i||"single"!==n.settings.mode||null==n.items[0]||(i=n.getOption(n.items[0])),!c.contains(i)){let e=0;g&&!n.settings.addPrecedence&&(e=1),i=n.selectable()[e]}}else g&&(i=g);t&&!n.isOpen&&(n.open(),n.scrollToOption(i,"auto")),n.setActiveOption(i)}else n.clearActiveOption(),t&&n.isOpen&&n.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const s=a(e[n.settings.valueField]);return null!==s&&!n.options.hasOwnProperty(s)&&(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[s]=e,n.lastQuery=null,t&&(n.userOptions[s]=t,n.trigger("option_add",s,e)),s)}addOptions(e,t=!1){s(e,e=>{this.addOption(e,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=a(e[this.settings.optgroupValueField]);return null!==t&&(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var c,d;const s=a(e),r=a(t[n.settings.valueField]);if(null===s)return;const u=n.options[s];if(u==null)return;if("string"!=typeof r)throw new Error("Value must be set in option data");const i=n.getOption(s),l=n.getItem(s);if(t.$order=t.$order||u.$order,delete n.options[s],n.uncacheValue(r),n.options[r]=t,i){if(n.dropdown_content.contains(i)){const e=n._render("option",t);y(i,e),n.activeOption===i&&n.setActiveOption(e)}i.remove()}l&&(-1!==(d=n.items.indexOf(s))&&n.items.splice(d,1,r),c=n._render("item",t),l.classList.contains("active")&&o(c,"active"),y(l,c)),n.lastQuery=null}removeOption(e,t){const n=this;e=p(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const n=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const t={};s(this.options,(e,s)=>{n(e,s)&&(t[s]=e)}),this.options=this.sifter.items=t,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const s=a(e);if(null===s)return null;const n=this.options[s];if(n!=null){if(n.$div)return n.$div;if(t)return this._render("option",n)}return null}getAdjacent(e,t,n="option"){var s;if(!e)return null;s="item"==n?this.controlChildren():this.dropdown_content.querySelectorAll("[data-selectable]");for(let n=0;n<s.length;n++)if(s[n]==e)return t>0?s[n+1]:s[n-1];return null}getItem(e){if("object"==typeof e)return e;var t=a(e);return null!==t?this.control.querySelector(`[data-value="${P(t)}"]`):null}addItems(e,t){var s=this,n=Array.isArray(e)?e:[e];const o=(n=n.filter(e=>-1===s.items.indexOf(e)))[n.length-1];n.forEach(e=>{s.isPending=e!==o,s.addItem(e,t)})}addItem(e,t){$(this,t?[]:["change","dropdown_close"],()=>{var o,r;const n=this,i=n.settings.mode,s=a(e);if((!s||-1===n.items.indexOf(s)||("single"===i&&n.close(),"single"!==i&&n.settings.duplicates))&&null!==s&&n.options.hasOwnProperty(s)&&("single"===i&&n.clear(t),"multi"!==i||!n.isFull())){if(o=n._render("item",n.options[s]),n.control.contains(o)&&(o=o.cloneNode(!0)),r=n.isFull(),n.items.splice(n.caretPos,0,s),n.insertAtCaret(o),n.isSetup){if(!n.isPending&&n.settings.hideSelected){let t=n.getOption(s),e=n.getAdjacent(t,1);e&&n.setActiveOption(e)}n.isPending||n.settings.closeAfterSelect||n.refreshOptions(n.isFocused&&"single"!==i),0!=n.settings.closeAfterSelect&&n.isFull()?n.close():n.isPending||n.positionDropdown(),n.trigger("item_add",s,o),n.isPending||n.updateOriginalInput({silent:t})}(!n.isPending||!r&&n.isFull())&&(n.inputState(),n.refreshState())}})}removeItem(e=null,t){const n=this;if(!(e=n.getItem(e)))return;var s,i;const o=e.dataset.value;s=_(e),e.remove(),e.classList.contains("active")&&(i=n.activeItems.indexOf(e),n.activeItems.splice(i,1),r(e,"active")),n.items.splice(s,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(o)&&n.removeOption(o,t),s<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",o,e)}createItem(e=null,t=()=>{}){3===arguments.length&&(t=arguments[2]),"function"!=typeof t&&(t=()=>{});var s,o,i,n=this,r=n.caretPos;return e=e||n.inputValue(),n.canCreate(e)?(n.lock(),s=!1,o=e=>{if(n.unlock(),!e||"object"!=typeof e)return t();var o=a(e[n.settings.valueField]);if("string"!=typeof o)return t();n.setTextboxValue(),n.addOption(e,!0),n.setCaret(r),n.addItem(o),t(e),s=!0},i="function"==typeof n.settings.create?n.settings.create.call(this,e,o):{[n.settings.labelField]:e,[n.settings.valueField]:e},s||o(i),!0):(t(),!1)}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const s=e.isFull(),o=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const t=e.wrapper.classList;var n;t.toggle("focus",e.isFocused),t.toggle("disabled",e.isDisabled),t.toggle("required",e.isRequired),t.toggle("invalid",!e.isValid),t.toggle("locked",o),t.toggle("full",s),t.toggle("input-active",e.isFocused&&!e.isInputHidden),t.toggle("dropdown-active",e.isOpen),t.toggle("has-options",(n=e.options,0===Object.keys(n).length)),t.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,s;const o=t.input.querySelector('option[value=""]');if(t.is_select_tag){const e=[],r=t.input.querySelectorAll("option:checked").length;function a(n,s,a){return n||(n=i('<option value="'+m(s)+'">'+m(a)+"</option>")),n!=o&&t.input.append(n),e.push(n),(n!=o||r>0)&&(n.selected=!0),n}t.input.querySelectorAll("option:checked").forEach(e=>{e.selected=!1}),0==t.items.length&&"single"==t.settings.mode?a(o,"",""):t.items.forEach(o=>{n=t.options[o],s=n[t.settings.labelField]||"",e.includes(n.$option)?a(t.input.querySelector(`option[value="${P(o)}"]:not(:checked)`),o,s):n.$option=a(n.$option,o,s)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var t=this;t.isLocked||t.isOpen||"multi"===t.settings.mode&&t.isFull()||(t.isOpen=!0,e(t.focus_node,{"aria-expanded":"true"}),t.refreshState(),f(t.dropdown,{visibility:"hidden",display:"block"}),t.positionDropdown(),f(t.dropdown,{visibility:"visible",display:"block"}),t.focus(),t.trigger("dropdown_open",t.dropdown))}close(t=!0){var n=this,s=n.isOpen;t&&(n.setTextboxValue(),"single"===n.settings.mode&&n.items.length&&n.hideInput()),n.isOpen=!1,e(n.focus_node,{"aria-expanded":"false"}),f(n.dropdown,{display:"none"}),n.settings.hideSelected&&n.clearActiveOption(),n.refreshState(),s&&n.trigger("dropdown_close",n.dropdown)}positionDropdown(){if("body"===this.settings.dropdownParent){var t=this.control,e=t.getBoundingClientRect(),n=t.offsetHeight+e.top+window.scrollY,s=e.left+window.scrollX;f(this.dropdown,{width:e.width+"px",top:n+"px",left:s+"px"})}}clear(e){var n,t=this;t.items.length&&(n=t.controlChildren(),s(n,e=>{t.removeItem(e,!0)}),t.showInput(),e||t.updateOriginalInput(),t.trigger("clear"))}insertAtCaret(e){const t=this,n=t.caretPos,s=t.control;s.insertBefore(e,s.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var a,c,l,n=this,i=e&&8===e.keyCode?-1:1,r={start:(c=n.control_input).selectionStart||0,length:(c.selectionEnd||0)-(c.selectionStart||0)};const o=[];if(n.activeItems.length)l=W(n.activeItems,i),a=_(l),i>0&&a++,s(n.activeItems,e=>o.push(e));else if((n.isFocused||"single"===n.settings.mode)&&n.items.length){const t=n.controlChildren();let e;i<0&&0===r.start&&0===r.length?e=t[n.caretPos-1]:i>0&&r.start===n.inputValue().length&&(e=t[n.caretPos]),void 0!==e&&o.push(e)}if(!n.shouldDelete(o,e))return!1;for(t(e,!0),void 0!==a&&n.setCaret(a);o.length;)n.removeItem(o.pop());return n.showInput(),n.positionDropdown(),n.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(e=>e.dataset.value);return!(!n.length||"function"==typeof this.settings.onDelete&&!1===this.settings.onDelete(n,t))}advanceSelection(e,t){var s,o,n=this;n.rtl&&(e*=-1),n.inputValue().length||(c(g,t)||c("shiftKey",t)?(o=(s=n.getLastActive(e))?s.classList.contains("active")?n.getAdjacent(s,e,"item"):s:e>0?n.control_input.nextElementSibling:n.control_input.previousElementSibling)&&(o.classList.contains("active")&&n.removeActiveItem(s),n.setActiveItemClass(o)):n.moveCaret(e))}moveCaret(){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");return n?W(n,e):void 0}setCaret(){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){var e=this;e.input.disabled=!0,e.control_input.disabled=!0,e.focus_node.tabIndex=-1,e.isDisabled=!0,this.close(),e.lock()}enable(){var e=this;e.input.disabled=!1,e.control_input.disabled=!1,e.focus_node.tabIndex=e.tabIndex,e.isDisabled=!1,e.unlock()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,r(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(t,n){var s,r;const a=this;if("function"!=typeof this.settings.render[t])return null;if(!(s=a.settings.render[t].call(this,n,m)))return null;if(s=i(s),"option"===t||"option_create"===t?n[a.settings.disabledField]?e(s,{"aria-disabled":"true"}):e(s,{"data-selectable":""}):"optgroup"===t&&(r=n.group[a.settings.optgroupValueField],e(s,{"data-group":r}),n.group[a.settings.disabledField]&&e(s,{"data-disabled":""})),"option"===t||"item"===t){const i=p(n[a.settings.valueField]);e(s,{"data-value":i}),"item"===t?(o(s,a.settings.itemClass),e(s,{"data-ts-item":""})):(o(s,a.settings.optionClass),e(s,{role:"option",id:n.$id}),n.$div=s,a.options[i]=n)}return s}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){s(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var s=this,o=s[t];s[t]=function(){var t,i;return"after"===e&&(t=o.apply(s,arguments)),i=n.apply(s,arguments),"instead"===e?i:("before"===e&&(t=o.apply(s,arguments)),t)}}}return d.define("caret_position",function(){var e=this;e.hook("instead","setCaret",t=>{"single"!==e.settings.mode&&e.control.contains(e.control_input)?(t=Math.max(0,Math.min(e.items.length,t)))==e.caretPos||e.isPending||e.controlChildren().forEach((n,s)=>{s<t?e.control_input.insertAdjacentElement("beforebegin",n):e.control.appendChild(n)}):t=e.items.length,e.caretPos=t}),e.hook("instead","moveCaret",t=>{if(!e.isFocused)return;const n=e.getLastActive(t);if(n){const s=_(n);e.setCaret(t>0?s+1:s),e.setActiveItem(),r(n,"last-active")}else e.setCaret(e.caretPos+t)})}),d.define("dropdown_input",function(){const e=this;e.settings.shouldOpen=!0,e.hook("before","setup",()=>{e.focus_node=e.control,o(e.control_input,"dropdown-input");const t=i('<div class="dropdown-input-wrap">');t.append(e.control_input),e.dropdown.insertBefore(t,e.dropdown.firstChild);const n=i('<input class="items-placeholder" tabindex="-1" />');n.placeholder=e.settings.placeholder||"",e.control.append(n)}),e.on("initialize",()=>{e.control_input.addEventListener("keydown",n=>{switch(n.keyCode){case 27:return e.isOpen&&(t(n,!0),e.close()),void e.clearActiveItems();case 9:e.focus_node.tabIndex=-1}return e.onKeyDown.call(e,n)}),e.on("blur",()=>{e.focus_node.tabIndex=e.isDisabled?-1:e.tabIndex}),e.on("dropdown_open",()=>{e.control_input.focus()});const s=e.onBlur;e.hook("instead","onBlur",t=>{if(!t||t.relatedTarget!=e.control_input)return s.call(e)}),n(e.control_input,"blur",()=>e.onBlur()),e.hook("before","close",()=>{e.isOpen&&e.focus_node.focus({preventScroll:!0})})})}),d.define("no_backspace_delete",function(){var e=this,t=e.deleteSelection;this.hook("instead","deleteSelection",n=>!!e.activeItems.length&&t.call(e,n))}),d.define("remove_button",function(e){const o=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},e);var a,s=this;o.append&&(a='<a href="javascript:void(0)" class="'+o.className+'" tabindex="-1" title="'+m(o.title)+'">'+o.label+"</a>",s.hook("after","setupTemplates",()=>{var e=s.settings.render.item;s.settings.render.item=(o,r)=>{var c=i(e.call(s,o,r)),l=i(a);return c.appendChild(l),n(l,"mousedown",e=>{t(e,!0)}),n(l,"click",e=>{t(e,!0),s.isLocked||s.shouldDelete([c],e)&&(s.removeItem(c),s.refreshOptions(!1),s.inputState())}),c}}))}),d.define("restore_on_backspace",function(e){const t=this,n=Object.assign({text:e=>e[t.settings.labelField]},e);t.on("item_remove",function(e){if(t.isFocused&&""===t.control_input.value.trim()){var s=t.options[e];s&&t.setTextboxValue(n.text.call(t,s))}})}),d});var tomSelect=function(e,t){return new TomSelect(e,t)}