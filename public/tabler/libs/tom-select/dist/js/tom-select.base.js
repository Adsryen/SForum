(function(e,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis!="undefined"?globalThis:e||self,e.TomSelect=t())})(this,function(){"use strict";function x(e,t){e.split(/\s+/).forEach(e=>{t(e)})}class Me{constructor(){this._events=void 0,this._events={}}on(e,t){x(e,e=>{const n=this._events[e]||[];n.push(t),this._events[e]=n})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}x(e,e=>{if(n===1){delete this._events[e];return}const s=this._events[e];if(s===void 0)return;s.splice(s.indexOf(t),1),this._events[e]=s})}trigger(t,...n){var e=this;x(t,t=>{const s=e._events[t];if(s===void 0)return;s.forEach(t=>{t.apply(e,n)})})}}function Ae(e){return e.plugins={},class extends e{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(t,n){e.plugins[t]={name:t,fn:n}}initializePlugins(e){const s=this,n=[];if(Array.isArray(e))e.forEach(e=>{typeof e=="string"?n.push(e):(s.plugins.settings[e.name]=e.options,n.push(e.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(s.plugins.settings[t]=e[t],n.push(t));for(var t,o;o=n.shift();)s.require(o)}loadPlugin(t){var n=this,s=n.plugins,o=e.plugins[t];if(!e.plugins.hasOwnProperty(t))throw new Error('Unable to find "'+t+'" plugin');s.requested[t]=!0,s.loaded[t]=o.fn.apply(n,[n.plugins.settings[t]||{}]),s.names.push(t)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}const f=e=>(e=e.filter(Boolean),e.length<2?e[0]||"":Oe(e)==1?"["+e.join("")+"]":"(?:"+e.join("|")+")"),D=e=>{if(!xe(e))return e.join("");let n="",t=0;const s=()=>{t>1&&(n+="{"+t+"}")};return e.forEach((o,i)=>{if(o===e[i-1]){t++;return}s(),n+=o,t=1}),s(),n},L=e=>{let t=j(e);return f(t)},xe=e=>new Set(e).size!==e.length,u=e=>(e+"").replace(/([$()*+.?[\]^{|}\\])/gu,"\\$1"),Oe=e=>e.reduce((e,t)=>Math.max(e,je(t)),0),je=e=>j(e).length,j=e=>Array.from(e),P=e=>{if(e.length===1)return[[e]];let t=[];const n=e.substring(1),s=P(n);return s.forEach(function(n){let s=n.slice(0);s[0]=e.charAt(0)+s[0],t.push(s),s=n.slice(0),s.unshift(e.charAt(0)),t.push(s)}),t},ve=[[0,65535]],pe="[̀-ͯ·ʾʼ]";let h,V;const ee=3,b={},K={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let e in K){let t=K[e]||"";for(let n=0;n<t.length;n++){let s=t.substring(n,n+1);b[s]=e}}const me=new RegExp(Object.keys(b).join("|")+"|"+pe,"gu"),X=e=>{if(h!==void 0)return;h=G(e||ve)},U=(e,t="NFKD")=>e.normalize(t),p=e=>j(e).reduce((e,t)=>e+Q(t),""),Q=e=>(e=U(e).toLowerCase().replace(me,e=>b[e]||""),U(e,"NFC"));function*te(e){for(const[t,n]of e)for(let e=t;e<=n;e++){let o=String.fromCharCode(e),s=p(o);if(s==o.toLowerCase())continue;if(s.length>ee)continue;if(s.length==0)continue;yield{folded:s,composed:o,code_point:e}}}const ue=e=>{const t={},n=(e,n)=>{const s=t[e]||new Set,o=new RegExp("^"+L(s)+"$","iu");if(n.match(o))return;s.add(u(n)),t[e]=s};for(let t of te(e))n(t.folded,t.folded),n(t.folded,t.composed);return t},G=e=>{const n=ue(e),s={};let t=[];for(let e in n){let o=n[e];o&&(s[e]=L(o)),e.length>1&&t.push(u(e))}t.sort((e,t)=>t.length-e.length);const o=f(t);return V=new RegExp("^"+o,"u"),s},_e=(e,t=1)=>{let n=0;return e=e.map(e=>(h[e]&&(n+=e.length),h[e]||e)),n>=t?D(e):""},Ce=(e,t=1)=>(t=Math.max(t,e.length-1),f(P(e).map(e=>_e(e,t)))),N=(e,t=!0)=>{let n=e.length>1?1:0;return f(e.map(e=>{let s=[];const o=t?e.length():e.length()-1;for(let t=0;t<o;t++)s.push(Ce(e.substrs[t]||"",n));return D(s)}))},se=(e,t)=>{for(const n of t){if(n.start!=e.start||n.end!=e.end)continue;if(n.substrs.join("")!==e.substrs.join(""))continue;let s=e.parts;const o=e=>{for(const t of s){if(t.start===e.start&&t.substr===e.substr)return!1;if(e.length==1||t.length==1)continue;if(e.start<t.start&&e.end>t.start)return!0;if(t.start<e.start&&t.end>e.start)return!0}return!1};let i=n.parts.filter(o);if(i.length>0)continue;return!0}return!1};class E{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new E,o=JSON.parse(JSON.stringify(this.parts)),s=o.pop();for(const e of o)n.add(e);let i=t.substr.substring(0,e-s.start),a=i.length;return n.add({start:s.start,end:s.start+a,length:a,substr:i}),n}}const Se=e=>{X(),e=p(e);let n="",t=[new E];for(let s=0;s<e.length;s++){let c=e.substring(s),r=c.match(V);const l=e.substring(s,s+1),o=r?r[0]:null;let i=[],a=new Set;for(const e of t){const n=e.last();if(!n||n.length==1||n.end<=s)if(o){const t=o.length;e.add({start:s,end:s+t,length:t,substr:o}),a.add("1")}else e.add({start:s,end:s+1,length:1,substr:l}),a.add("2");else if(o){let t=e.clone(s,n);const a=o.length;t.add({start:s,end:s+a,length:a,substr:o}),i.push(t)}else a.add("3")}if(i.length>0){i=i.sort((e,t)=>e.length()-t.length());for(let e of i){if(se(e,t))continue;t.push(e)}continue}if(s>0&&a.size==1&&!a.has("3")){n+=N(t,!1);let e=new E;const s=t[0];s&&e.add(s.last()),t=[e]}}return n+=N(t,!0),n},ke=(e,t)=>{if(!e)return;return e[t]},Ee=(e,t)=>{if(!e)return;for(var n,s=t.split(".");(n=s.shift())&&(e=e[n]););return e},S=(e,t,n)=>{var s,o;return e?(e=e+"",t.regex==null?0:(o=e.search(t.regex),o===-1?0:(s=t.string.length/e.length,o===0&&(s+=.5),s*n))):0},A=(e,t)=>{var n=e[t];if(typeof n=="function")return n;n&&!Array.isArray(n)&&(e[t]=[n])},n=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)},be=(e,t)=>typeof e=="number"&&typeof t=="number"?e>t?1:e<t?-1:0:(e=p(e+"").toLowerCase(),t=p(t+"").toLowerCase(),e>t?1:t>e?-1:0);class ge{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const o=[],i=e.split(/\s+/);var s;return n&&(s=new RegExp("^("+Object.keys(n).map(u).join("|")+"):(.*)$")),i.forEach(e=>{let i,a=null,n=null;s&&(i=e.match(s))&&(a=i[1],e=i[2]),e.length>0&&(this.settings.diacritics?n=Se(e)||null:n=u(e),n&&t&&(n="\\b"+n)),o.push({string:e,regex:n?new RegExp(n,"iu"):null,field:a})}),o}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,s=t.length;if(!s)return function(){return 0};const r=e.options.fields,c=e.weights,o=r.length,i=e.getAttrFn;if(!o)return function(){return 1};const a=function(){return o===1?function(e,t){const n=r[0].field;return S(i(t,n),e,c[n]||1)}:function(e,t){var s=0;if(e.field){const n=i(t,e.field);!e.regex&&n?s+=1/o:s+=S(n,e,1)}else n(c,(n,o)=>{s+=S(i(t,o),e,n)});return s/o}}();return s===1?function(e){return a(t[0],e)}:e.options.conjunction==="and"?function(e){var n,o=0;for(let s of t){if(n=a(s,e),n<=0)return 0;o+=n}return o/s}:function(e){var o=0;return n(t,t=>{o+=a(t,e)}),o/s}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var s,t=[];const a=this,o=e.options,n=!e.query&&o.sort_empty?o.sort_empty:o.sort;if(typeof n=="function")return n.bind(this);const i=function(n,s){return n==="$score"?s.score:e.getAttrFn(a.items[s.id],n)};if(n)for(let s of n)(e.query||s.field!=="$score")&&t.push(s);if(e.query){s=!0;for(let e of t)if(e.field==="$score"){s=!1;break}s&&t.unshift({field:"$score",direction:"desc"})}else t=t.filter(e=>e.field!=="$score");const r=t.length;return r?function(e,n){var s,o;for(let a of t){o=a.field;let r=a.direction==="desc"?-1:1;if(s=r*be(i(o,e),i(o,n)),s)return s}return 0}:null}prepareSearch(e,t){const s={};var n=Object.assign({},t);if(A(n,"sort"),A(n,"sort_empty"),n.fields){A(n,"fields");const e=[];n.fields.forEach(t=>{typeof t=="string"&&(t={field:t,weight:1}),e.push(t),s[t.field]="weight"in t?t.weight:1}),n.fields=e}return{options:n,query:e.toLowerCase().trim(),tokens:this.tokenize(e,n.respect_word_boundaries,s),total:0,items:[],weights:s,getAttrFn:n.nesting?Ee:ke}}search(e,t){var i,o=this,s=this.prepareSearch(e,t);t=s.options,e=s.query;const r=t.score||o._getScoreFunction(s);e.length?n(o.items,(e,n)=>{i=r(e),(t.filter===!1||i>0)&&s.items.push({score:i,id:n})}):n(o.items,(e,t)=>{s.items.push({score:1,id:t})});const a=o._getSortFunction(s);return a&&s.items.sort(a),s.total=s.items.length,typeof t.limit=="number"&&(s.items=s.items.slice(0,t.limit)),s}}const d=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)},a=e=>{if(e.jquery)return e[0];if(e instanceof HTMLElement)return e;if(M(e)){var t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}return document.querySelector(e)},M=e=>typeof e=="string"&&e.indexOf("<")>-1,J=e=>e.replace(/['"\\]/g,"\\$&"),O=(e,t)=>{var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!1),e.dispatchEvent(n)},m=(e,t)=>{Object.assign(e.style,t)},o=(e,...t)=>{var n=F(t);e=q(e),e.map(e=>{n.map(t=>{e.classList.add(t)})})},r=(e,...t)=>{var n=F(t);e=q(e),e.map(e=>{n.map(t=>{e.classList.remove(t)})})},F=e=>{var t=[];return d(e,e=>{typeof e=="string"&&(e=e.trim().split(/[\11\12\14\15\40]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},q=e=>(Array.isArray(e)||(e=[e]),e),_=(e,t,n)=>{if(n&&!n.contains(e))return;for(;e&&e.matches;){if(e.matches(t))return e;e=e.parentNode}},W=(e,t=0)=>t>0?e[e.length-1]:e[0],Z=e=>Object.keys(e).length===0,$=(e,t)=>{if(!e)return-1;t=t||e.nodeName;for(var n=0;e=e.previousElementSibling;)e.matches(t)&&n++;return n},e=(e,t)=>{d(t,(t,n)=>{t==null?e.removeAttribute(n):e.setAttribute(n,""+t)})},w=(e,t)=>{e.parentNode&&e.parentNode.replaceChild(t,e)},ne=(e,t)=>{if(t===null)return;if(typeof t=="string"){if(!t.length)return;t=new RegExp(t,"i")}const s=e=>{var n,s,i,o=e.data.match(t);return o&&e.data.length>0?(n=document.createElement("span"),n.className="highlight",s=e.splitText(o.index),s.splitText(o[0].length),i=s.cloneNode(!0),n.appendChild(i),w(s,n),1):0},o=e=>{e.nodeType===1&&e.childNodes&&!/(script|style)/i.test(e.tagName)&&(e.className!=="highlight"||e.tagName!=="SPAN")&&Array.from(e.childNodes).forEach(e=>{n(e)})},n=e=>e.nodeType===3?s(e):(o(e),0);n(e)},Y=e=>{var t=e.querySelectorAll("span.highlight");Array.prototype.forEach.call(t,function(e){var t=e.parentNode;t.replaceChild(e.firstChild,e),t.normalize()})},oe=65,ie=13,ae=27,re=37,ce=38,le=39,de=40,B=8,he=46,I=9,fe=typeof navigator!="undefined"&&/Mac/.test(navigator.userAgent),v=fe?"metaKey":"ctrlKey";var k,H={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(e){return e.length>0},render:{}};const i=e=>typeof e=="undefined"||e===null?null:g(e),g=e=>typeof e=="boolean"?e?"1":"0":e+"",y=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),ye=(e,t)=>{var n;return function(s,o){var i=this;n&&(i.loading=Math.max(i.loading-1,0),clearTimeout(n)),n=setTimeout(function(){n=null,i.loadedSearches[s]=!0,e.call(i,s,o)},t)}},R=(e,t,n)=>{var s,o=e.trigger,i={};e.trigger=function(){var n=arguments[0];if(t.indexOf(n)!==-1)i[n]=arguments;else return o.apply(e,arguments)},n.apply(e,[]),e.trigger=o;for(s of t)s in i&&o.apply(e,i[s])},we=e=>({start:e.selectionStart||0,length:(e.selectionEnd||0)-(e.selectionStart||0)}),t=(e,t=!1)=>{e&&(e.preventDefault(),t&&e.stopPropagation())},s=(e,t,n,s)=>{e.addEventListener(t,n,s)},l=(e,t)=>{if(!t)return!1;if(!t[e])return!1;var n=(t.altKey?1:0)+(t.ctrlKey?1:0)+(t.shiftKey?1:0)+(t.metaKey?1:0);return n===1},C=(e,t)=>{const n=e.getAttribute("id");return n||(e.setAttribute("id",t),t)},z=e=>e.replace(/[\\"']/g,"\\$&"),c=(e,t)=>{t&&e.append(t)};function T(e,t){var n,f,p,s=Object.assign({},H,t),h=s.dataAttr,u=s.labelField,a=s.valueField,r=s.disabledField,o=s.optgroupField,m=s.optgroupLabelField,l=s.optgroupValueField,g=e.tagName.toLowerCase(),c=e.getAttribute("placeholder")||e.getAttribute("data-placeholder");if(!c&&!s.allowEmptyOption){let t=e.querySelector('option[value=""]');t&&(c=t.textContent)}return n={placeholder:c,options:[],optgroups:[],items:[],maxItems:null},f=()=>{var c,g=n.options,t={},v=1,f=e=>{var t=Object.assign({},e.dataset),n=h&&t[h];return typeof n=="string"&&n.length&&(t=Object.assign(t,JSON.parse(n))),t},p=(e,c)=>{var l,h,d=i(e.value);if(d==null)return;if(!d&&!s.allowEmptyOption)return;t.hasOwnProperty(d)?c&&(h=t[d][o],h?Array.isArray(h)?h.push(c):t[d][o]=[h,c]:t[d][o]=c):(l=f(e),l[u]=l[u]||e.textContent,l[a]=l[a]||d,l[r]=l[r]||e.disabled,l[o]=l[o]||c,l.$option=e,t[d]=l,g.push(l)),e.selected&&n.items.push(d)},b=e=>{var s,t=f(e);t[m]=t[m]||e.getAttribute("label")||"",t[l]=t[l]||v++,t[r]=t[r]||e.disabled,n.optgroups.push(t),s=t[l],d(e.children,e=>{p(e,s)})};n.maxItems=e.hasAttribute("multiple")?null:1,d(e.children,e=>{c=e.tagName.toLowerCase(),c==="optgroup"?b(e):c==="option"&&p(e)})},p=()=>{const t=e.getAttribute(h);if(t)n.options=JSON.parse(t),d(n.options,e=>{n.items.push(e[a])});else{var o=e.value.trim()||"";if(!s.allowEmptyOption&&!o.length)return;const t=o.split(s.delimiter);d(t,e=>{const t={};t[u]=e,t[a]=e,n.options.push(t)}),n.items=t}},g==="select"?f():p(),Object.assign({},H,n,t)}k=0;class Fe extends Ae(Me){constructor(t,s){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],k++;var l,d,p,b,j,r=a(t);if(r.tomselect)throw new Error("Tom Select already initialized on this element");r.tomselect=this,b=window.getComputedStyle&&window.getComputedStyle(r,null),p=b.getPropertyValue("direction");const i=T(r,s);this.settings=i,this.input=r,this.tabIndex=r.tabIndex||0,this.is_select_tag=r.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(p),this.inputId=C(r,"tomselect-"+k),this.isRequired=r.required,this.sifter=new ge(this.options,{diacritics:i.diacritics}),i.mode=i.mode||(i.maxItems===1?"single":"multi"),typeof i.hideSelected!="boolean"&&(i.hideSelected=i.mode==="multi"),typeof i.hidePlaceholder!="boolean"&&(i.hidePlaceholder=i.mode!=="multi"),d=i.createFilter,typeof d!="function"&&(typeof d=="string"&&(d=new RegExp(d)),d instanceof RegExp?i.createFilter=e=>d.test(e):i.createFilter=e=>this.settings.duplicates||!this.options[e]),this.initializePlugins(i.plugins),this.setupCallbacks(),this.setupTemplates();const m=a("<div>"),u=a("<div>"),h=this._render("dropdown"),f=a(`<div role="listbox" tabindex="-1">`),g=this.input.getAttribute("class")||"",v=i.mode;o(m,i.wrapperClass,g,v),o(u,i.controlClass),c(m,u),o(h,i.dropdownClass,v),i.copyClassesToDropdown&&o(h,g),o(f,i.dropdownContentClass),c(h,f),a(i.dropdownParent||m).appendChild(h),M(i.controlInput)?(l=a(i.controlInput),j=["autocorrect","autocapitalize","autocomplete"],n(j,t=>{r.getAttribute(t)&&e(l,{[t]:r.getAttribute(t)})}),l.tabIndex=-1,u.appendChild(l),this.focus_node=l):i.controlInput?(l=a(i.controlInput),this.focus_node=l):(l=a("<input/>"),this.focus_node=u),this.wrapper=m,this.dropdown=h,this.dropdown_content=f,this.control=u,this.control_input=l,this.setup()}setup(){const n=this,i=n.settings,c=n.control_input,l=n.dropdown,f=n.dropdown_content,m=n.wrapper,j=n.control,a=n.input,d=n.focus_node,g={passive:!0},p=n.inputId+"-ts-dropdown";e(f,{id:p}),e(d,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":p});const y=C(d,n.inputId+"-ts-control"),w="label[for='"+J(n.inputId)+"']",r=document.querySelector(w),v=n.focus.bind(n);if(r){s(r,"click",v),e(r,{for:y});const t=C(r,n.inputId+"-ts-label");e(d,{"aria-labelledby":t}),e(f,{"aria-labelledby":t})}if(m.style.width=a.style.width,n.plugins.names.length){const e="plugin-"+n.plugins.names.join(" plugin-");o([m,l],e)}(i.maxItems===null||i.maxItems>1)&&n.is_select_tag&&e(a,{multiple:"multiple"}),i.placeholder&&e(c,{placeholder:i.placeholder}),!i.splitOn&&i.delimiter&&(i.splitOn=new RegExp("\\s*"+u(i.delimiter)+"+\\s*")),i.load&&i.loadThrottle&&(i.load=ye(i.load,i.loadThrottle)),n.control_input.type=a.type,s(l,"mousemove",()=>{n.ignoreHover=!1}),s(l,"mouseenter",e=>{var t=_(e.target,"[data-selectable]",l);t&&n.onOptionHover(e,t)},{capture:!0}),s(l,"click",e=>{const s=_(e.target,"[data-selectable]");s&&(n.onOptionSelect(e,s),t(e,!0))}),s(j,"click",e=>{var s=_(e.target,"[data-ts-item]",j);if(s&&n.onItemSelect(e,s)){t(e,!0);return}if(c.value!="")return;n.onClick(),t(e,!0)}),s(d,"keydown",e=>n.onKeyDown(e)),s(c,"keypress",e=>n.onKeyPress(e)),s(c,"input",e=>n.onInput(e)),s(d,"blur",e=>n.onBlur(e)),s(d,"focus",e=>n.onFocus(e)),s(c,"paste",e=>n.onPaste(e));const b=e=>{const s=e.composedPath()[0];if(!m.contains(s)&&!l.contains(s)){n.isFocused&&n.blur(),n.inputState();return}s==c&&n.isOpen?e.stopPropagation():t(e,!0)},h=()=>{n.isOpen&&n.positionDropdown()};s(document,"mousedown",b),s(window,"scroll",h,g),s(window,"resize",h,g),this._destroy=()=>{document.removeEventListener("mousedown",b),window.removeEventListener("scroll",h),window.removeEventListener("resize",h),r&&r.removeEventListener("click",v)},this.revertSettings={innerHTML:a.innerHTML,tabIndex:a.tabIndex},a.tabIndex=-1,a.insertAdjacentElement("afterend",n.wrapper),n.sync(!1),i.items=[],delete i.optgroups,delete i.options,s(a,"invalid",()=>{n.isValid&&(n.isValid=!1,n.isInvalid=!0,n.refreshState())}),n.updateOriginalInput(),n.refreshItems(),n.close(!1),n.inputState(),n.isSetup=!0,a.disabled?n.disable():n.enable(),n.on("change",this.onChange),o(a,"tomselected","ts-hidden-accessible"),n.trigger("initialize"),i.preload===!0&&n.preload()}setupOptions(e=[],t=[]){this.addOptions(e),n(t,e=>{this.registerOptionGroup(e)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,s={optgroup:e=>{let t=document.createElement("div");return t.className="optgroup",t.appendChild(e.options),t},optgroup_header:(e,t)=>'<div class="optgroup-header">'+t(e[n])+"</div>",option:(e,n)=>"<div>"+n(e[t])+"</div>",item:(e,n)=>"<div>"+n(e[t])+"</div>",option_create:(e,t)=>'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},s,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?T(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){O(this.input,"input"),O(this.input,"change")}onPaste(e){var s=this;if(s.isInputHidden||s.isLocked){t(e);return}if(!s.settings.splitOn)return;setTimeout(()=>{var t,e=s.inputValue();if(!e.match(s.settings.splitOn))return;t=e.trim().split(s.settings.splitOn),n(t,e=>{const t=i(e);t&&(this.options[e]?s.addItem(e):s.createItem(e))})},0)}onKeyPress(e){var s,n=this;if(n.isLocked){t(e);return}if(s=String.fromCharCode(e.keyCode||e.which),n.settings.create&&n.settings.mode==="multi"&&s===n.settings.delimiter){n.createItem(),t(e);return}}onKeyDown(e){var n=this;if(n.ignoreHover=!0,n.isLocked){e.keyCode!==I&&t(e);return}switch(e.keyCode){case oe:if(l(v,e)&&n.control_input.value==""){t(e),n.selectAll();return}break;case ae:n.isOpen&&(t(e,!0),n.close()),n.clearActiveItems();return;case de:if(!n.isOpen&&n.hasOptions)n.open();else if(n.activeOption){let e=n.getAdjacent(n.activeOption,1);e&&n.setActiveOption(e)}t(e);return;case ce:if(n.activeOption){let e=n.getAdjacent(n.activeOption,-1);e&&n.setActiveOption(e)}t(e);return;case ie:n.canSelect(n.activeOption)?(n.onOptionSelect(e,n.activeOption),t(e)):n.settings.create&&n.createItem()?t(e):document.activeElement==n.control_input&&n.isOpen&&t(e);return;case re:n.advanceSelection(-1,e);return;case le:n.advanceSelection(1,e);return;case I:n.settings.selectOnTab&&(n.canSelect(n.activeOption)&&(n.onOptionSelect(e,n.activeOption),t(e)),n.settings.create&&n.createItem()&&t(e));return;case B:case he:n.deleteSelection(e);return}n.isInputHidden&&!l(v,e)&&t(e)}onInput(){var n,t=this;if(t.isLocked)return;n=t.inputValue(),t.lastValue!==n&&(t.lastValue=n,t.settings.shouldLoad.call(t,n)&&t.load(n),t.refreshOptions(),t.trigger("type",n))}onOptionHover(e,t){if(this.ignoreHover)return;this.setActiveOption(t,!1)}onFocus(e){var n=this,s=n.isFocused;if(n.isDisabled){n.blur(),t(e);return}if(n.ignoreFocus)return;n.isFocused=!0,n.settings.preload==="focus"&&n.preload(),s||n.trigger("focus"),n.activeItems.length||(n.showInput(),n.refreshOptions(!!n.settings.openOnFocus)),n.refreshState()}onBlur(){if(document.hasFocus()===!1)return;var n,t=this;if(!t.isFocused)return;t.isFocused=!1,t.ignoreFocus=!1,n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")},t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}onOptionSelect(e,t){var s,n=this;if(t.parentElement&&t.parentElement.matches("[data-disabled]"))return;t.classList.contains("create")?n.createItem(null,()=>{n.settings.closeAfterSelect&&n.close()}):(s=t.dataset.value,typeof s!="undefined"&&(n.lastQuery=null,n.addItem(s),n.settings.closeAfterSelect&&n.close(),!n.settings.hideSelected&&e.type&&/click/.test(e.type)&&n.setActiveOption(t)))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,n){var s=this;return!s.isLocked&&s.settings.mode==="multi"&&(t(e),s.setActiveItem(n,e),!0)}canLoad(e){return!!this.settings.load&&!this.loadedSearches.hasOwnProperty(e)}load(e){const t=this;if(!t.canLoad(e))return;o(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||r(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;if(e.contains("preloaded"))return;e.add("preloaded"),this.load("")}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,O(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];R(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,n){var o,i,a,r,c,d,s=this;if(s.settings.mode==="single")return;if(!e){s.clearActiveItems(),s.isFocused&&s.showInput();return}if(a=n&&n.type.toLowerCase(),a==="click"&&l("shiftKey",n)&&s.activeItems.length){d=s.getLastActive(),o=Array.prototype.indexOf.call(s.control.children,d),i=Array.prototype.indexOf.call(s.control.children,e),o>i&&(c=o,o=i,i=c);for(r=o;r<=i;r++)e=s.control.children[r],s.activeItems.indexOf(e)===-1&&s.setActiveItemClass(e);t(n)}else a==="click"&&l(v,n)||a==="keydown"&&l("shiftKey",n)?e.classList.contains("active")?s.removeActiveItem(e):s.setActiveItemClass(e):(s.clearActiveItems(),s.setActiveItemClass(e));s.hideInput(),s.isFocused||s.focus()}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&r(n,"last-active"),o(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),r(e,"active")}clearActiveItems(){r(this.activeItems,"active"),this.activeItems=[]}setActiveOption(t,n=!0){if(t===this.activeOption)return;if(this.clearActiveOption(),!t)return;this.activeOption=t,e(this.focus_node,{"aria-activedescendant":t.getAttribute("id")}),e(t,{"aria-selected":"true"}),o(t,"active"),n&&this.scrollToOption(t)}scrollToOption(e,t){if(!e)return;const s=this.dropdown_content,i=s.clientHeight,o=s.scrollTop||0,a=e.offsetHeight,n=e.getBoundingClientRect().top-s.getBoundingClientRect().top+o;n+a>i+o?this.scroll(n-i+a,t):n<o&&this.scroll(n,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(r(this.activeOption,"active"),e(this.activeOption,{"aria-selected":null})),this.activeOption=null,e(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();if(!t.length)return;e.hideInput(),e.close(),e.activeItems=t,n(t,t=>{e.setActiveItemClass(t)})}inputState(){var t=this;if(!t.control.contains(t.control_input))return;e(t.control_input,{placeholder:t.settings.placeholder}),t.activeItems.length>0||!t.isFocused&&t.settings.hidePlaceholder&&t.items.length>0?(t.setTextboxValue(),t.isInputHidden=!0):(t.settings.hidePlaceholder&&t.items.length>0&&e(t.control_input,{placeholder:""}),t.isInputHidden=!1),t.wrapper.classList.toggle("input-hidden",t.isInputHidden)}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var e=this;if(e.isDisabled)return;e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0)}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var n,s,t=this,o=this.getSearchOptions();if(t.settings.score&&(s=t.settings.score.call(t,e),typeof s!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==t.lastQuery?(t.lastQuery=e,n=t.sifter.search(e,Object.assign(o,{score:s})),t.currentResults=n):n=Object.assign({},t.currentResults),t.settings.hideSelected&&(n.items=n.items.filter(e=>{let n=i(e.id);return!n||t.items.indexOf(n)===-1})),n}refreshOptions(t=!0){const y={},_=[];var o,i,a,l,d,h,m,f,p,v,b,j,w,O,x,s=this,u=s.inputValue();const C=u===s.lastQuery||u==""&&s.lastQuery==null;a=s.search(u),o=null,b=s.settings.shouldOpen||!1,l=s.dropdown_content,C&&(o=s.activeOption,o&&(w=o.closest("[data-group]"))),m=a.items.length,typeof s.settings.maxOptions=="number"&&(m=Math.min(m,s.settings.maxOptions)),m>0&&(b=!0);for(j=0;j<m;j++){let l=a.items[j];if(!l)continue;let n=l.id,c=s.options[n];if(c===void 0)continue;let u=g(n),t=s.getOption(u,!0);s.settings.hideSelected||t.classList.toggle("selected",s.items.includes(u)),i=c[s.settings.optgroupField]||"",f=Array.isArray(i)?i:[i];for(d=0,x=f&&f.length;d<x;d++){i=f[d],s.optgroups.hasOwnProperty(i)||(i="");let a=y[i];a===void 0&&(a=document.createDocumentFragment(),_.push(i)),d>0&&(t=t.cloneNode(!0),e(t,{id:c.$id+"-clone-"+d,"aria-selected":null}),t.classList.add("ts-cloned"),r(t,"active"),s.activeOption&&s.activeOption.dataset.value==n&&w&&w.dataset.group===i.toString()&&(o=t)),a.appendChild(t),y[i]=a}}if(s.settings.lockOptgroupOrder&&_.sort((e,t)=>{const n=s.optgroups[e],o=s.optgroups[t],i=n&&n.$order||0,a=o&&o.$order||0;return i-a}),v=document.createDocumentFragment(),n(_,e=>{let t=y[e];if(!t||!t.children.length)return;let n=s.optgroups[e];if(n!==void 0){let e=document.createDocumentFragment(),o=s.render("optgroup_header",n);c(e,o),c(e,t);let i=s.render("optgroup",{group:n,options:e});c(v,i)}else c(v,t)}),l.innerHTML="",c(l,v),s.settings.highlight&&(Y(l),a.query.length&&a.tokens.length&&n(a.tokens,e=>{ne(l,e.regex)})),h=e=>{let t=s.render(e,{input:u});return t&&(b=!0,l.insertBefore(t,l.firstChild)),t},s.loading?h("loading"):s.settings.shouldLoad.call(s,u)?a.items.length===0&&h("no_results"):h("not_loading"),O=s.canCreate(u),O&&(p=h("option_create")),s.hasOptions=a.items.length>0||O,b){if(a.items.length>0){if(!o&&s.settings.mode==="single"&&s.items[0]!=void 0&&(o=s.getOption(s.items[0])),!l.contains(o)){let e=0;p&&!s.settings.addPrecedence&&(e=1),o=s.selectable()[e]}}else p&&(o=p);t&&!s.isOpen&&(s.open(),s.scrollToOption(o,"auto")),s.setActiveOption(o)}else s.clearActiveOption(),t&&s.isOpen&&s.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const s=i(e[n.settings.valueField]);return s!==null&&!n.options.hasOwnProperty(s)&&(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[s]=e,n.lastQuery=null,t&&(n.userOptions[s]=t,n.trigger("option_add",s,e)),s)}addOptions(e,t=!1){n(e,e=>{this.addOption(e,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=i(e[this.settings.optgroupValueField]);return t!==null&&(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var c,l;const s=i(e),r=i(t[n.settings.valueField]);if(s===null)return;const u=n.options[s];if(u==null)return;if(typeof r!="string")throw new Error("Value must be set in option data");const a=n.getOption(s),d=n.getItem(s);if(t.$order=t.$order||u.$order,delete n.options[s],n.uncacheValue(r),n.options[r]=t,a){if(n.dropdown_content.contains(a)){const e=n._render("option",t);w(a,e),n.activeOption===a&&n.setActiveOption(e)}a.remove()}d&&(l=n.items.indexOf(s),l!==-1&&n.items.splice(l,1,r),c=n._render("item",t),d.classList.contains("active")&&o(c,"active"),w(d,c)),n.lastQuery=null}removeOption(e,t){const n=this;e=g(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const s=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const t={};n(this.options,(e,n)=>{s(e,n)&&(t[n]=e)}),this.options=this.sifter.items=t,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const s=i(e);if(s===null)return null;const n=this.options[s];if(n!=null){if(n.$div)return n.$div;if(t)return this._render("option",n)}return null}getAdjacent(e,t,n="option"){var s,o=this;if(!e)return null;n=="item"?s=o.controlChildren():s=o.dropdown_content.querySelectorAll("[data-selectable]");for(let n=0;n<s.length;n++){if(s[n]!=e)continue;return t>0?s[n+1]:s[n-1]}return null}getItem(e){if(typeof e=="object")return e;var t=i(e);return t!==null?this.control.querySelector(`[data-value="${z(t)}"]`):null}addItems(e,t){var s=this,n=Array.isArray(e)?e:[e],n=n.filter(e=>s.items.indexOf(e)===-1);const o=n[n.length-1];n.forEach(e=>{s.isPending=e!==o,s.addItem(e,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];R(this,n,()=>{var o,r;const n=this,a=n.settings.mode,s=i(e);if(s&&n.items.indexOf(s)!==-1&&(a==="single"&&n.close(),a==="single"||!n.settings.duplicates))return;if(s===null||!n.options.hasOwnProperty(s))return;if(a==="single"&&n.clear(t),a==="multi"&&n.isFull())return;if(o=n._render("item",n.options[s]),n.control.contains(o)&&(o=o.cloneNode(!0)),r=n.isFull(),n.items.splice(n.caretPos,0,s),n.insertAtCaret(o),n.isSetup){if(!n.isPending&&n.settings.hideSelected){let t=n.getOption(s),e=n.getAdjacent(t,1);e&&n.setActiveOption(e)}!n.isPending&&!n.settings.closeAfterSelect&&n.refreshOptions(n.isFocused&&a!=="single"),n.settings.closeAfterSelect!=!1&&n.isFull()?n.close():n.isPending||n.positionDropdown(),n.trigger("item_add",s,o),n.isPending||n.updateOriginalInput({silent:t})}(!n.isPending||!r&&n.isFull())&&(n.inputState(),n.refreshState())})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var s,i;const o=e.dataset.value;s=$(e),e.remove(),e.classList.contains("active")&&(i=n.activeItems.indexOf(e),n.activeItems.splice(i,1),r(e,"active")),n.items.splice(s,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(o)&&n.removeOption(o,t),s<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",o,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var s,o,a,n=this,r=n.caretPos;return e=e||n.inputValue(),n.canCreate(e)?(n.lock(),o=!1,a=e=>{if(n.unlock(),!e||typeof e!="object")return t();var s=i(e[n.settings.valueField]);if(typeof s!="string")return t();n.setTextboxValue(),n.addOption(e,!0),n.setCaret(r),n.addItem(s),t(e),o=!0},typeof n.settings.create=="function"?s=n.settings.create.call(this,e,a):s={[n.settings.labelField]:e,[n.settings.valueField]:e},o||a(s),!0):(t(),!1)}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const n=e.isFull(),s=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const t=e.wrapper.classList;t.toggle("focus",e.isFocused),t.toggle("disabled",e.isDisabled),t.toggle("required",e.isRequired),t.toggle("invalid",!e.isValid),t.toggle("locked",s),t.toggle("full",n),t.toggle("input-active",e.isFocused&&!e.isInputHidden),t.toggle("dropdown-active",e.isOpen),t.toggle("has-options",Z(e.options)),t.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;if(!e.input.validity)return;e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,s;const o=t.input.querySelector('option[value=""]');if(t.is_select_tag){const e=[],r=t.input.querySelectorAll("option:checked").length;function i(n,s,i){return n||(n=a('<option value="'+y(s)+'">'+y(i)+"</option>")),n!=o&&t.input.append(n),e.push(n),(n!=o||r>0)&&(n.selected=!0),n}t.input.querySelectorAll("option:checked").forEach(e=>{e.selected=!1}),t.items.length==0&&t.settings.mode=="single"?i(o,"",""):t.items.forEach(o=>{if(n=t.options[o],s=n[t.settings.labelField]||"",e.includes(n.$option)){const e=t.input.querySelector(`option[value="${z(o)}"]:not(:checked)`);i(e,o,s)}else n.$option=i(n.$option,o,s)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var t=this;if(t.isLocked||t.isOpen||t.settings.mode==="multi"&&t.isFull())return;t.isOpen=!0,e(t.focus_node,{"aria-expanded":"true"}),t.refreshState(),m(t.dropdown,{visibility:"hidden",display:"block"}),t.positionDropdown(),m(t.dropdown,{visibility:"visible",display:"block"}),t.focus(),t.trigger("dropdown_open",t.dropdown)}close(t=!0){var n=this,s=n.isOpen;t&&(n.setTextboxValue(),n.settings.mode==="single"&&n.items.length&&n.hideInput()),n.isOpen=!1,e(n.focus_node,{"aria-expanded":"false"}),m(n.dropdown,{display:"none"}),n.settings.hideSelected&&n.clearActiveOption(),n.refreshState(),s&&n.trigger("dropdown_close",n.dropdown)}positionDropdown(){if(this.settings.dropdownParent!=="body")return;var t=this.control,e=t.getBoundingClientRect(),n=t.offsetHeight+e.top+window.scrollY,s=e.left+window.scrollX;m(this.dropdown,{width:e.width+"px",top:n+"px",left:s+"px"})}clear(e){var s,t=this;if(!t.items.length)return;s=t.controlChildren(),n(s,e=>{t.removeItem(e,!0)}),t.showInput(),e||t.updateOriginalInput(),t.trigger("clear")}insertAtCaret(e){const t=this,n=t.caretPos,s=t.control;s.insertBefore(e,s.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var a,c,s=this,i=e&&e.keyCode===B?-1:1,r=we(s.control_input);const o=[];if(s.activeItems.length)c=W(s.activeItems,i),a=$(c),i>0&&a++,n(s.activeItems,e=>o.push(e));else if((s.isFocused||s.settings.mode==="single")&&s.items.length){const t=s.controlChildren();let e;i<0&&r.start===0&&r.length===0?e=t[s.caretPos-1]:i>0&&r.start===s.inputValue().length&&(e=t[s.caretPos]),e!==void 0&&o.push(e)}if(!s.shouldDelete(o,e))return!1;for(t(e,!0),typeof a!="undefined"&&s.setCaret(a);o.length;)s.removeItem(o.pop());return s.showInput(),s.positionDropdown(),s.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(e=>e.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var s,o,n=this;if(n.rtl&&(e*=-1),n.inputValue().length)return;l(v,t)||l("shiftKey",t)?(o=n.getLastActive(e),o?o.classList.contains("active")?s=n.getAdjacent(o,e,"item"):s=o:e>0?s=n.control_input.nextElementSibling:s=n.control_input.previousElementSibling,s&&(s.classList.contains("active")&&n.removeActiveItem(o),n.setActiveItemClass(s))):n.moveCaret(e)}moveCaret(){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return W(n,e)}setCaret(){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){var e=this;e.input.disabled=!0,e.control_input.disabled=!0,e.focus_node.tabIndex=-1,e.isDisabled=!0,this.close(),e.lock()}enable(){var e=this;e.input.disabled=!1,e.control_input.disabled=!1,e.focus_node.tabIndex=e.tabIndex,e.isDisabled=!1,e.unlock()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,r(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(t,n){var s,r;const i=this;if(typeof this.settings.render[t]!="function")return null;if(s=i.settings.render[t].call(this,n,y),!s)return null;if(s=a(s),t==="option"||t==="option_create"?n[i.settings.disabledField]?e(s,{"aria-disabled":"true"}):e(s,{"data-selectable":""}):t==="optgroup"&&(r=n.group[i.settings.optgroupValueField],e(s,{"data-group":r}),n.group[i.settings.disabledField]&&e(s,{"data-disabled":""})),t==="option"||t==="item"){const a=g(n[i.settings.valueField]);e(s,{"data-value":a}),t==="item"?(o(s,i.settings.itemClass),e(s,{"data-ts-item":""})):(o(s,i.settings.optionClass),e(s,{role:"option",id:n.$id}),n.$div=s,i.options[a]=n)}return s}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){n(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var s=this,o=s[t];s[t]=function(){var t,i;return e==="after"&&(t=o.apply(s,arguments)),i=n.apply(s,arguments),e==="instead"?i:(e==="before"&&(t=o.apply(s,arguments)),t)}}}return Fe});var tomSelect=function(e,t){return new TomSelect(e,t)}