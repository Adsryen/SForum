(function(e,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis!="undefined"?globalThis:e||self,e.TomSelect=t())})(this,function(){"use strict";function w(e,t){e.split(/\s+/).forEach(e=>{t(e)})}class Te{constructor(){this._events=void 0,this._events={}}on(e,t){w(e,e=>{const n=this._events[e]||[];n.push(t),this._events[e]=n})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}w(e,e=>{if(n===1){delete this._events[e];return}const s=this._events[e];if(s===void 0)return;s.splice(s.indexOf(t),1),this._events[e]=s})}trigger(t,...n){var e=this;w(t,t=>{const s=e._events[t];if(s===void 0)return;s.forEach(t=>{t.apply(e,n)})})}}function Fe(e){return e.plugins={},class extends e{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(t,n){e.plugins[t]={name:t,fn:n}}initializePlugins(e){const s=this,n=[];if(Array.isArray(e))e.forEach(e=>{typeof e=="string"?n.push(e):(s.plugins.settings[e.name]=e.options,n.push(e.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(s.plugins.settings[t]=e[t],n.push(t));for(var t,o;o=n.shift();)s.require(o)}loadPlugin(t){var n=this,s=n.plugins,o=e.plugins[t];if(!e.plugins.hasOwnProperty(t))throw new Error('Unable to find "'+t+'" plugin');s.requested[t]=!0,s.loaded[t]=o.fn.apply(n,[n.plugins.settings[t]||{}]),s.names.push(t)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}const v=e=>(e=e.filter(Boolean),e.length<2?e[0]||"":Se(e)==1?"["+e.join("")+"]":"(?:"+e.join("|")+")"),Y=e=>{if(!Me(e))return e.join("");let n="",t=0;const s=()=>{t>1&&(n+="{"+t+"}")};return e.forEach((o,i)=>{if(o===e[i-1]){t++;return}s(),n+=o,t=1}),s(),n},q=e=>{let t=k(e);return v(t)},Me=e=>new Set(e).size!==e.length,h=e=>(e+"").replace(/([$()*+.?[\]^{|}\\])/gu,"\\$1"),Se=e=>e.reduce((e,t)=>Math.max(e,Ae(t)),0),Ae=e=>k(e).length,k=e=>Array.from(e),I=e=>{if(e.length===1)return[[e]];let t=[];const n=e.substring(1),s=I(n);return s.forEach(function(n){let s=n.slice(0);s[0]=e.charAt(0)+s[0],t.push(s),s=n.slice(0),s.unshift(e.charAt(0)),t.push(s)}),t},ke=[[0,65535]],Ee="[̀-ͯ·ʾʼ]";let f,H;const Ce=3,E={},R={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let e in R){let t=R[e]||"";for(let n=0;n<t.length;n++){let s=t.substring(n,n+1);E[s]=e}}const xe=new RegExp(Object.keys(E).join("|")+"|"+Ee,"gu"),we=e=>{if(f!==void 0)return;f=be(e||ke)},U=(e,t="NFKD")=>e.normalize(t),p=e=>k(e).reduce((e,t)=>e+ye(t),""),ye=e=>(e=U(e).toLowerCase().replace(xe,e=>E[e]||""),U(e,"NFC"));function*je(e){for(const[t,n]of e)for(let e=t;e<=n;e++){let o=String.fromCharCode(e),s=p(o);if(s==o.toLowerCase())continue;if(s.length>Ce)continue;if(s.length==0)continue;yield{folded:s,composed:o,code_point:e}}}const J=e=>{const t={},n=(e,n)=>{const s=t[e]||new Set,o=new RegExp("^"+q(s)+"$","iu");if(n.match(o))return;s.add(h(n)),t[e]=s};for(let t of je(e))n(t.folded,t.folded),n(t.folded,t.composed);return t},be=e=>{const n=J(e),s={};let t=[];for(let e in n){let o=n[e];o&&(s[e]=q(o)),e.length>1&&t.push(h(e))}t.sort((e,t)=>t.length-e.length);const o=v(t);return H=new RegExp("^"+o,"u"),s},ve=(e,t=1)=>{let n=0;return e=e.map(e=>(f[e]&&(n+=e.length),f[e]||e)),n>=t?Y(e):""},ge=(e,t=1)=>(t=Math.max(t,e.length-1),v(I(e).map(e=>ve(e,t)))),N=(e,t=!0)=>{let n=e.length>1?1:0;return v(e.map(e=>{let s=[];const o=t?e.length():e.length()-1;for(let t=0;t<o;t++)s.push(ge(e.substrs[t]||"",n));return Y(s)}))},fe=(e,t)=>{for(const n of t){if(n.start!=e.start||n.end!=e.end)continue;if(n.substrs.join("")!==e.substrs.join(""))continue;let s=e.parts;const o=e=>{for(const t of s){if(t.start===e.start&&t.substr===e.substr)return!1;if(e.length==1||t.length==1)continue;if(e.start<t.start&&e.end>t.start)return!0;if(t.start<e.start&&t.end>e.start)return!0}return!1};let i=n.parts.filter(o);if(i.length>0)continue;return!0}return!1};class F{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new F,o=JSON.parse(JSON.stringify(this.parts)),s=o.pop();for(const e of o)n.add(e);let i=t.substr.substring(0,e-s.start),a=i.length;return n.add({start:s.start,end:s.start+a,length:a,substr:i}),n}}const he=e=>{we(),e=p(e);let n="",t=[new F];for(let s=0;s<e.length;s++){let c=e.substring(s),r=c.match(H);const l=e.substring(s,s+1),o=r?r[0]:null;let i=[],a=new Set;for(const e of t){const n=e.last();if(!n||n.length==1||n.end<=s)if(o){const t=o.length;e.add({start:s,end:s+t,length:t,substr:o}),a.add("1")}else e.add({start:s,end:s+1,length:1,substr:l}),a.add("2");else if(o){let t=e.clone(s,n);const a=o.length;t.add({start:s,end:s+a,length:a,substr:o}),i.push(t)}else a.add("3")}if(i.length>0){i=i.sort((e,t)=>e.length()-t.length());for(let e of i){if(fe(e,t))continue;t.push(e)}continue}if(s>0&&a.size==1&&!a.has("3")){n+=N(t,!1);let e=new F;const s=t[0];s&&e.add(s.last()),t=[e]}}return n+=N(t,!0),n},de=(e,t)=>{if(!e)return;return e[t]},ce=(e,t)=>{if(!e)return;for(var n,s=t.split(".");(n=s.shift())&&(e=e[n]););return e},T=(e,t,n)=>{var s,o;return e?(e=e+"",t.regex==null?0:(o=e.search(t.regex),o===-1?0:(s=t.string.length/e.length,o===0&&(s+=.5),s*n))):0},S=(e,t)=>{var n=e[t];if(typeof n=="function")return n;n&&!Array.isArray(n)&&(e[t]=[n])},i=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)},re=(e,t)=>typeof e=="number"&&typeof t=="number"?e>t?1:e<t?-1:0:(e=p(e+"").toLowerCase(),t=p(t+"").toLowerCase(),e>t?1:t>e?-1:0);class ne{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const o=[],i=e.split(/\s+/);var s;return n&&(s=new RegExp("^("+Object.keys(n).map(h).join("|")+"):(.*)$")),i.forEach(e=>{let i,a=null,n=null;s&&(i=e.match(s))&&(a=i[1],e=i[2]),e.length>0&&(this.settings.diacritics?n=he(e)||null:n=h(e),n&&t&&(n="\\b"+n)),o.push({string:e,regex:n?new RegExp(n,"iu"):null,field:a})}),o}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const r=e.options.fields,c=e.weights,s=r.length,o=e.getAttrFn;if(!s)return function(){return 1};const a=function(){return s===1?function(e,t){const n=r[0].field;return T(o(t,n),e,c[n]||1)}:function(e,t){var n=0;if(e.field){const i=o(t,e.field);!e.regex&&i?n+=1/s:n+=T(i,e,1)}else i(c,(s,i)=>{n+=T(o(t,i),e,s)});return n/s}}();return n===1?function(e){return a(t[0],e)}:e.options.conjunction==="and"?function(e){var s,o=0;for(let n of t){if(s=a(n,e),s<=0)return 0;o+=s}return o/n}:function(e){var s=0;return i(t,t=>{s+=a(t,e)}),s/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var s,t=[];const a=this,o=e.options,n=!e.query&&o.sort_empty?o.sort_empty:o.sort;if(typeof n=="function")return n.bind(this);const i=function(n,s){return n==="$score"?s.score:e.getAttrFn(a.items[s.id],n)};if(n)for(let s of n)(e.query||s.field!=="$score")&&t.push(s);if(e.query){s=!0;for(let e of t)if(e.field==="$score"){s=!1;break}s&&t.unshift({field:"$score",direction:"desc"})}else t=t.filter(e=>e.field!=="$score");const r=t.length;return r?function(e,n){var s,o;for(let a of t){o=a.field;let r=a.direction==="desc"?-1:1;if(s=r*re(i(o,e),i(o,n)),s)return s}return 0}:null}prepareSearch(e,t){const s={};var n=Object.assign({},t);if(S(n,"sort"),S(n,"sort_empty"),n.fields){S(n,"fields");const e=[];n.fields.forEach(t=>{typeof t=="string"&&(t={field:t,weight:1}),e.push(t),s[t.field]="weight"in t?t.weight:1}),n.fields=e}return{options:n,query:e.toLowerCase().trim(),tokens:this.tokenize(e,n.respect_word_boundaries,s),total:0,items:[],weights:s,getAttrFn:n.nesting?ce:de}}search(e,t){var o,s=this,n=this.prepareSearch(e,t);t=n.options,e=n.query;const r=t.score||s._getScoreFunction(n);e.length?i(s.items,(e,s)=>{o=r(e),(t.filter===!1||o>0)&&n.items.push({score:o,id:s})}):i(s.items,(e,t)=>{n.items.push({score:1,id:t})});const a=s._getSortFunction(n);return a&&n.items.sort(a),n.total=n.items.length,typeof t.limit=="number"&&(n.items=n.items.slice(0,t.limit)),n}}const u=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)},s=e=>{if(e.jquery)return e[0];if(e instanceof HTMLElement)return e;if(D(e)){var t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}return document.querySelector(e)},D=e=>typeof e=="string"&&e.indexOf("<")>-1,te=e=>e.replace(/['"\\]/g,"\\$&"),C=(e,t)=>{var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!1),e.dispatchEvent(n)},j=(e,t)=>{Object.assign(e.style,t)},o=(e,...t)=>{var n=G(t);e=X(e),e.map(e=>{n.map(t=>{e.classList.add(t)})})},c=(e,...t)=>{var n=G(t);e=X(e),e.map(e=>{n.map(t=>{e.classList.remove(t)})})},G=e=>{var t=[];return u(e,e=>{typeof e=="string"&&(e=e.trim().split(/[\11\12\14\15\40]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},X=e=>(Array.isArray(e)||(e=[e]),e),g=(e,t,n)=>{if(n&&!n.contains(e))return;for(;e&&e.matches;){if(e.matches(t))return e;e=e.parentNode}},V=(e,t=0)=>t>0?e[e.length-1]:e[0],ee=e=>Object.keys(e).length===0,b=(e,t)=>{if(!e)return-1;t=t||e.nodeName;for(var n=0;e=e.previousElementSibling;)e.matches(t)&&n++;return n},t=(e,t)=>{u(t,(t,n)=>{t==null?e.removeAttribute(n):e.setAttribute(n,""+t)})},A=(e,t)=>{e.parentNode&&e.parentNode.replaceChild(t,e)},se=(e,t)=>{if(t===null)return;if(typeof t=="string"){if(!t.length)return;t=new RegExp(t,"i")}const s=e=>{var n,s,i,o=e.data.match(t);return o&&e.data.length>0?(n=document.createElement("span"),n.className="highlight",s=e.splitText(o.index),s.splitText(o[0].length),i=s.cloneNode(!0),n.appendChild(i),A(s,n),1):0},o=e=>{e.nodeType===1&&e.childNodes&&!/(script|style)/i.test(e.tagName)&&(e.className!=="highlight"||e.tagName!=="SPAN")&&Array.from(e.childNodes).forEach(e=>{n(e)})},n=e=>e.nodeType===3?s(e):(o(e),0);n(e)},oe=e=>{var t=e.querySelectorAll("span.highlight");Array.prototype.forEach.call(t,function(e){var t=e.parentNode;t.replaceChild(e.firstChild,e),t.normalize()})},ie=65,ae=13,P=27,z=37,le=38,Z=39,ue=40,W=8,me=46,M=9,pe=typeof navigator!="undefined"&&/Mac/.test(navigator.userAgent),m=pe?"metaKey":"ctrlKey";var x,B={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(e){return e.length>0},render:{}};const r=e=>typeof e=="undefined"||e===null?null:y(e),y=e=>typeof e=="boolean"?e?"1":"0":e+"",_=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),_e=(e,t)=>{var n;return function(s,o){var i=this;n&&(i.loading=Math.max(i.loading-1,0),clearTimeout(n)),n=setTimeout(function(){n=null,i.loadedSearches[s]=!0,e.call(i,s,o)},t)}},Q=(e,t,n)=>{var s,o=e.trigger,i={};e.trigger=function(){var n=arguments[0];if(t.indexOf(n)!==-1)i[n]=arguments;else return o.apply(e,arguments)},n.apply(e,[]),e.trigger=o;for(s of t)s in i&&o.apply(e,i[s])},Oe=e=>({start:e.selectionStart||0,length:(e.selectionEnd||0)-(e.selectionStart||0)}),e=(e,t=!1)=>{e&&(e.preventDefault(),t&&e.stopPropagation())},n=(e,t,n,s)=>{e.addEventListener(t,n,s)},l=(e,t)=>{if(!t)return!1;if(!t[e])return!1;var n=(t.altKey?1:0)+(t.ctrlKey?1:0)+(t.shiftKey?1:0)+(t.metaKey?1:0);return n===1},O=(e,t)=>{const n=e.getAttribute("id");return n||(e.setAttribute("id",t),t)},L=e=>e.replace(/[\\"']/g,"\\$&"),d=(e,t)=>{t&&e.append(t)};function K(e,t){var n,f,p,s=Object.assign({},B,t),h=s.dataAttr,d=s.labelField,i=s.valueField,a=s.disabledField,o=s.optgroupField,m=s.optgroupLabelField,l=s.optgroupValueField,g=e.tagName.toLowerCase(),c=e.getAttribute("placeholder")||e.getAttribute("data-placeholder");if(!c&&!s.allowEmptyOption){let t=e.querySelector('option[value=""]');t&&(c=t.textContent)}return n={placeholder:c,options:[],optgroups:[],items:[],maxItems:null},f=()=>{var c,g=n.options,t={},v=1,f=e=>{var t=Object.assign({},e.dataset),n=h&&t[h];return typeof n=="string"&&n.length&&(t=Object.assign(t,JSON.parse(n))),t},p=(e,c)=>{var l,h,u=r(e.value);if(u==null)return;if(!u&&!s.allowEmptyOption)return;t.hasOwnProperty(u)?c&&(h=t[u][o],h?Array.isArray(h)?h.push(c):t[u][o]=[h,c]:t[u][o]=c):(l=f(e),l[d]=l[d]||e.textContent,l[i]=l[i]||u,l[a]=l[a]||e.disabled,l[o]=l[o]||c,l.$option=e,t[u]=l,g.push(l)),e.selected&&n.items.push(u)},b=e=>{var s,t=f(e);t[m]=t[m]||e.getAttribute("label")||"",t[l]=t[l]||v++,t[a]=t[a]||e.disabled,n.optgroups.push(t),s=t[l],u(e.children,e=>{p(e,s)})};n.maxItems=e.hasAttribute("multiple")?null:1,u(e.children,e=>{c=e.tagName.toLowerCase(),c==="optgroup"?b(e):c==="option"&&p(e)})},p=()=>{const t=e.getAttribute(h);if(t)n.options=JSON.parse(t),u(n.options,e=>{n.items.push(e[i])});else{var o=e.value.trim()||"";if(!s.allowEmptyOption&&!o.length)return;const t=o.split(s.delimiter);u(t,e=>{const t={};t[d]=e,t[i]=e,n.options.push(t)}),n.items=t}},g==="select"?f():p(),Object.assign({},B,n,t)}x=0;class a extends Fe(Te){constructor(e,n){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],x++;var c,l,p,b,j,r=s(e);if(r.tomselect)throw new Error("Tom Select already initialized on this element");r.tomselect=this,b=window.getComputedStyle&&window.getComputedStyle(r,null),p=b.getPropertyValue("direction");const a=K(r,n);this.settings=a,this.input=r,this.tabIndex=r.tabIndex||0,this.is_select_tag=r.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(p),this.inputId=O(r,"tomselect-"+x),this.isRequired=r.required,this.sifter=new ne(this.options,{diacritics:a.diacritics}),a.mode=a.mode||(a.maxItems===1?"single":"multi"),typeof a.hideSelected!="boolean"&&(a.hideSelected=a.mode==="multi"),typeof a.hidePlaceholder!="boolean"&&(a.hidePlaceholder=a.mode!=="multi"),l=a.createFilter,typeof l!="function"&&(typeof l=="string"&&(l=new RegExp(l)),l instanceof RegExp?a.createFilter=e=>l.test(e):a.createFilter=e=>this.settings.duplicates||!this.options[e]),this.initializePlugins(a.plugins),this.setupCallbacks(),this.setupTemplates();const m=s("<div>"),u=s("<div>"),h=this._render("dropdown"),f=s(`<div role="listbox" tabindex="-1">`),g=this.input.getAttribute("class")||"",v=a.mode;o(m,a.wrapperClass,g,v),o(u,a.controlClass),d(m,u),o(h,a.dropdownClass,v),a.copyClassesToDropdown&&o(h,g),o(f,a.dropdownContentClass),d(h,f),s(a.dropdownParent||m).appendChild(h),D(a.controlInput)?(c=s(a.controlInput),j=["autocorrect","autocapitalize","autocomplete"],i(j,e=>{r.getAttribute(e)&&t(c,{[e]:r.getAttribute(e)})}),c.tabIndex=-1,u.appendChild(c),this.focus_node=c):a.controlInput?(c=s(a.controlInput),this.focus_node=c):(c=s("<input/>"),this.focus_node=u),this.wrapper=m,this.dropdown=h,this.dropdown_content=f,this.control=u,this.control_input=c,this.setup()}setup(){const s=this,i=s.settings,c=s.control_input,l=s.dropdown,f=s.dropdown_content,m=s.wrapper,y=s.control,a=s.input,d=s.focus_node,v={passive:!0},p=s.inputId+"-ts-dropdown";t(f,{id:p}),t(d,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":p});const _=O(d,s.inputId+"-ts-control"),w="label[for='"+te(s.inputId)+"']",r=document.querySelector(w),b=s.focus.bind(s);if(r){n(r,"click",b),t(r,{for:_});const e=O(r,s.inputId+"-ts-label");t(d,{"aria-labelledby":e}),t(f,{"aria-labelledby":e})}if(m.style.width=a.style.width,s.plugins.names.length){const e="plugin-"+s.plugins.names.join(" plugin-");o([m,l],e)}(i.maxItems===null||i.maxItems>1)&&s.is_select_tag&&t(a,{multiple:"multiple"}),i.placeholder&&t(c,{placeholder:i.placeholder}),!i.splitOn&&i.delimiter&&(i.splitOn=new RegExp("\\s*"+h(i.delimiter)+"+\\s*")),i.load&&i.loadThrottle&&(i.load=_e(i.load,i.loadThrottle)),s.control_input.type=a.type,n(l,"mousemove",()=>{s.ignoreHover=!1}),n(l,"mouseenter",e=>{var t=g(e.target,"[data-selectable]",l);t&&s.onOptionHover(e,t)},{capture:!0}),n(l,"click",t=>{const n=g(t.target,"[data-selectable]");n&&(s.onOptionSelect(t,n),e(t,!0))}),n(y,"click",t=>{var n=g(t.target,"[data-ts-item]",y);if(n&&s.onItemSelect(t,n)){e(t,!0);return}if(c.value!="")return;s.onClick(),e(t,!0)}),n(d,"keydown",e=>s.onKeyDown(e)),n(c,"keypress",e=>s.onKeyPress(e)),n(c,"input",e=>s.onInput(e)),n(d,"blur",e=>s.onBlur(e)),n(d,"focus",e=>s.onFocus(e)),n(c,"paste",e=>s.onPaste(e));const j=t=>{const n=t.composedPath()[0];if(!m.contains(n)&&!l.contains(n)){s.isFocused&&s.blur(),s.inputState();return}n==c&&s.isOpen?t.stopPropagation():e(t,!0)},u=()=>{s.isOpen&&s.positionDropdown()};n(document,"mousedown",j),n(window,"scroll",u,v),n(window,"resize",u,v),this._destroy=()=>{document.removeEventListener("mousedown",j),window.removeEventListener("scroll",u),window.removeEventListener("resize",u),r&&r.removeEventListener("click",b)},this.revertSettings={innerHTML:a.innerHTML,tabIndex:a.tabIndex},a.tabIndex=-1,a.insertAdjacentElement("afterend",s.wrapper),s.sync(!1),i.items=[],delete i.optgroups,delete i.options,n(a,"invalid",()=>{s.isValid&&(s.isValid=!1,s.isInvalid=!0,s.refreshState())}),s.updateOriginalInput(),s.refreshItems(),s.close(!1),s.inputState(),s.isSetup=!0,a.disabled?s.disable():s.enable(),s.on("change",this.onChange),o(a,"tomselected","ts-hidden-accessible"),s.trigger("initialize"),i.preload===!0&&s.preload()}setupOptions(e=[],t=[]){this.addOptions(e),i(t,e=>{this.registerOptionGroup(e)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,s={optgroup:e=>{let t=document.createElement("div");return t.className="optgroup",t.appendChild(e.options),t},optgroup_header:(e,t)=>'<div class="optgroup-header">'+t(e[n])+"</div>",option:(e,n)=>"<div>"+n(e[t])+"</div>",item:(e,n)=>"<div>"+n(e[t])+"</div>",option_create:(e,t)=>'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},s,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?K(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){C(this.input,"input"),C(this.input,"change")}onPaste(t){var n=this;if(n.isInputHidden||n.isLocked){e(t);return}if(!n.settings.splitOn)return;setTimeout(()=>{var t,e=n.inputValue();if(!e.match(n.settings.splitOn))return;t=e.trim().split(n.settings.splitOn),i(t,e=>{const t=r(e);t&&(this.options[e]?n.addItem(e):n.createItem(e))})},0)}onKeyPress(t){var s,n=this;if(n.isLocked){e(t);return}if(s=String.fromCharCode(t.keyCode||t.which),n.settings.create&&n.settings.mode==="multi"&&s===n.settings.delimiter){n.createItem(),e(t);return}}onKeyDown(t){var n=this;if(n.ignoreHover=!0,n.isLocked){t.keyCode!==M&&e(t);return}switch(t.keyCode){case ie:if(l(m,t)&&n.control_input.value==""){e(t),n.selectAll();return}break;case P:n.isOpen&&(e(t,!0),n.close()),n.clearActiveItems();return;case ue:if(!n.isOpen&&n.hasOptions)n.open();else if(n.activeOption){let e=n.getAdjacent(n.activeOption,1);e&&n.setActiveOption(e)}e(t);return;case le:if(n.activeOption){let e=n.getAdjacent(n.activeOption,-1);e&&n.setActiveOption(e)}e(t);return;case ae:n.canSelect(n.activeOption)?(n.onOptionSelect(t,n.activeOption),e(t)):n.settings.create&&n.createItem()?e(t):document.activeElement==n.control_input&&n.isOpen&&e(t);return;case z:n.advanceSelection(-1,t);return;case Z:n.advanceSelection(1,t);return;case M:n.settings.selectOnTab&&(n.canSelect(n.activeOption)&&(n.onOptionSelect(t,n.activeOption),e(t)),n.settings.create&&n.createItem()&&e(t));return;case W:case me:n.deleteSelection(t);return}n.isInputHidden&&!l(m,t)&&e(t)}onInput(){var n,t=this;if(t.isLocked)return;n=t.inputValue(),t.lastValue!==n&&(t.lastValue=n,t.settings.shouldLoad.call(t,n)&&t.load(n),t.refreshOptions(),t.trigger("type",n))}onOptionHover(e,t){if(this.ignoreHover)return;this.setActiveOption(t,!1)}onFocus(t){var n=this,s=n.isFocused;if(n.isDisabled){n.blur(),e(t);return}if(n.ignoreFocus)return;n.isFocused=!0,n.settings.preload==="focus"&&n.preload(),s||n.trigger("focus"),n.activeItems.length||(n.showInput(),n.refreshOptions(!!n.settings.openOnFocus)),n.refreshState()}onBlur(){if(document.hasFocus()===!1)return;var n,t=this;if(!t.isFocused)return;t.isFocused=!1,t.ignoreFocus=!1,n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")},t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}onOptionSelect(e,t){var s,n=this;if(t.parentElement&&t.parentElement.matches("[data-disabled]"))return;t.classList.contains("create")?n.createItem(null,()=>{n.settings.closeAfterSelect&&n.close()}):(s=t.dataset.value,typeof s!="undefined"&&(n.lastQuery=null,n.addItem(s),n.settings.closeAfterSelect&&n.close(),!n.settings.hideSelected&&e.type&&/click/.test(e.type)&&n.setActiveOption(t)))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(t,n){var s=this;return!s.isLocked&&s.settings.mode==="multi"&&(e(t),s.setActiveItem(n,t),!0)}canLoad(e){return!!this.settings.load&&!this.loadedSearches.hasOwnProperty(e)}load(e){const t=this;if(!t.canLoad(e))return;o(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||c(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;if(e.contains("preloaded"))return;e.add("preloaded"),this.load("")}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,C(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];Q(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(t,n){var o,i,a,r,c,d,s=this;if(s.settings.mode==="single")return;if(!t){s.clearActiveItems(),s.isFocused&&s.showInput();return}if(a=n&&n.type.toLowerCase(),a==="click"&&l("shiftKey",n)&&s.activeItems.length){d=s.getLastActive(),o=Array.prototype.indexOf.call(s.control.children,d),i=Array.prototype.indexOf.call(s.control.children,t),o>i&&(c=o,o=i,i=c);for(r=o;r<=i;r++)t=s.control.children[r],s.activeItems.indexOf(t)===-1&&s.setActiveItemClass(t);e(n)}else a==="click"&&l(m,n)||a==="keydown"&&l("shiftKey",n)?t.classList.contains("active")?s.removeActiveItem(t):s.setActiveItemClass(t):(s.clearActiveItems(),s.setActiveItemClass(t));s.hideInput(),s.isFocused||s.focus()}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&c(n,"last-active"),o(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),c(e,"active")}clearActiveItems(){c(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,n=!0){if(e===this.activeOption)return;if(this.clearActiveOption(),!e)return;this.activeOption=e,t(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),t(e,{"aria-selected":"true"}),o(e,"active"),n&&this.scrollToOption(e)}scrollToOption(e,t){if(!e)return;const s=this.dropdown_content,i=s.clientHeight,o=s.scrollTop||0,a=e.offsetHeight,n=e.getBoundingClientRect().top-s.getBoundingClientRect().top+o;n+a>i+o?this.scroll(n-i+a,t):n<o&&this.scroll(n,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(c(this.activeOption,"active"),t(this.activeOption,{"aria-selected":null})),this.activeOption=null,t(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();if(!t.length)return;e.hideInput(),e.close(),e.activeItems=t,i(t,t=>{e.setActiveItemClass(t)})}inputState(){var e=this;if(!e.control.contains(e.control_input))return;t(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&t(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden)}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var e=this;if(e.isDisabled)return;e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0)}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var n,s,t=this,o=this.getSearchOptions();if(t.settings.score&&(s=t.settings.score.call(t,e),typeof s!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==t.lastQuery?(t.lastQuery=e,n=t.sifter.search(e,Object.assign(o,{score:s})),t.currentResults=n):n=Object.assign({},t.currentResults),t.settings.hideSelected&&(n.items=n.items.filter(e=>{let n=r(e.id);return!n||t.items.indexOf(n)===-1})),n}refreshOptions(e=!0){const j={},_=[];var s,o,a,r,l,h,m,f,p,g,v,b,w,O,x,n=this,u=n.inputValue();const C=u===n.lastQuery||u==""&&n.lastQuery==null;a=n.search(u),s=null,v=n.settings.shouldOpen||!1,r=n.dropdown_content,C&&(s=n.activeOption,s&&(w=s.closest("[data-group]"))),m=a.items.length,typeof n.settings.maxOptions=="number"&&(m=Math.min(m,n.settings.maxOptions)),m>0&&(v=!0);for(b=0;b<m;b++){let d=a.items[b];if(!d)continue;let i=d.id,r=n.options[i];if(r===void 0)continue;let u=y(i),e=n.getOption(u,!0);n.settings.hideSelected||e.classList.toggle("selected",n.items.includes(u)),o=r[n.settings.optgroupField]||"",f=Array.isArray(o)?o:[o];for(l=0,x=f&&f.length;l<x;l++){o=f[l],n.optgroups.hasOwnProperty(o)||(o="");let a=j[o];a===void 0&&(a=document.createDocumentFragment(),_.push(o)),l>0&&(e=e.cloneNode(!0),t(e,{id:r.$id+"-clone-"+l,"aria-selected":null}),e.classList.add("ts-cloned"),c(e,"active"),n.activeOption&&n.activeOption.dataset.value==i&&w&&w.dataset.group===o.toString()&&(s=e)),a.appendChild(e),j[o]=a}}if(n.settings.lockOptgroupOrder&&_.sort((e,t)=>{const s=n.optgroups[e],o=n.optgroups[t],i=s&&s.$order||0,a=o&&o.$order||0;return i-a}),g=document.createDocumentFragment(),i(_,e=>{let t=j[e];if(!t||!t.children.length)return;let s=n.optgroups[e];if(s!==void 0){let e=document.createDocumentFragment(),o=n.render("optgroup_header",s);d(e,o),d(e,t);let i=n.render("optgroup",{group:s,options:e});d(g,i)}else d(g,t)}),r.innerHTML="",d(r,g),n.settings.highlight&&(oe(r),a.query.length&&a.tokens.length&&i(a.tokens,e=>{se(r,e.regex)})),h=e=>{let t=n.render(e,{input:u});return t&&(v=!0,r.insertBefore(t,r.firstChild)),t},n.loading?h("loading"):n.settings.shouldLoad.call(n,u)?a.items.length===0&&h("no_results"):h("not_loading"),O=n.canCreate(u),O&&(p=h("option_create")),n.hasOptions=a.items.length>0||O,v){if(a.items.length>0){if(!s&&n.settings.mode==="single"&&n.items[0]!=void 0&&(s=n.getOption(n.items[0])),!r.contains(s)){let e=0;p&&!n.settings.addPrecedence&&(e=1),s=n.selectable()[e]}}else p&&(s=p);e&&!n.isOpen&&(n.open(),n.scrollToOption(s,"auto")),n.setActiveOption(s)}else n.clearActiveOption(),e&&n.isOpen&&n.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const s=r(e[n.settings.valueField]);return s!==null&&!n.options.hasOwnProperty(s)&&(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[s]=e,n.lastQuery=null,t&&(n.userOptions[s]=t,n.trigger("option_add",s,e)),s)}addOptions(e,t=!1){i(e,e=>{this.addOption(e,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=r(e[this.settings.optgroupValueField]);return t!==null&&(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var c,l;const s=r(e),a=r(t[n.settings.valueField]);if(s===null)return;const u=n.options[s];if(u==null)return;if(typeof a!="string")throw new Error("Value must be set in option data");const i=n.getOption(s),d=n.getItem(s);if(t.$order=t.$order||u.$order,delete n.options[s],n.uncacheValue(a),n.options[a]=t,i){if(n.dropdown_content.contains(i)){const e=n._render("option",t);A(i,e),n.activeOption===i&&n.setActiveOption(e)}i.remove()}d&&(l=n.items.indexOf(s),l!==-1&&n.items.splice(l,1,a),c=n._render("item",t),d.classList.contains("active")&&o(c,"active"),A(d,c)),n.lastQuery=null}removeOption(e,t){const n=this;e=y(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const n=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const t={};i(this.options,(e,s)=>{n(e,s)&&(t[s]=e)}),this.options=this.sifter.items=t,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const s=r(e);if(s===null)return null;const n=this.options[s];if(n!=null){if(n.$div)return n.$div;if(t)return this._render("option",n)}return null}getAdjacent(e,t,n="option"){var s,o=this;if(!e)return null;n=="item"?s=o.controlChildren():s=o.dropdown_content.querySelectorAll("[data-selectable]");for(let n=0;n<s.length;n++){if(s[n]!=e)continue;return t>0?s[n+1]:s[n-1]}return null}getItem(e){if(typeof e=="object")return e;var t=r(e);return t!==null?this.control.querySelector(`[data-value="${L(t)}"]`):null}addItems(e,t){var s=this,n=Array.isArray(e)?e:[e],n=n.filter(e=>s.items.indexOf(e)===-1);const o=n[n.length-1];n.forEach(e=>{s.isPending=e!==o,s.addItem(e,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];Q(this,n,()=>{var o,a;const n=this,i=n.settings.mode,s=r(e);if(s&&n.items.indexOf(s)!==-1&&(i==="single"&&n.close(),i==="single"||!n.settings.duplicates))return;if(s===null||!n.options.hasOwnProperty(s))return;if(i==="single"&&n.clear(t),i==="multi"&&n.isFull())return;if(o=n._render("item",n.options[s]),n.control.contains(o)&&(o=o.cloneNode(!0)),a=n.isFull(),n.items.splice(n.caretPos,0,s),n.insertAtCaret(o),n.isSetup){if(!n.isPending&&n.settings.hideSelected){let t=n.getOption(s),e=n.getAdjacent(t,1);e&&n.setActiveOption(e)}!n.isPending&&!n.settings.closeAfterSelect&&n.refreshOptions(n.isFocused&&i!=="single"),n.settings.closeAfterSelect!=!1&&n.isFull()?n.close():n.isPending||n.positionDropdown(),n.trigger("item_add",s,o),n.isPending||n.updateOriginalInput({silent:t})}(!n.isPending||!a&&n.isFull())&&(n.inputState(),n.refreshState())})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var s,i;const o=e.dataset.value;s=b(e),e.remove(),e.classList.contains("active")&&(i=n.activeItems.indexOf(e),n.activeItems.splice(i,1),c(e,"active")),n.items.splice(s,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(o)&&n.removeOption(o,t),s<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",o,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var s,o,i,n=this,a=n.caretPos;return e=e||n.inputValue(),n.canCreate(e)?(n.lock(),o=!1,i=e=>{if(n.unlock(),!e||typeof e!="object")return t();var s=r(e[n.settings.valueField]);if(typeof s!="string")return t();n.setTextboxValue(),n.addOption(e,!0),n.setCaret(a),n.addItem(s),t(e),o=!0},typeof n.settings.create=="function"?s=n.settings.create.call(this,e,i):s={[n.settings.labelField]:e,[n.settings.valueField]:e},o||i(s),!0):(t(),!1)}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const n=e.isFull(),s=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const t=e.wrapper.classList;t.toggle("focus",e.isFocused),t.toggle("disabled",e.isDisabled),t.toggle("required",e.isRequired),t.toggle("invalid",!e.isValid),t.toggle("locked",s),t.toggle("full",n),t.toggle("input-active",e.isFocused&&!e.isInputHidden),t.toggle("dropdown-active",e.isOpen),t.toggle("has-options",ee(e.options)),t.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;if(!e.input.validity)return;e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,o;const i=t.input.querySelector('option[value=""]');if(t.is_select_tag){const e=[],r=t.input.querySelectorAll("option:checked").length;function a(n,o,a){return n||(n=s('<option value="'+_(o)+'">'+_(a)+"</option>")),n!=i&&t.input.append(n),e.push(n),(n!=i||r>0)&&(n.selected=!0),n}t.input.querySelectorAll("option:checked").forEach(e=>{e.selected=!1}),t.items.length==0&&t.settings.mode=="single"?a(i,"",""):t.items.forEach(s=>{if(n=t.options[s],o=n[t.settings.labelField]||"",e.includes(n.$option)){const e=t.input.querySelector(`option[value="${L(s)}"]:not(:checked)`);a(e,s,o)}else n.$option=a(n.$option,s,o)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;if(e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull())return;e.isOpen=!0,t(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),j(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),j(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown)}close(e=!0){var n=this,s=n.isOpen;e&&(n.setTextboxValue(),n.settings.mode==="single"&&n.items.length&&n.hideInput()),n.isOpen=!1,t(n.focus_node,{"aria-expanded":"false"}),j(n.dropdown,{display:"none"}),n.settings.hideSelected&&n.clearActiveOption(),n.refreshState(),s&&n.trigger("dropdown_close",n.dropdown)}positionDropdown(){if(this.settings.dropdownParent!=="body")return;var t=this.control,e=t.getBoundingClientRect(),n=t.offsetHeight+e.top+window.scrollY,s=e.left+window.scrollX;j(this.dropdown,{width:e.width+"px",top:n+"px",left:s+"px"})}clear(e){var n,t=this;if(!t.items.length)return;n=t.controlChildren(),i(n,e=>{t.removeItem(e,!0)}),t.showInput(),e||t.updateOriginalInput(),t.trigger("clear")}insertAtCaret(e){const t=this,n=t.caretPos,s=t.control;s.insertBefore(e,s.children[n]||null),t.setCaret(n+1)}deleteSelection(t){var a,c,n=this,o=t&&t.keyCode===W?-1:1,r=Oe(n.control_input);const s=[];if(n.activeItems.length)c=V(n.activeItems,o),a=b(c),o>0&&a++,i(n.activeItems,e=>s.push(e));else if((n.isFocused||n.settings.mode==="single")&&n.items.length){const t=n.controlChildren();let e;o<0&&r.start===0&&r.length===0?e=t[n.caretPos-1]:o>0&&r.start===n.inputValue().length&&(e=t[n.caretPos]),e!==void 0&&s.push(e)}if(!n.shouldDelete(s,t))return!1;for(e(t,!0),typeof a!="undefined"&&n.setCaret(a);s.length;)n.removeItem(s.pop());return n.showInput(),n.positionDropdown(),n.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(e=>e.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var s,o,n=this;if(n.rtl&&(e*=-1),n.inputValue().length)return;l(m,t)||l("shiftKey",t)?(o=n.getLastActive(e),o?o.classList.contains("active")?s=n.getAdjacent(o,e,"item"):s=o:e>0?s=n.control_input.nextElementSibling:s=n.control_input.previousElementSibling,s&&(s.classList.contains("active")&&n.removeActiveItem(o),n.setActiveItemClass(s))):n.moveCaret(e)}moveCaret(){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return V(n,e)}setCaret(){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){var e=this;e.input.disabled=!0,e.control_input.disabled=!0,e.focus_node.tabIndex=-1,e.isDisabled=!0,this.close(),e.lock()}enable(){var e=this;e.input.disabled=!1,e.control_input.disabled=!1,e.focus_node.tabIndex=e.tabIndex,e.isDisabled=!1,e.unlock()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,c(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,n){var i,r;const a=this;if(typeof this.settings.render[e]!="function")return null;if(i=a.settings.render[e].call(this,n,_),!i)return null;if(i=s(i),e==="option"||e==="option_create"?n[a.settings.disabledField]?t(i,{"aria-disabled":"true"}):t(i,{"data-selectable":""}):e==="optgroup"&&(r=n.group[a.settings.optgroupValueField],t(i,{"data-group":r}),n.group[a.settings.disabledField]&&t(i,{"data-disabled":""})),e==="option"||e==="item"){const s=y(n[a.settings.valueField]);t(i,{"data-value":s}),e==="item"?(o(i,a.settings.itemClass),t(i,{"data-ts-item":""})):(o(i,a.settings.optionClass),t(i,{role:"option",id:n.$id}),n.$div=i,a.options[s]=n)}return i}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){i(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var s=this,o=s[t];s[t]=function(){var t,i;return e==="after"&&(t=o.apply(s,arguments)),i=n.apply(s,arguments),e==="instead"?i:(e==="before"&&(t=o.apply(s,arguments)),t)}}}function ze(){n(this.input,"change",()=>{this.sync()})}function De(){var n,t=this,o=t.onOptionSelect;t.settings.hideSelected=!1,n=function(t){setTimeout(()=>{var e=t.querySelector("input");e instanceof HTMLInputElement&&(t.classList.contains("selected")?e.checked=!0:e.checked=!1)},1)},t.hook("after","setupTemplates",()=>{var n=t.settings.render.option;t.settings.render.option=(o,i)=>{var c=s(n.call(t,o,i)),a=document.createElement("input");a.addEventListener("click",function(t){e(t)}),a.type="checkbox";const l=r(o[t.settings.valueField]);return l&&t.items.indexOf(l)>-1&&(a.checked=!0),c.prepend(a),c}}),t.on("item_remove",e=>{var s=t.getOption(e);s&&(s.classList.remove("selected"),n(s))}),t.on("item_add",e=>{var s=t.getOption(e);s&&n(s)}),t.hook("instead","onOptionSelect",(s,i)=>{if(i.classList.contains("selected")){i.classList.remove("selected"),t.removeItem(i.dataset.value),t.refreshOptions(),e(s,!0);return}o.call(t,s,i),n(i)})}function Ne(e){const t=this,n=Object.assign({className:"clear-button",title:"Clear All",html:e=>`<div class="${e.className}" title="${e.title}">&#10799;</div>`},e);t.on("initialize",()=>{var e=s(n.html(n));e.addEventListener("click",e=>{if(t.isDisabled)return;t.clear(),t.settings.mode==="single"&&t.settings.allowEmptyOption&&t.addItem(""),e.preventDefault(),e.stopPropagation()}),t.control.appendChild(e)})}function Le(){var t,n,e=this;if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if(e.settings.mode!=="multi")return;t=e.lock,n=e.unlock,e.hook("instead","lock",()=>{var n=$(e.control).data("sortable");return n&&n.disable(),t.call(e)}),e.hook("instead","unlock",()=>{var t=$(e.control).data("sortable");return t&&t.enable(),n.call(e)}),e.on("initialize",()=>{var t=$(e.control).sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:e.isLocked,start:(e,n)=>{n.placeholder.css("width",n.helper.css("width")),t.css({overflow:"visible"})},stop:()=>{t.css({overflow:"hidden"});var n=[];t.children("[data-value]").each(function(){this.dataset.value&&n.push(this.dataset.value)}),e.setValue(n)}})})}function Re(t){const n=this,o=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:e=>'<div class="'+e.headerClass+'"><div class="'+e.titleRowClass+'"><span class="'+e.labelClass+'">'+e.title+'</span><a class="'+e.closeClass+'">&times;</a></div></div>'},t);n.on("initialize",()=>{var t=s(o.html(o)),i=t.querySelector("."+o.closeClass);i&&i.addEventListener("click",t=>{e(t,!0),n.close()}),n.dropdown.insertBefore(t,n.dropdown.firstChild)})}function Pe(){var e=this;e.hook("instead","setCaret",t=>{e.settings.mode==="single"||!e.control.contains(e.control_input)?t=e.items.length:(t=Math.max(0,Math.min(e.items.length,t)),t!=e.caretPos&&!e.isPending&&e.controlChildren().forEach((n,s)=>{s<t?e.control_input.insertAdjacentElement("beforebegin",n):e.control.appendChild(n)})),e.caretPos=t}),e.hook("instead","moveCaret",t=>{if(!e.isFocused)return;const n=e.getLastActive(t);if(n){const s=b(n);e.setCaret(t>0?s+1:s),e.setActiveItem(),c(n,"last-active")}else e.setCaret(e.caretPos+t)})}function He(){const t=this;t.settings.shouldOpen=!0,t.hook("before","setup",()=>{t.focus_node=t.control,o(t.control_input,"dropdown-input");const e=s('<div class="dropdown-input-wrap">');e.append(t.control_input),t.dropdown.insertBefore(e,t.dropdown.firstChild);const n=s('<input class="items-placeholder" tabindex="-1" />');n.placeholder=t.settings.placeholder||"",t.control.append(n)}),t.on("initialize",()=>{t.control_input.addEventListener("keydown",n=>{switch(n.keyCode){case P:t.isOpen&&(e(n,!0),t.close()),t.clearActiveItems();return;case M:t.focus_node.tabIndex=-1;break}return t.onKeyDown.call(t,n)}),t.on("blur",()=>{t.focus_node.tabIndex=t.isDisabled?-1:t.tabIndex}),t.on("dropdown_open",()=>{t.control_input.focus()});const s=t.onBlur;t.hook("instead","onBlur",e=>{if(e&&e.relatedTarget==t.control_input)return;return s.call(t)}),n(t.control_input,"blur",()=>t.onBlur()),t.hook("before","close",()=>{if(!t.isOpen)return;t.focus_node.focus({preventScroll:!0})})})}function Ie(){var e=this;e.on("initialize",()=>{var s,i,o=document.createElement("span"),t=e.control_input;o.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",e.wrapper.appendChild(o),i=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const e of i)o.style[e]=t.style[e];s=()=>{o.textContent=t.value,t.style.width=o.clientWidth+"px"},s(),e.on("update item_add item_remove",s),n(t,"input",s),n(t,"keyup",s),n(t,"blur",s),n(t,"update",s)})}function Be(){var e=this,t=e.deleteSelection;this.hook("instead","deleteSelection",n=>!!e.activeItems.length&&t.call(e,n))}function Ve(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}function $e(){var e=this,t=e.onKeyDown;e.hook("instead","onKeyDown",n=>{var s,o,i,a;if(!e.isOpen||n.keyCode!==z&&n.keyCode!==Z)return t.call(e,n);if(e.ignoreHover=!0,s=g(e.activeOption,"[data-group]"),a=b(e.activeOption,"[data-selectable]"),!s)return;if(n.keyCode===z?s=s.previousSibling:s=s.nextSibling,!s)return;i=s.querySelectorAll("[data-selectable]"),o=i[Math.min(i.length-1,a)],o&&e.setActiveOption(o)})}function We(t){const i=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},t);var a,o=this;if(!i.append)return;a='<a href="javascript:void(0)" class="'+i.className+'" tabindex="-1" title="'+_(i.title)+'">'+i.label+"</a>",o.hook("after","setupTemplates",()=>{var t=o.settings.render.item;o.settings.render.item=(i,r)=>{var c=s(t.call(o,i,r)),l=s(a);return c.appendChild(l),n(l,"mousedown",t=>{e(t,!0)}),n(l,"click",t=>{if(e(t,!0),o.isLocked)return;if(!o.shouldDelete([c],t))return;o.removeItem(c),o.refreshOptions(!1),o.inputState()}),c}})}function Ue(e){const t=this,n=Object.assign({text:e=>e[t.settings.labelField]},e);t.on("item_remove",function(e){if(!t.isFocused)return;if(t.control_input.value.trim()===""){var s=t.options[e];s&&t.setTextboxValue(n.text.call(t,s))}})}function Ke(){const e=this,c=e.canLoad,l=e.clearActiveOption,d=e.loadCallback;var n,i,t={},s=!1,r=[];if(e.settings.shouldLoadMore||(e.settings.shouldLoadMore=()=>{const s=n.clientHeight/(n.scrollHeight-n.scrollTop);if(s>.9)return!0;if(e.activeOption){var t=e.selectable(),o=Array.from(t).indexOf(e.activeOption);if(o>=t.length-2)return!0}return!1}),!e.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";e.settings.sortField=[{field:"$order"},{field:"$score"}];const a=s=>!(typeof e.settings.maxOptions=="number"&&n.children.length>=e.settings.maxOptions)&&!!(s in t&&t[s]),u=(t,n)=>e.items.indexOf(n)>=0||r.indexOf(n)>=0;e.setNextUrl=(e,n)=>{t[e]=n},e.getUrl=n=>{if(n in t){const e=t[n];return t[n]=!1,e}return t={},e.settings.firstUrl.call(e,n)},e.hook("instead","clearActiveOption",()=>{if(s)return;return l.call(e)}),e.hook("instead","canLoad",n=>n in t?a(n):c.call(e,n)),e.hook("instead","loadCallback",(t,n)=>{if(s){if(i){const n=t[0];n!==void 0&&(i.dataset.value=n[e.settings.valueField])}}else e.clearOptions(u);d.call(e,t,n),s=!1}),e.hook("after","refreshOptions",()=>{const r=e.lastValue;var s;a(r)?(s=e.render("loading_more",{query:r}),s&&(s.setAttribute("data-selectable",""),i=s)):r in t&&!n.querySelector(".no-results")&&(s=e.render("no_more_results",{query:r})),s&&(o(s,e.settings.optionClass),n.append(s))}),e.on("initialize",()=>{r=Object.keys(e.options),n=e.dropdown_content,e.settings.render=Object.assign({},{loading_more:()=>`<div class="loading-more-results">Loading more results ... </div>`,no_more_results:()=>`<div class="no-more-results">No more results</div>`},e.settings.render),n.addEventListener("scroll",()=>{if(!e.settings.shouldLoadMore.call(e))return;if(!a(e.lastValue))return;if(s)return;s=!0,e.load.call(e,e.lastValue)})})}return a.define("change_listener",ze),a.define("checkbox_options",De),a.define("clear_button",Ne),a.define("drag_drop",Le),a.define("dropdown_header",Re),a.define("caret_position",Pe),a.define("dropdown_input",He),a.define("input_autogrow",Ie),a.define("no_backspace_delete",Be),a.define("no_active_items",Ve),a.define("optgroup_columns",$e),a.define("remove_button",We),a.define("restore_on_backspace",Ue),a.define("virtual_scroll",Ke),a});var tomSelect=function(e,t){return new TomSelect(e,t)}