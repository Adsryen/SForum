(function(e,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis!="undefined"?globalThis:e||self,e.TomSelect=t())})(this,function(){"use strict";function _(e,t){e.split(/\s+/).forEach(e=>{t(e)})}class Fe{constructor(){this._events=void 0,this._events={}}on(e,t){_(e,e=>{const n=this._events[e]||[];n.push(t),this._events[e]=n})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}_(e,e=>{if(n===1){delete this._events[e];return}const s=this._events[e];if(s===void 0)return;s.splice(s.indexOf(t),1),this._events[e]=s})}trigger(t,...n){var e=this;_(t,t=>{const s=e._events[t];if(s===void 0)return;s.forEach(t=>{t.apply(e,n)})})}}function Me(e){return e.plugins={},class extends e{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(t,n){e.plugins[t]={name:t,fn:n}}initializePlugins(e){const s=this,n=[];if(Array.isArray(e))e.forEach(e=>{typeof e=="string"?n.push(e):(s.plugins.settings[e.name]=e.options,n.push(e.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(s.plugins.settings[t]=e[t],n.push(t));for(var t,o;o=n.shift();)s.require(o)}loadPlugin(t){var n=this,s=n.plugins,o=e.plugins[t];if(!e.plugins.hasOwnProperty(t))throw new Error('Unable to find "'+t+'" plugin');s.requested[t]=!0,s.loaded[t]=o.fn.apply(n,[n.plugins.settings[t]||{}]),s.names.push(t)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}const b=e=>(e=e.filter(Boolean),e.length<2?e[0]||"":xe(e)==1?"["+e.join("")+"]":"(?:"+e.join("|")+")"),L=e=>{if(!Ce(e))return e.join("");let n="",t=0;const s=()=>{t>1&&(n+="{"+t+"}")};return e.forEach((o,i)=>{if(o===e[i-1]){t++;return}s(),n+=o,t=1}),s(),n},P=e=>{let t=M(e);return b(t)},Ce=e=>new Set(e).size!==e.length,h=e=>(e+"").replace(/([$()*+.?[\]^{|}\\])/gu,"\\$1"),xe=e=>e.reduce((e,t)=>Math.max(e,Oe(t)),0),Oe=e=>M(e).length,M=e=>Array.from(e),B=e=>{if(e.length===1)return[[e]];let t=[];const n=e.substring(1),s=B(n);return s.forEach(function(n){let s=n.slice(0);s[0]=e.charAt(0)+s[0],t.push(s),s=n.slice(0),s.unshift(e.charAt(0)),t.push(s)}),t},be=[[0,65535]],Q="[̀-ͯ·ʾʼ]";let v,W;const me=3,y={},q={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let e in q){let t=q[e]||"";for(let n=0;n<t.length;n++){let s=t.substring(n,n+1);y[s]=e}}const ee=new RegExp(Object.keys(y).join("|")+"|"+Q,"gu"),J=e=>{if(v!==void 0)return;v=ue(e||be)},z=(e,t="NFKD")=>e.normalize(t),j=e=>M(e).reduce((e,t)=>e+ve(t),""),ve=e=>(e=z(e).toLowerCase().replace(ee,e=>y[e]||""),z(e,"NFC"));function*te(e){for(const[t,n]of e)for(let e=t;e<=n;e++){let o=String.fromCharCode(e),s=j(o);if(s==o.toLowerCase())continue;if(s.length>me)continue;if(s.length==0)continue;yield{folded:s,composed:o,code_point:e}}}const ae=e=>{const t={},n=(e,n)=>{const s=t[e]||new Set,o=new RegExp("^"+P(s)+"$","iu");if(n.match(o))return;s.add(h(n)),t[e]=s};for(let t of te(e))n(t.folded,t.folded),n(t.folded,t.composed);return t},ue=e=>{const n=ae(e),s={};let t=[];for(let e in n){let o=n[e];o&&(s[e]=P(o)),e.length>1&&t.push(h(e))}t.sort((e,t)=>t.length-e.length);const o=b(t);return W=new RegExp("^"+o,"u"),s},pe=(e,t=1)=>{let n=0;return e=e.map(e=>(v[e]&&(n+=e.length),v[e]||e)),n>=t?L(e):""},je=(e,t=1)=>(t=Math.max(t,e.length-1),b(B(e).map(e=>pe(e,t)))),I=(e,t=!0)=>{let n=e.length>1?1:0;return b(e.map(e=>{let s=[];const o=t?e.length():e.length()-1;for(let t=0;t<o;t++)s.push(je(e.substrs[t]||"",n));return L(s)}))},ke=(e,t)=>{for(const n of t){if(n.start!=e.start||n.end!=e.end)continue;if(n.substrs.join("")!==e.substrs.join(""))continue;let s=e.parts;const o=e=>{for(const t of s){if(t.start===e.start&&t.substr===e.substr)return!1;if(e.length==1||t.length==1)continue;if(e.start<t.start&&e.end>t.start)return!0;if(t.start<e.start&&t.end>e.start)return!0}return!1};let i=n.parts.filter(o);if(i.length>0)continue;return!0}return!1};class F{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new F,o=JSON.parse(JSON.stringify(this.parts)),s=o.pop();for(const e of o)n.add(e);let i=t.substr.substring(0,e-s.start),a=i.length;return n.add({start:s.start,end:s.start+a,length:a,substr:i}),n}}const Ae=e=>{J(),e=j(e);let n="",t=[new F];for(let s=0;s<e.length;s++){let c=e.substring(s),r=c.match(W);const l=e.substring(s,s+1),o=r?r[0]:null;let i=[],a=new Set;for(const e of t){const n=e.last();if(!n||n.length==1||n.end<=s)if(o){const t=o.length;e.add({start:s,end:s+t,length:t,substr:o}),a.add("1")}else e.add({start:s,end:s+1,length:1,substr:l}),a.add("2");else if(o){let t=e.clone(s,n);const a=o.length;t.add({start:s,end:s+a,length:a,substr:o}),i.push(t)}else a.add("3")}if(i.length>0){i=i.sort((e,t)=>e.length()-t.length());for(let e of i){if(ke(e,t))continue;t.push(e)}continue}if(s>0&&a.size==1&&!a.has("3")){n+=I(t,!1);let e=new F;const s=t[0];s&&e.add(s.last()),t=[e]}}return n+=I(t,!0),n},Se=(e,t)=>{if(!e)return;return e[t]},ce=(e,t)=>{if(!e)return;for(var n,s=t.split(".");(n=s.shift())&&(e=e[n]););return e},x=(e,t,n)=>{var s,o;return e?(e=e+"",t.regex==null?0:(o=e.search(t.regex),o===-1?0:(s=t.string.length/e.length,o===0&&(s+=.5),s*n))):0},T=(e,t)=>{var n=e[t];if(typeof n=="function")return n;n&&!Array.isArray(n)&&(e[t]=[n])},s=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)},Ee=(e,t)=>typeof e=="number"&&typeof t=="number"?e>t?1:e<t?-1:0:(e=j(e+"").toLowerCase(),t=j(t+"").toLowerCase(),e>t?1:t>e?-1:0);class _e{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const o=[],i=e.split(/\s+/);var s;return n&&(s=new RegExp("^("+Object.keys(n).map(h).join("|")+"):(.*)$")),i.forEach(e=>{let i,a=null,n=null;s&&(i=e.match(s))&&(a=i[1],e=i[2]),e.length>0&&(this.settings.diacritics?n=Ae(e)||null:n=h(e),n&&t&&(n="\\b"+n)),o.push({string:e,regex:n?new RegExp(n,"iu"):null,field:a})}),o}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const r=e.options.fields,c=e.weights,o=r.length,i=e.getAttrFn;if(!o)return function(){return 1};const a=function(){return o===1?function(e,t){const n=r[0].field;return x(i(t,n),e,c[n]||1)}:function(e,t){var n=0;if(e.field){const s=i(t,e.field);!e.regex&&s?n+=1/o:n+=x(s,e,1)}else s(c,(s,o)=>{n+=x(i(t,o),e,s)});return n/o}}();return n===1?function(e){return a(t[0],e)}:e.options.conjunction==="and"?function(e){var s,o=0;for(let n of t){if(s=a(n,e),s<=0)return 0;o+=s}return o/n}:function(e){var o=0;return s(t,t=>{o+=a(t,e)}),o/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var s,t=[];const a=this,o=e.options,n=!e.query&&o.sort_empty?o.sort_empty:o.sort;if(typeof n=="function")return n.bind(this);const i=function(n,s){return n==="$score"?s.score:e.getAttrFn(a.items[s.id],n)};if(n)for(let s of n)(e.query||s.field!=="$score")&&t.push(s);if(e.query){s=!0;for(let e of t)if(e.field==="$score"){s=!1;break}s&&t.unshift({field:"$score",direction:"desc"})}else t=t.filter(e=>e.field!=="$score");const r=t.length;return r?function(e,n){var s,o;for(let a of t){o=a.field;let r=a.direction==="desc"?-1:1;if(s=r*Ee(i(o,e),i(o,n)),s)return s}return 0}:null}prepareSearch(e,t){const s={};var n=Object.assign({},t);if(T(n,"sort"),T(n,"sort_empty"),n.fields){T(n,"fields");const e=[];n.fields.forEach(t=>{typeof t=="string"&&(t={field:t,weight:1}),e.push(t),s[t.field]="weight"in t?t.weight:1}),n.fields=e}return{options:n,query:e.toLowerCase().trim(),tokens:this.tokenize(e,n.respect_word_boundaries,s),total:0,items:[],weights:s,getAttrFn:n.nesting?ce:Se}}search(e,t){var i,o=this,n=this.prepareSearch(e,t);t=n.options,e=n.query;const r=t.score||o._getScoreFunction(n);e.length?s(o.items,(e,s)=>{i=r(e),(t.filter===!1||i>0)&&n.items.push({score:i,id:s})}):s(o.items,(e,t)=>{n.items.push({score:1,id:t})});const a=o._getSortFunction(n);return a&&n.items.sort(a),n.total=n.items.length,typeof t.limit=="number"&&(n.items=n.items.slice(0,t.limit)),n}}const u=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)},o=e=>{if(e.jquery)return e[0];if(e instanceof HTMLElement)return e;if(V(e)){var t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}return document.querySelector(e)},V=e=>typeof e=="string"&&e.indexOf("<")>-1,ge=e=>e.replace(/['"\\]/g,"\\$&"),k=(e,t)=>{var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!1),e.dispatchEvent(n)},m=(e,t)=>{Object.assign(e.style,t)},i=(e,...t)=>{var n=Y(t);e=G(e),e.map(e=>{n.map(t=>{e.classList.add(t)})})},r=(e,...t)=>{var n=Y(t);e=G(e),e.map(e=>{n.map(t=>{e.classList.remove(t)})})},Y=e=>{var t=[];return u(e,e=>{typeof e=="string"&&(e=e.trim().split(/[\11\12\14\15\40]/)),Array.isArray(e)&&(t=t.concat(e))}),t.filter(Boolean)},G=e=>(Array.isArray(e)||(e=[e]),e),O=(e,t,n)=>{if(n&&!n.contains(e))return;for(;e&&e.matches;){if(e.matches(t))return e;e=e.parentNode}},D=(e,t=0)=>t>0?e[e.length-1]:e[0],Z=e=>Object.keys(e).length===0,E=(e,t)=>{if(!e)return-1;t=t||e.nodeName;for(var n=0;e=e.previousElementSibling;)e.matches(t)&&n++;return n},t=(e,t)=>{u(t,(t,n)=>{t==null?e.removeAttribute(n):e.setAttribute(n,""+t)})},C=(e,t)=>{e.parentNode&&e.parentNode.replaceChild(t,e)},ne=(e,t)=>{if(t===null)return;if(typeof t=="string"){if(!t.length)return;t=new RegExp(t,"i")}const s=e=>{var n,s,i,o=e.data.match(t);return o&&e.data.length>0?(n=document.createElement("span"),n.className="highlight",s=e.splitText(o.index),s.splitText(o[0].length),i=s.cloneNode(!0),n.appendChild(i),C(s,n),1):0},o=e=>{e.nodeType===1&&e.childNodes&&!/(script|style)/i.test(e.tagName)&&(e.className!=="highlight"||e.tagName!=="SPAN")&&Array.from(e.childNodes).forEach(e=>{n(e)})},n=e=>e.nodeType===3?s(e):(o(e),0);n(e)},se=e=>{var t=e.querySelectorAll("span.highlight");Array.prototype.forEach.call(t,function(e){var t=e.parentNode;t.replaceChild(e.firstChild,e),t.normalize()})},oe=65,ie=13,K=27,re=37,X=38,le=39,de=40,U=8,he=46,S=9,fe=typeof navigator!="undefined"&&/Mac/.test(navigator.userAgent),p=fe?"metaKey":"ctrlKey";var A,$={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(e){return e.length>0},render:{}};const a=e=>typeof e=="undefined"||e===null?null:f(e),f=e=>typeof e=="boolean"?e?"1":"0":e+"",g=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),ye=(e,t)=>{var n;return function(s,o){var i=this;n&&(i.loading=Math.max(i.loading-1,0),clearTimeout(n)),n=setTimeout(function(){n=null,i.loadedSearches[s]=!0,e.call(i,s,o)},t)}},H=(e,t,n)=>{var s,o=e.trigger,i={};e.trigger=function(){var n=arguments[0];if(t.indexOf(n)!==-1)i[n]=arguments;else return o.apply(e,arguments)},n.apply(e,[]),e.trigger=o;for(s of t)s in i&&o.apply(e,i[s])},we=e=>({start:e.selectionStart||0,length:(e.selectionEnd||0)-(e.selectionStart||0)}),e=(e,t=!1)=>{e&&(e.preventDefault(),t&&e.stopPropagation())},n=(e,t,n,s)=>{e.addEventListener(t,n,s)},l=(e,t)=>{if(!t)return!1;if(!t[e])return!1;var n=(t.altKey?1:0)+(t.ctrlKey?1:0)+(t.shiftKey?1:0)+(t.metaKey?1:0);return n===1},w=(e,t)=>{const n=e.getAttribute("id");return n||(e.setAttribute("id",t),t)},R=e=>e.replace(/[\\"']/g,"\\$&"),c=(e,t)=>{t&&e.append(t)};function N(e,t){var n,f,p,s=Object.assign({},$,t),h=s.dataAttr,d=s.labelField,i=s.valueField,r=s.disabledField,o=s.optgroupField,m=s.optgroupLabelField,l=s.optgroupValueField,g=e.tagName.toLowerCase(),c=e.getAttribute("placeholder")||e.getAttribute("data-placeholder");if(!c&&!s.allowEmptyOption){let t=e.querySelector('option[value=""]');t&&(c=t.textContent)}return n={placeholder:c,options:[],optgroups:[],items:[],maxItems:null},f=()=>{var c,g=n.options,t={},v=1,f=e=>{var t=Object.assign({},e.dataset),n=h&&t[h];return typeof n=="string"&&n.length&&(t=Object.assign(t,JSON.parse(n))),t},p=(e,c)=>{var l,h,u=a(e.value);if(u==null)return;if(!u&&!s.allowEmptyOption)return;t.hasOwnProperty(u)?c&&(h=t[u][o],h?Array.isArray(h)?h.push(c):t[u][o]=[h,c]:t[u][o]=c):(l=f(e),l[d]=l[d]||e.textContent,l[i]=l[i]||u,l[r]=l[r]||e.disabled,l[o]=l[o]||c,l.$option=e,t[u]=l,g.push(l)),e.selected&&n.items.push(u)},b=e=>{var s,t=f(e);t[m]=t[m]||e.getAttribute("label")||"",t[l]=t[l]||v++,t[r]=t[r]||e.disabled,n.optgroups.push(t),s=t[l],u(e.children,e=>{p(e,s)})};n.maxItems=e.hasAttribute("multiple")?null:1,u(e.children,e=>{c=e.tagName.toLowerCase(),c==="optgroup"?b(e):c==="option"&&p(e)})},p=()=>{const t=e.getAttribute(h);if(t)n.options=JSON.parse(t),u(n.options,e=>{n.items.push(e[i])});else{var o=e.value.trim()||"";if(!s.allowEmptyOption&&!o.length)return;const t=o.split(s.delimiter);u(t,e=>{const t={};t[d]=e,t[i]=e,n.options.push(t)}),n.items=t}},g==="select"?f():p(),Object.assign({},$,n,t)}A=0;class d extends Me(Fe){constructor(e,n){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],A++;var l,d,p,b,j,r=o(e);if(r.tomselect)throw new Error("Tom Select already initialized on this element");r.tomselect=this,b=window.getComputedStyle&&window.getComputedStyle(r,null),p=b.getPropertyValue("direction");const a=N(r,n);this.settings=a,this.input=r,this.tabIndex=r.tabIndex||0,this.is_select_tag=r.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(p),this.inputId=w(r,"tomselect-"+A),this.isRequired=r.required,this.sifter=new _e(this.options,{diacritics:a.diacritics}),a.mode=a.mode||(a.maxItems===1?"single":"multi"),typeof a.hideSelected!="boolean"&&(a.hideSelected=a.mode==="multi"),typeof a.hidePlaceholder!="boolean"&&(a.hidePlaceholder=a.mode!=="multi"),d=a.createFilter,typeof d!="function"&&(typeof d=="string"&&(d=new RegExp(d)),d instanceof RegExp?a.createFilter=e=>d.test(e):a.createFilter=e=>this.settings.duplicates||!this.options[e]),this.initializePlugins(a.plugins),this.setupCallbacks(),this.setupTemplates();const m=o("<div>"),u=o("<div>"),h=this._render("dropdown"),f=o(`<div role="listbox" tabindex="-1">`),g=this.input.getAttribute("class")||"",v=a.mode;i(m,a.wrapperClass,g,v),i(u,a.controlClass),c(m,u),i(h,a.dropdownClass,v),a.copyClassesToDropdown&&i(h,g),i(f,a.dropdownContentClass),c(h,f),o(a.dropdownParent||m).appendChild(h),V(a.controlInput)?(l=o(a.controlInput),j=["autocorrect","autocapitalize","autocomplete"],s(j,e=>{r.getAttribute(e)&&t(l,{[e]:r.getAttribute(e)})}),l.tabIndex=-1,u.appendChild(l),this.focus_node=l):a.controlInput?(l=o(a.controlInput),this.focus_node=l):(l=o("<input/>"),this.focus_node=u),this.wrapper=m,this.dropdown=h,this.dropdown_content=f,this.control=u,this.control_input=l,this.setup()}setup(){const s=this,o=s.settings,c=s.control_input,l=s.dropdown,f=s.dropdown_content,m=s.wrapper,j=s.control,a=s.input,d=s.focus_node,g={passive:!0},p=s.inputId+"-ts-dropdown";t(f,{id:p}),t(d,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":p});const y=w(d,s.inputId+"-ts-control"),_="label[for='"+ge(s.inputId)+"']",r=document.querySelector(_),v=s.focus.bind(s);if(r){n(r,"click",v),t(r,{for:y});const e=w(r,s.inputId+"-ts-label");t(d,{"aria-labelledby":e}),t(f,{"aria-labelledby":e})}if(m.style.width=a.style.width,s.plugins.names.length){const e="plugin-"+s.plugins.names.join(" plugin-");i([m,l],e)}(o.maxItems===null||o.maxItems>1)&&s.is_select_tag&&t(a,{multiple:"multiple"}),o.placeholder&&t(c,{placeholder:o.placeholder}),!o.splitOn&&o.delimiter&&(o.splitOn=new RegExp("\\s*"+h(o.delimiter)+"+\\s*")),o.load&&o.loadThrottle&&(o.load=ye(o.load,o.loadThrottle)),s.control_input.type=a.type,n(l,"mousemove",()=>{s.ignoreHover=!1}),n(l,"mouseenter",e=>{var t=O(e.target,"[data-selectable]",l);t&&s.onOptionHover(e,t)},{capture:!0}),n(l,"click",t=>{const n=O(t.target,"[data-selectable]");n&&(s.onOptionSelect(t,n),e(t,!0))}),n(j,"click",t=>{var n=O(t.target,"[data-ts-item]",j);if(n&&s.onItemSelect(t,n)){e(t,!0);return}if(c.value!="")return;s.onClick(),e(t,!0)}),n(d,"keydown",e=>s.onKeyDown(e)),n(c,"keypress",e=>s.onKeyPress(e)),n(c,"input",e=>s.onInput(e)),n(d,"blur",e=>s.onBlur(e)),n(d,"focus",e=>s.onFocus(e)),n(c,"paste",e=>s.onPaste(e));const b=t=>{const n=t.composedPath()[0];if(!m.contains(n)&&!l.contains(n)){s.isFocused&&s.blur(),s.inputState();return}n==c&&s.isOpen?t.stopPropagation():e(t,!0)},u=()=>{s.isOpen&&s.positionDropdown()};n(document,"mousedown",b),n(window,"scroll",u,g),n(window,"resize",u,g),this._destroy=()=>{document.removeEventListener("mousedown",b),window.removeEventListener("scroll",u),window.removeEventListener("resize",u),r&&r.removeEventListener("click",v)},this.revertSettings={innerHTML:a.innerHTML,tabIndex:a.tabIndex},a.tabIndex=-1,a.insertAdjacentElement("afterend",s.wrapper),s.sync(!1),o.items=[],delete o.optgroups,delete o.options,n(a,"invalid",()=>{s.isValid&&(s.isValid=!1,s.isInvalid=!0,s.refreshState())}),s.updateOriginalInput(),s.refreshItems(),s.close(!1),s.inputState(),s.isSetup=!0,a.disabled?s.disable():s.enable(),s.on("change",this.onChange),i(a,"tomselected","ts-hidden-accessible"),s.trigger("initialize"),o.preload===!0&&s.preload()}setupOptions(e=[],t=[]){this.addOptions(e),s(t,e=>{this.registerOptionGroup(e)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,s={optgroup:e=>{let t=document.createElement("div");return t.className="optgroup",t.appendChild(e.options),t},optgroup_header:(e,t)=>'<div class="optgroup-header">'+t(e[n])+"</div>",option:(e,n)=>"<div>"+n(e[t])+"</div>",item:(e,n)=>"<div>"+n(e[t])+"</div>",option_create:(e,t)=>'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},s,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?N(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){k(this.input,"input"),k(this.input,"change")}onPaste(t){var n=this;if(n.isInputHidden||n.isLocked){e(t);return}if(!n.settings.splitOn)return;setTimeout(()=>{var t,e=n.inputValue();if(!e.match(n.settings.splitOn))return;t=e.trim().split(n.settings.splitOn),s(t,e=>{const t=a(e);t&&(this.options[e]?n.addItem(e):n.createItem(e))})},0)}onKeyPress(t){var s,n=this;if(n.isLocked){e(t);return}if(s=String.fromCharCode(t.keyCode||t.which),n.settings.create&&n.settings.mode==="multi"&&s===n.settings.delimiter){n.createItem(),e(t);return}}onKeyDown(t){var n=this;if(n.ignoreHover=!0,n.isLocked){t.keyCode!==S&&e(t);return}switch(t.keyCode){case oe:if(l(p,t)&&n.control_input.value==""){e(t),n.selectAll();return}break;case K:n.isOpen&&(e(t,!0),n.close()),n.clearActiveItems();return;case de:if(!n.isOpen&&n.hasOptions)n.open();else if(n.activeOption){let e=n.getAdjacent(n.activeOption,1);e&&n.setActiveOption(e)}e(t);return;case X:if(n.activeOption){let e=n.getAdjacent(n.activeOption,-1);e&&n.setActiveOption(e)}e(t);return;case ie:n.canSelect(n.activeOption)?(n.onOptionSelect(t,n.activeOption),e(t)):n.settings.create&&n.createItem()?e(t):document.activeElement==n.control_input&&n.isOpen&&e(t);return;case re:n.advanceSelection(-1,t);return;case le:n.advanceSelection(1,t);return;case S:n.settings.selectOnTab&&(n.canSelect(n.activeOption)&&(n.onOptionSelect(t,n.activeOption),e(t)),n.settings.create&&n.createItem()&&e(t));return;case U:case he:n.deleteSelection(t);return}n.isInputHidden&&!l(p,t)&&e(t)}onInput(){var n,t=this;if(t.isLocked)return;n=t.inputValue(),t.lastValue!==n&&(t.lastValue=n,t.settings.shouldLoad.call(t,n)&&t.load(n),t.refreshOptions(),t.trigger("type",n))}onOptionHover(e,t){if(this.ignoreHover)return;this.setActiveOption(t,!1)}onFocus(t){var n=this,s=n.isFocused;if(n.isDisabled){n.blur(),e(t);return}if(n.ignoreFocus)return;n.isFocused=!0,n.settings.preload==="focus"&&n.preload(),s||n.trigger("focus"),n.activeItems.length||(n.showInput(),n.refreshOptions(!!n.settings.openOnFocus)),n.refreshState()}onBlur(){if(document.hasFocus()===!1)return;var n,t=this;if(!t.isFocused)return;t.isFocused=!1,t.ignoreFocus=!1,n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")},t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}onOptionSelect(e,t){var s,n=this;if(t.parentElement&&t.parentElement.matches("[data-disabled]"))return;t.classList.contains("create")?n.createItem(null,()=>{n.settings.closeAfterSelect&&n.close()}):(s=t.dataset.value,typeof s!="undefined"&&(n.lastQuery=null,n.addItem(s),n.settings.closeAfterSelect&&n.close(),!n.settings.hideSelected&&e.type&&/click/.test(e.type)&&n.setActiveOption(t)))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(t,n){var s=this;return!s.isLocked&&s.settings.mode==="multi"&&(e(t),s.setActiveItem(n,t),!0)}canLoad(e){return!!this.settings.load&&!this.loadedSearches.hasOwnProperty(e)}load(e){const t=this;if(!t.canLoad(e))return;i(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||r(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;if(e.contains("preloaded"))return;e.add("preloaded"),this.load("")}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,k(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];H(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(t,n){var o,i,a,r,c,d,s=this;if(s.settings.mode==="single")return;if(!t){s.clearActiveItems(),s.isFocused&&s.showInput();return}if(a=n&&n.type.toLowerCase(),a==="click"&&l("shiftKey",n)&&s.activeItems.length){d=s.getLastActive(),o=Array.prototype.indexOf.call(s.control.children,d),i=Array.prototype.indexOf.call(s.control.children,t),o>i&&(c=o,o=i,i=c);for(r=o;r<=i;r++)t=s.control.children[r],s.activeItems.indexOf(t)===-1&&s.setActiveItemClass(t);e(n)}else a==="click"&&l(p,n)||a==="keydown"&&l("shiftKey",n)?t.classList.contains("active")?s.removeActiveItem(t):s.setActiveItemClass(t):(s.clearActiveItems(),s.setActiveItemClass(t));s.hideInput(),s.isFocused||s.focus()}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&r(n,"last-active"),i(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),r(e,"active")}clearActiveItems(){r(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,n=!0){if(e===this.activeOption)return;if(this.clearActiveOption(),!e)return;this.activeOption=e,t(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),t(e,{"aria-selected":"true"}),i(e,"active"),n&&this.scrollToOption(e)}scrollToOption(e,t){if(!e)return;const s=this.dropdown_content,i=s.clientHeight,o=s.scrollTop||0,a=e.offsetHeight,n=e.getBoundingClientRect().top-s.getBoundingClientRect().top+o;n+a>i+o?this.scroll(n-i+a,t):n<o&&this.scroll(n,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(r(this.activeOption,"active"),t(this.activeOption,{"aria-selected":null})),this.activeOption=null,t(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();if(!t.length)return;e.hideInput(),e.close(),e.activeItems=t,s(t,t=>{e.setActiveItemClass(t)})}inputState(){var e=this;if(!e.control.contains(e.control_input))return;t(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&t(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden)}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var e=this;if(e.isDisabled)return;e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0)}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var n,s,t=this,o=this.getSearchOptions();if(t.settings.score&&(s=t.settings.score.call(t,e),typeof s!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==t.lastQuery?(t.lastQuery=e,n=t.sifter.search(e,Object.assign(o,{score:s})),t.currentResults=n):n=Object.assign({},t.currentResults),t.settings.hideSelected&&(n.items=n.items.filter(e=>{let n=a(e.id);return!n||t.items.indexOf(n)===-1})),n}refreshOptions(e=!0){const y={},_=[];var o,i,a,l,d,h,m,p,g,v,b,j,w,O,x,n=this,u=n.inputValue();const C=u===n.lastQuery||u==""&&n.lastQuery==null;a=n.search(u),o=null,b=n.settings.shouldOpen||!1,l=n.dropdown_content,C&&(o=n.activeOption,o&&(w=o.closest("[data-group]"))),m=a.items.length,typeof n.settings.maxOptions=="number"&&(m=Math.min(m,n.settings.maxOptions)),m>0&&(b=!0);for(j=0;j<m;j++){let l=a.items[j];if(!l)continue;let s=l.id,c=n.options[s];if(c===void 0)continue;let u=f(s),e=n.getOption(u,!0);n.settings.hideSelected||e.classList.toggle("selected",n.items.includes(u)),i=c[n.settings.optgroupField]||"",p=Array.isArray(i)?i:[i];for(d=0,x=p&&p.length;d<x;d++){i=p[d],n.optgroups.hasOwnProperty(i)||(i="");let a=y[i];a===void 0&&(a=document.createDocumentFragment(),_.push(i)),d>0&&(e=e.cloneNode(!0),t(e,{id:c.$id+"-clone-"+d,"aria-selected":null}),e.classList.add("ts-cloned"),r(e,"active"),n.activeOption&&n.activeOption.dataset.value==s&&w&&w.dataset.group===i.toString()&&(o=e)),a.appendChild(e),y[i]=a}}if(n.settings.lockOptgroupOrder&&_.sort((e,t)=>{const s=n.optgroups[e],o=n.optgroups[t],i=s&&s.$order||0,a=o&&o.$order||0;return i-a}),v=document.createDocumentFragment(),s(_,e=>{let t=y[e];if(!t||!t.children.length)return;let s=n.optgroups[e];if(s!==void 0){let e=document.createDocumentFragment(),o=n.render("optgroup_header",s);c(e,o),c(e,t);let i=n.render("optgroup",{group:s,options:e});c(v,i)}else c(v,t)}),l.innerHTML="",c(l,v),n.settings.highlight&&(se(l),a.query.length&&a.tokens.length&&s(a.tokens,e=>{ne(l,e.regex)})),h=e=>{let t=n.render(e,{input:u});return t&&(b=!0,l.insertBefore(t,l.firstChild)),t},n.loading?h("loading"):n.settings.shouldLoad.call(n,u)?a.items.length===0&&h("no_results"):h("not_loading"),O=n.canCreate(u),O&&(g=h("option_create")),n.hasOptions=a.items.length>0||O,b){if(a.items.length>0){if(!o&&n.settings.mode==="single"&&n.items[0]!=void 0&&(o=n.getOption(n.items[0])),!l.contains(o)){let e=0;g&&!n.settings.addPrecedence&&(e=1),o=n.selectable()[e]}}else g&&(o=g);e&&!n.isOpen&&(n.open(),n.scrollToOption(o,"auto")),n.setActiveOption(o)}else n.clearActiveOption(),e&&n.isOpen&&n.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const s=a(e[n.settings.valueField]);return s!==null&&!n.options.hasOwnProperty(s)&&(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[s]=e,n.lastQuery=null,t&&(n.userOptions[s]=t,n.trigger("option_add",s,e)),s)}addOptions(e,t=!1){s(e,e=>{this.addOption(e,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=a(e[this.settings.optgroupValueField]);return t!==null&&(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var c,l;const s=a(e),r=a(t[n.settings.valueField]);if(s===null)return;const u=n.options[s];if(u==null)return;if(typeof r!="string")throw new Error("Value must be set in option data");const o=n.getOption(s),d=n.getItem(s);if(t.$order=t.$order||u.$order,delete n.options[s],n.uncacheValue(r),n.options[r]=t,o){if(n.dropdown_content.contains(o)){const e=n._render("option",t);C(o,e),n.activeOption===o&&n.setActiveOption(e)}o.remove()}d&&(l=n.items.indexOf(s),l!==-1&&n.items.splice(l,1,r),c=n._render("item",t),d.classList.contains("active")&&i(c,"active"),C(d,c)),n.lastQuery=null}removeOption(e,t){const n=this;e=f(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const n=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const t={};s(this.options,(e,s)=>{n(e,s)&&(t[s]=e)}),this.options=this.sifter.items=t,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const s=a(e);if(s===null)return null;const n=this.options[s];if(n!=null){if(n.$div)return n.$div;if(t)return this._render("option",n)}return null}getAdjacent(e,t,n="option"){var s,o=this;if(!e)return null;n=="item"?s=o.controlChildren():s=o.dropdown_content.querySelectorAll("[data-selectable]");for(let n=0;n<s.length;n++){if(s[n]!=e)continue;return t>0?s[n+1]:s[n-1]}return null}getItem(e){if(typeof e=="object")return e;var t=a(e);return t!==null?this.control.querySelector(`[data-value="${R(t)}"]`):null}addItems(e,t){var s=this,n=Array.isArray(e)?e:[e],n=n.filter(e=>s.items.indexOf(e)===-1);const o=n[n.length-1];n.forEach(e=>{s.isPending=e!==o,s.addItem(e,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];H(this,n,()=>{var o,r;const n=this,i=n.settings.mode,s=a(e);if(s&&n.items.indexOf(s)!==-1&&(i==="single"&&n.close(),i==="single"||!n.settings.duplicates))return;if(s===null||!n.options.hasOwnProperty(s))return;if(i==="single"&&n.clear(t),i==="multi"&&n.isFull())return;if(o=n._render("item",n.options[s]),n.control.contains(o)&&(o=o.cloneNode(!0)),r=n.isFull(),n.items.splice(n.caretPos,0,s),n.insertAtCaret(o),n.isSetup){if(!n.isPending&&n.settings.hideSelected){let t=n.getOption(s),e=n.getAdjacent(t,1);e&&n.setActiveOption(e)}!n.isPending&&!n.settings.closeAfterSelect&&n.refreshOptions(n.isFocused&&i!=="single"),n.settings.closeAfterSelect!=!1&&n.isFull()?n.close():n.isPending||n.positionDropdown(),n.trigger("item_add",s,o),n.isPending||n.updateOriginalInput({silent:t})}(!n.isPending||!r&&n.isFull())&&(n.inputState(),n.refreshState())})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var s,i;const o=e.dataset.value;s=E(e),e.remove(),e.classList.contains("active")&&(i=n.activeItems.indexOf(e),n.activeItems.splice(i,1),r(e,"active")),n.items.splice(s,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(o)&&n.removeOption(o,t),s<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",o,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var s,o,i,n=this,r=n.caretPos;return e=e||n.inputValue(),n.canCreate(e)?(n.lock(),o=!1,i=e=>{if(n.unlock(),!e||typeof e!="object")return t();var s=a(e[n.settings.valueField]);if(typeof s!="string")return t();n.setTextboxValue(),n.addOption(e,!0),n.setCaret(r),n.addItem(s),t(e),o=!0},typeof n.settings.create=="function"?s=n.settings.create.call(this,e,i):s={[n.settings.labelField]:e,[n.settings.valueField]:e},o||i(s),!0):(t(),!1)}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const n=e.isFull(),s=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const t=e.wrapper.classList;t.toggle("focus",e.isFocused),t.toggle("disabled",e.isDisabled),t.toggle("required",e.isRequired),t.toggle("invalid",!e.isValid),t.toggle("locked",s),t.toggle("full",n),t.toggle("input-active",e.isFocused&&!e.isInputHidden),t.toggle("dropdown-active",e.isOpen),t.toggle("has-options",Z(e.options)),t.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;if(!e.input.validity)return;e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,s;const i=t.input.querySelector('option[value=""]');if(t.is_select_tag){const e=[],r=t.input.querySelectorAll("option:checked").length;function a(n,s,a){return n||(n=o('<option value="'+g(s)+'">'+g(a)+"</option>")),n!=i&&t.input.append(n),e.push(n),(n!=i||r>0)&&(n.selected=!0),n}t.input.querySelectorAll("option:checked").forEach(e=>{e.selected=!1}),t.items.length==0&&t.settings.mode=="single"?a(i,"",""):t.items.forEach(o=>{if(n=t.options[o],s=n[t.settings.labelField]||"",e.includes(n.$option)){const e=t.input.querySelector(`option[value="${R(o)}"]:not(:checked)`);a(e,o,s)}else n.$option=a(n.$option,o,s)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;if(e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull())return;e.isOpen=!0,t(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),m(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),m(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown)}close(e=!0){var n=this,s=n.isOpen;e&&(n.setTextboxValue(),n.settings.mode==="single"&&n.items.length&&n.hideInput()),n.isOpen=!1,t(n.focus_node,{"aria-expanded":"false"}),m(n.dropdown,{display:"none"}),n.settings.hideSelected&&n.clearActiveOption(),n.refreshState(),s&&n.trigger("dropdown_close",n.dropdown)}positionDropdown(){if(this.settings.dropdownParent!=="body")return;var t=this.control,e=t.getBoundingClientRect(),n=t.offsetHeight+e.top+window.scrollY,s=e.left+window.scrollX;m(this.dropdown,{width:e.width+"px",top:n+"px",left:s+"px"})}clear(e){var n,t=this;if(!t.items.length)return;n=t.controlChildren(),s(n,e=>{t.removeItem(e,!0)}),t.showInput(),e||t.updateOriginalInput(),t.trigger("clear")}insertAtCaret(e){const t=this,n=t.caretPos,s=t.control;s.insertBefore(e,s.children[n]||null),t.setCaret(n+1)}deleteSelection(t){var a,c,n=this,i=t&&t.keyCode===U?-1:1,r=we(n.control_input);const o=[];if(n.activeItems.length)c=D(n.activeItems,i),a=E(c),i>0&&a++,s(n.activeItems,e=>o.push(e));else if((n.isFocused||n.settings.mode==="single")&&n.items.length){const t=n.controlChildren();let e;i<0&&r.start===0&&r.length===0?e=t[n.caretPos-1]:i>0&&r.start===n.inputValue().length&&(e=t[n.caretPos]),e!==void 0&&o.push(e)}if(!n.shouldDelete(o,t))return!1;for(e(t,!0),typeof a!="undefined"&&n.setCaret(a);o.length;)n.removeItem(o.pop());return n.showInput(),n.positionDropdown(),n.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(e=>e.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var s,o,n=this;if(n.rtl&&(e*=-1),n.inputValue().length)return;l(p,t)||l("shiftKey",t)?(o=n.getLastActive(e),o?o.classList.contains("active")?s=n.getAdjacent(o,e,"item"):s=o:e>0?s=n.control_input.nextElementSibling:s=n.control_input.previousElementSibling,s&&(s.classList.contains("active")&&n.removeActiveItem(o),n.setActiveItemClass(s))):n.moveCaret(e)}moveCaret(){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return D(n,e)}setCaret(){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){var e=this;e.input.disabled=!0,e.control_input.disabled=!0,e.focus_node.tabIndex=-1,e.isDisabled=!0,this.close(),e.lock()}enable(){var e=this;e.input.disabled=!1,e.control_input.disabled=!1,e.focus_node.tabIndex=e.tabIndex,e.isDisabled=!1,e.unlock()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,r(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,n){var s,r;const a=this;if(typeof this.settings.render[e]!="function")return null;if(s=a.settings.render[e].call(this,n,g),!s)return null;if(s=o(s),e==="option"||e==="option_create"?n[a.settings.disabledField]?t(s,{"aria-disabled":"true"}):t(s,{"data-selectable":""}):e==="optgroup"&&(r=n.group[a.settings.optgroupValueField],t(s,{"data-group":r}),n.group[a.settings.disabledField]&&t(s,{"data-disabled":""})),e==="option"||e==="item"){const o=f(n[a.settings.valueField]);t(s,{"data-value":o}),e==="item"?(i(s,a.settings.itemClass),t(s,{"data-ts-item":""})):(i(s,a.settings.optionClass),t(s,{role:"option",id:n.$id}),n.$div=s,a.options[o]=n)}return s}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){s(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var s=this,o=s[t];s[t]=function(){var t,i;return e==="after"&&(t=o.apply(s,arguments)),i=n.apply(s,arguments),e==="instead"?i:(e==="before"&&(t=o.apply(s,arguments)),t)}}}function Te(){var e=this;e.hook("instead","setCaret",t=>{e.settings.mode==="single"||!e.control.contains(e.control_input)?t=e.items.length:(t=Math.max(0,Math.min(e.items.length,t)),t!=e.caretPos&&!e.isPending&&e.controlChildren().forEach((n,s)=>{s<t?e.control_input.insertAdjacentElement("beforebegin",n):e.control.appendChild(n)})),e.caretPos=t}),e.hook("instead","moveCaret",t=>{if(!e.isFocused)return;const n=e.getLastActive(t);if(n){const s=E(n);e.setCaret(t>0?s+1:s),e.setActiveItem(),r(n,"last-active")}else e.setCaret(e.caretPos+t)})}function ze(){const t=this;t.settings.shouldOpen=!0,t.hook("before","setup",()=>{t.focus_node=t.control,i(t.control_input,"dropdown-input");const e=o('<div class="dropdown-input-wrap">');e.append(t.control_input),t.dropdown.insertBefore(e,t.dropdown.firstChild);const n=o('<input class="items-placeholder" tabindex="-1" />');n.placeholder=t.settings.placeholder||"",t.control.append(n)}),t.on("initialize",()=>{t.control_input.addEventListener("keydown",n=>{switch(n.keyCode){case K:t.isOpen&&(e(n,!0),t.close()),t.clearActiveItems();return;case S:t.focus_node.tabIndex=-1;break}return t.onKeyDown.call(t,n)}),t.on("blur",()=>{t.focus_node.tabIndex=t.isDisabled?-1:t.tabIndex}),t.on("dropdown_open",()=>{t.control_input.focus()});const s=t.onBlur;t.hook("instead","onBlur",e=>{if(e&&e.relatedTarget==t.control_input)return;return s.call(t)}),n(t.control_input,"blur",()=>t.onBlur()),t.hook("before","close",()=>{if(!t.isOpen)return;t.focus_node.focus({preventScroll:!0})})})}function De(){var e=this,t=e.deleteSelection;this.hook("instead","deleteSelection",n=>!!e.activeItems.length&&t.call(e,n))}function Ne(t){const i=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},t);var a,s=this;if(!i.append)return;a='<a href="javascript:void(0)" class="'+i.className+'" tabindex="-1" title="'+g(i.title)+'">'+i.label+"</a>",s.hook("after","setupTemplates",()=>{var t=s.settings.render.item;s.settings.render.item=(i,r)=>{var c=o(t.call(s,i,r)),l=o(a);return c.appendChild(l),n(l,"mousedown",t=>{e(t,!0)}),n(l,"click",t=>{if(e(t,!0),s.isLocked)return;if(!s.shouldDelete([c],t))return;s.removeItem(c),s.refreshOptions(!1),s.inputState()}),c}})}function Le(e){const t=this,n=Object.assign({text:e=>e[t.settings.labelField]},e);t.on("item_remove",function(e){if(!t.isFocused)return;if(t.control_input.value.trim()===""){var s=t.options[e];s&&t.setTextboxValue(n.text.call(t,s))}})}return d.define("caret_position",Te),d.define("dropdown_input",ze),d.define("no_backspace_delete",De),d.define("remove_button",Ne),d.define("restore_on_backspace",Le),d});var tomSelect=function(e,t){return new TomSelect(e,t)}