!function(){"use strict";u=tinymce.util.Tools.resolve("tinymce.PluginManager");const v=("string",e=>"string"===(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&(s=o=e,(i=String).prototype.isPrototypeOf(s)||(null===(n=o.constructor)||void 0===n?void 0:n.name)===i.name)?"string":t;var n,s,o,i})(e)),p=(void 0,e=>void 0===e);var l,u,f=tinymce.util.Tools.resolve("tinymce.util.Delay"),e=tinymce.util.Tools.resolve("tinymce.util.LocalStorage"),a=tinymce.util.Tools.resolve("tinymce.util.Tools");const g=e=>{const t=/^(\d+)([ms]?)$/.exec(e);return(t&&t[2]?{s:1e3,m:6e4}[t[2]]:1)*parseInt(e,10)},t=e=>t=>t.options.get(e),j=t("autosave_ask_before_unload"),b=t("autosave_restore_when_empty"),m=t("autosave_interval"),h=t("autosave_retention"),s=e=>{const t=document.location;return e.options.get("autosave_prefix").replace(/{path}/g,t.pathname).replace(/{query}/g,t.search).replace(/{hash}/g,t.hash).replace(/{id}/g,e.id)},d=(e,t)=>{if(p(t))return e.dom.isEmpty(e.getBody());{const n=a.trim(t);if(""===n)return!0;{const t=(new DOMParser).parseFromString(n,"text/html");return e.dom.isEmpty(t)}}},n=t=>{var n;const o=parseInt(null!==(n=e.getItem(s(t)+"time"))&&void 0!==n?n:"0",10)||0;return!((new Date).getTime()-o>h(t)&&(i(t,!1),1))},i=(t,n)=>{const o=s(t);e.removeItem(o+"draft"),e.removeItem(o+"time"),!1!==n&&(e=>{e.dispatch("RemoveDraft")})(t)},r=t=>{const n=s(t);!d(t)&&t.isDirty()&&(e.setItem(n+"draft",t.getContent({format:"raw",no_events:!0})),e.setItem(n+"time",(new Date).getTime().toString()),(e=>{e.dispatch("StoreDraft")})(t))},o=t=>{var o;const i=s(t);n(t)&&(t.setContent(null!==(o=e.getItem(i+"draft"))&&void 0!==o?o:"",{format:"raw"}),(e=>{e.dispatch("RestoreDraft")})(t))};l=tinymce.util.Tools.resolve("tinymce.EditorManager");const c=e=>t=>{t.setEnabled(n(e));const s=()=>t.setEnabled(n(e));return e.on("StoreDraft RestoreDraft RemoveDraft",s),()=>e.off("StoreDraft RestoreDraft RemoveDraft",s)};u.add("autosave",e=>((e=>{const t=e.options.register,n=e=>{const t=v(e);return t?{value:g(e),valid:t}:{valid:!1,message:"Must be a string."}};t("autosave_ask_before_unload",{processor:"boolean",default:!0}),t("autosave_prefix",{processor:"string",default:"tinymce-autosave-{path}{query}{hash}-{id}-"}),t("autosave_restore_when_empty",{processor:"boolean",default:!1}),t("autosave_interval",{processor:n,default:"30s"}),t("autosave_retention",{processor:n,default:"20m"})})(e),(e=>{e.editorManager.on("BeforeUnload",e=>{let t;a.each(l.get(),e=>{e.plugins.autosave&&e.plugins.autosave.storeDraft(),!t&&e.isDirty()&&j(e)&&(t=e.translate("You have unsaved changes are you sure you want to navigate away?"))}),t&&(e.preventDefault(),e.returnValue=t)})})(e),(e=>{(e=>{const t=m(e);f.setEditorInterval(e,()=>{r(e)},t)})(e);const t=()=>{(e=>{e.undoManager.transact(()=>{o(e),i(e)}),e.focus()})(e)};e.ui.registry.addButton("restoredraft",{tooltip:"Restore last draft",icon:"restore-draft",onAction:t,onSetup:c(e)}),e.ui.registry.addMenuItem("restoredraft",{text:"Restore last draft",icon:"restore-draft",onAction:t,onSetup:c(e)})})(e),e.on("init",()=>{b(e)&&e.dom.isEmpty(e.getBody())&&o(e)}),(e=>({hasDraft:()=>n(e),storeDraft:()=>r(e),restoreDraft:()=>o(e),removeDraft:t=>i(e,t),isEmpty:t=>d(e,t)}))(e)))}()