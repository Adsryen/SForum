(function(){"use strict";var i,r,C=tinymce.util.Tools.resolve("tinymce.PluginManager");const l=e=>t=>e===t,Z=l(null),K=l(void 0),U=e=>e==null,H=e=>!U(e),T=()=>{},M=e=>()=>e,A=M(!1);class e{constructor(e,t){this.tag=e,this.value=t}static some(t){return new e(!0,t)}static none(){return e.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?e.some(t(this.value)):e.none()}bind(t){return this.tag?t(this.value):e.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(t){return!this.tag||t(this.value)?this:e.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e??"Called getOrDie on None")}static from(t){return H(t)?e.some(t):e.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}e.singletonNone=new e(!1);const E=(e,t)=>{for(let n=0,s=e.length;n<s;n++){const o=e[n];if(t(o,n))return!0}return!1},_=(e,t)=>{const n=e.length,s=new Array(n);for(let o=0;o<n;o++){const i=e[o];s[o]=t(i,o)}return s},b=(e,t)=>{for(let n=0,s=e.length;n<s;n++){const o=e[n];t(o,n)}},m=e=>{let t=e;const n=()=>t,s=e=>{t=e};return{get:n,set:s}},g=(e,t)=>{let n=null;const s=()=>{Z(n)||(clearTimeout(n),n=null)},o=(...o)=>{s(),n=setTimeout(()=>{n=null,e.apply(null,o)},t)};return{cancel:s,throttle:o}},z=(e,t)=>{e.insertContent(t)},a=Object.keys,v=Object.hasOwnProperty,h=(e,t)=>{const n=a(e);for(let s=0,i=n.length;s<i;s++){const o=n[s],a=e[o];t(a,o)}},j=(e,t)=>y(e,(e,n)=>({k:n,v:t(e,n)})),y=(e,t)=>{const n={};return h(e,(e,s)=>{const o=t(e,s);n[o.k]=o.v}),n},u=(e,t)=>v.call(e,t),w=(e,t)=>t,O=e=>(...t)=>{if(t.length===0)throw new Error(`Can't merge zero objects`);const n={};for(let s=0;s<t.length;s++){const o=t[s];for(const t in o)u(o,t)&&(n[t]=e(n[t],o[t]))}return n},x=O(w),f=t=>{const n=m(e.none()),s=()=>n.get().each(t),o=()=>{s(),n.set(e.none())},i=()=>n.get().isSome(),a=()=>n.get(),r=t=>{s(),n.set(e.some(t))};return{clear:o,isSet:i,get:a,set:r}},d=()=>{const e=f(T),t=t=>e.get().each(t);return{...e,on:t}},k=(e,t,n)=>t===""||e.length>=t.length&&e.substr(n,n+t.length)===t,c=(e,t,n=0,s)=>{const o=e.indexOf(t,n);return o!==-1&&(!!K(s)||o+t.length<=s)},S=(e,t)=>k(e,t,0);r=tinymce.util.Tools.resolve("tinymce.Resource");const F="tinymce.plugins.emoticons",n=e=>t=>t.options.get(e),p=(e,t)=>{const n=e.options.register;n("emoticons_database",{processor:"string",default:"emojis"}),n("emoticons_database_url",{processor:"string",default:`${t}/js/${D(e)}${e.suffix}.js`}),n("emoticons_database_id",{processor:"string",default:F}),n("emoticons_append",{processor:"object",default:{}}),n("emoticons_images_url",{processor:"string",default:"https://twemoji.maxcdn.com/v/13.0.1/72x72/"})},D=n("emoticons_database"),N=n("emoticons_database_url"),L=n("emoticons_database_id"),R=n("emoticons_append"),P=n("emoticons_images_url"),s="All",I={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},B=(e,t)=>u(e,t)?e[t]:t,V=e=>{const t=R(e);return j(t,e=>({keywords:[],category:"user",...e}))},$=(t,n,o)=>{const i=d(),c=d(),m=P(t),f=e=>S(e.char,"<img")?e.char.replace(/src="([^"]+)"/,(e,t)=>`src="${m}${t}"`):e.char,p=e=>{const t={},n=[];h(e,(e,s)=>{const o={title:s,keywords:e.keywords,char:f(e),category:B(I,e.category)},i=t[o.category]!==void 0?t[o.category]:[];t[o.category]=i.concat([o]),n.push(o)}),i.set(t),c.set(n)};t.on("init",()=>{r.load(o,n).then(e=>{const n=V(t);p(x(e,n))},e=>{console.log(`Failed to load emojis: ${e}`),i.set({}),c.set([])})});const g=t=>t===s?u():i.get().bind(n=>e.from(n[t])).getOr([]),u=()=>c.get().getOr([]),v=()=>[s].concat(a(i.get().getOr({}))),b=()=>l()?Promise.resolve(!0):new Promise((e,t)=>{let s=15;const o=setInterval(()=>{l()?(clearInterval(o),e(!0)):(s--,s<0&&(console.log("Could not load emojis from url: "+n),clearInterval(o),t(!1)))},100)}),l=()=>i.isSet()&&c.isSet();return{listCategories:v,hasLoaded:l,waitForLoad:b,listAll:u,listCategory:g}},W=(e,t)=>c(e.title.toLowerCase(),t)||E(e.keywords,e=>c(e.toLowerCase(),t)),o=(e,t,n)=>{const s=[],o=t.toLowerCase(),i=n.fold(()=>A,e=>t=>t>=e);for(let n=0;n<e.length;n++)if((t.length===0||W(e[n],o))&&(s.push({value:e[n].char,text:e[n].title,icon:e[n].char}),i(s.length)))break;return s},t="pattern",q=(n,i)=>{const d={pattern:"",results:o(i.listAll(),"",e.some(300))},c=m(s),u=n=>{const r=n.getData(),a=c.get(),l=i.listCategory(a),d=o(l,r[t],a===s?e.some(300):e.none());n.setData({results:d})},r=g(e=>{u(e)},200),h={label:"Search",type:"input",name:t},f={type:"collection",name:"results"},l=()=>{const e={type:"tabpanel",tabs:_(i.listCategories(),e=>({title:e,name:e,items:[h,f]}))};return{title:"Emojis",size:"normal",body:e,initialData:d,onTabChange:(e,t)=>{c.set(t.newTabName),r.throttle(e)},onChange:r.throttle,onAction:(e,t)=>{t.name==="results"&&(z(n,t.value),e.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}},a=n.windowManager.open(l());a.focus(t),i.hasLoaded()||(a.block("Loading emojis..."),i.waitForLoad().then(()=>{a.redial(l()),r.throttle(a),a.focus(t),a.unblock()}).catch(e=>{a.redial({title:"Emojis",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"Could not load emojis"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),a.focus(t),a.unblock()}))},Y=(e,t)=>{e.addCommand("mceEmoticons",()=>q(e,t))},G=e=>{e.on("PreInit",()=>{e.parser.addAttributeFilter("data-emoticon",e=>{b(e,e=>{e.attr("data-mce-resize","false"),e.attr("data-mce-placeholder","1")})})})},X=(t,n)=>{t.ui.registry.addAutocompleter("emoticons",{trigger:":",columns:"auto",minChars:2,fetch:(t,s)=>n.waitForLoad().then(()=>{const i=n.listAll();return o(i,t,e.some(s))}),onAction:(e,n,s)=>{t.selection.setRng(n),t.insertContent(s),e.hide()}})},Q=e=>{const t=()=>e.execCommand("mceEmoticons");e.ui.registry.addButton("emoticons",{tooltip:"Emojis",icon:"emoji",onAction:t}),e.ui.registry.addMenuItem("emoticons",{text:"Emojis...",icon:"emoji",onAction:t})};i=()=>{C.add("emoticons",(e,t)=>{p(e,t);const s=N(e),o=L(e),n=$(e,s,o);Y(e,n),Q(e),X(e,n),G(e)})},i()})()