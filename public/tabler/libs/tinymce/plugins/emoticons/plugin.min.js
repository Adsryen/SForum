!function(){"use strict";var a,c,v=tinymce.util.Tools.resolve("tinymce.PluginManager");const r=e=>t=>e===t,S=r(null),x=r(void 0),f=()=>{},b=()=>!1;class e{constructor(e,t){this.tag=e,this.value=t}static some(t){return new e(!0,t)}static none(){return e.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?e.some(t(this.value)):e.none()}bind(t){return this.tag?t(this.value):e.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(t){return!this.tag||t(this.value)?this:e.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e??"Called getOrDie on None")}static from(t){return t==null?e.none():e.some(t)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}e.singletonNone=new e(!1);const M=(e,t)=>{const n=e.length,s=new Array(n);for(let o=0;o<n;o++){const i=e[o];s[o]=t(i,o)}return s},i=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}},l=Object.keys,g=Object.hasOwnProperty,u=(e,t)=>{const n=l(e);for(let s=0,i=n.length;s<i;s++){const o=n[s];t(e[o],o)}},h=(e,t)=>g.call(e,t),O=(a=(e,t)=>t,(...e)=>{if(0===e.length)throw new Error("Can't merge zero objects");const t={};for(let n=0;n<e.length;n++){const s=e[n];for(const e in s)h(s,e)&&(t[e]=a(t[e],s[e]))}return t}),m=()=>{const t=(t=>{const n=i(e.none()),s=()=>n.get().each(t);return{clear:()=>{s(),n.set(e.none())},isSet:()=>n.get().isSome(),get:()=>n.get(),set:t=>{s(),n.set(e.some(t))}}})(f);return{...t,on:e=>t.get().each(e)}},d=(e,t,n=0,s)=>{const o=e.indexOf(t,n);return-1!==o&&(!!x(s)||o+t.length<=s)};c=tinymce.util.Tools.resolve("tinymce.Resource");const t=e=>t=>t.options.get(e),j=t("emoticons_database"),y=t("emoticons_database_url"),_=t("emoticons_database_id"),w=t("emoticons_append"),p=t("emoticons_images_url"),s="All",C={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},E=(e,t)=>h(e,t)?e[t]:t,k=e=>{const n=w(e);return t=e=>({keywords:[],category:"user",...e}),((e,t)=>{const n={};return u(e,(e,s)=>{const o=t(e,s);n[o.k]=o.v}),n})(n,(e,n)=>({k:n,v:t(e)}));var t},A=(e,t)=>d(e.title.toLowerCase(),t)||((e)=>{for(let n=0,o=e.length;n<o;n++)if(s=e[n],d(s.toLowerCase(),t))return!0;var s;return!1})(e.keywords),o=(e,t,n)=>{const s=[],o=t.toLowerCase(),i=n.fold(()=>b,e=>t=>t>=e);for(let n=0;n<e.length&&(0!==t.length&&!A(e[n],o)||(s.push({value:e[n].char,text:e[n].title,icon:e[n].char}),!i(s.length)));n++);return s},n="pattern",F=(t,a)=>{const u={pattern:"",results:o(a.listAll(),"",e.some(300))},l=i(s),c=((e)=>{let n=null;const s=()=>{S(n)||(clearTimeout(n),n=null)};return{cancel:s,throttle:(...t)=>{s(),n=setTimeout(()=>{n=null,e.apply(null,t)},200)}}})(t=>{(t=>{const i=t.getData(),n=l.get(),r=a.listCategory(n),c=o(r,i.pattern,n===s?e.some(300):e.none());t.setData({results:c})})(t)}),h={label:"Search",type:"input",name:n},m={type:"collection",name:"results"},d=()=>({title:"Emojis",size:"normal",body:{type:"tabpanel",tabs:M(a.listCategories(),e=>({title:e,name:e,items:[h,m]}))},initialData:u,onTabChange:(e,t)=>{l.set(t.newTabName),c.throttle(e)},onChange:c.throttle,onAction:(e,n)=>{"results"===n.name&&(((e,t)=>{e.insertContent(t)})(t,n.value),e.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}),r=t.windowManager.open(d());r.focus(n),a.hasLoaded()||(r.block("Loading emojis..."),a.waitForLoad().then(()=>{r.redial(d()),c.throttle(r),r.focus(n),r.unblock()}).catch(e=>{r.redial({title:"Emojis",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"Could not load emojis"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),r.focus(n),r.unblock()}))};v.add("emoticons",(t,n)=>{((e,t)=>{const n=e.options.register;n("emoticons_database",{processor:"string",default:"emojis"}),n("emoticons_database_url",{processor:"string",default:`${t}/js/${j(e)}${e.suffix}.js`}),n("emoticons_database_id",{processor:"string",default:"tinymce.plugins.emoticons"}),n("emoticons_append",{processor:"object",default:{}}),n("emoticons_images_url",{processor:"string",default:"https://twemoji.maxcdn.com/v/13.0.1/72x72/"})})(t,n);const i=((t,n,o)=>{const i=m(),a=m(),h=p(t),f=e=>{return t="<img",(n=e.char).length>=t.length&&n.substr(0,0+t.length)===t?e.char.replace(/src="([^"]+)"/,(e,t)=>`src="${h}${t}"`):e.char;var t,n};t.on("init",()=>{c.load(o,n).then(e=>{const n=k(t);(e=>{const t={},n=[];u(e,(e,s)=>{const o={title:s,keywords:e.keywords,char:f(e),category:E(C,e.category)},i=void 0!==t[o.category]?t[o.category]:[];t[o.category]=i.concat([o]),n.push(o)}),i.set(t),a.set(n)})(O(e,n))},e=>{console.log(`Failed to load emojis: ${e}`),i.set({}),a.set([])})});const d=()=>a.get().getOr([]),r=()=>i.isSet()&&a.isSet();return{listCategories:()=>[s].concat(l(i.get().getOr({}))),hasLoaded:r,waitForLoad:()=>r()?Promise.resolve(!0):new Promise((e,t)=>{let s=15;const o=setInterval(()=>{r()?(clearInterval(o),e(!0)):(s--,s<0&&(console.log("Could not load emojis from url: "+n),clearInterval(o),t(!1)))},100)}),listAll:d,listCategory:t=>t===s?d():i.get().bind(n=>e.from(n[t])).getOr([])}})(t,y(t),_(t));((e,t)=>{e.addCommand("mceEmoticons",()=>F(e,t))})(t,i),(e=>{const t=()=>e.execCommand("mceEmoticons");e.ui.registry.addButton("emoticons",{tooltip:"Emojis",icon:"emoji",onAction:t}),e.ui.registry.addMenuItem("emoticons",{text:"Emojis...",icon:"emoji",onAction:t})})(t),((t,n)=>{t.ui.registry.addAutocompleter("emoticons",{trigger:":",columns:"auto",minChars:2,fetch:(t,s)=>n.waitForLoad().then(()=>{const i=n.listAll();return o(i,t,e.some(s))}),onAction:(e,n,s)=>{t.selection.setRng(n),t.insertContent(s),e.hide()}})})(t,i),(e=>{e.on("PreInit",()=>{e.parser.addAttributeFilter("data-emoticon",e=>{((e)=>{for(let t=0,s=e.length;t<s;t++)(n=e[t]).attr("data-mce-resize","false"),n.attr("data-mce-placeholder","1");var n})(e)})})})(t)})}()