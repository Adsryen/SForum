!function(){"use strict";W=tinymce.util.Tools.resolve("tinymce.PluginManager");const _=e=>t=>(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&(s=o=e,(i=String).prototype.isPrototypeOf(s)||(null===(n=o.constructor)||void 0===n?void 0:n.name)===i.name)?"string":t;var n,s,o,i})(t)===e,se=e=>t=>typeof t===e,n=_("string"),J=_("object"),m=_("array"),ze=(null,e=>null===e),X=se("boolean"),u=e=>!(e=>e==null)(e),U=se("function"),$=(e,t)=>{if(m(e)){for(let n=0,s=e.length;n<s;++n)if(!t(e[n]))return!1;return!0}return!1},r=()=>{},Te=(e,t)=>e===t;class e{constructor(e,t){this.tag=e,this.value=t}static some(t){return new e(!0,t)}static none(){return e.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?e.some(t(this.value)):e.none()}bind(t){return this.tag?t(this.value):e.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(t){return!this.tag||t(this.value)?this:e.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e??"Called getOrDie on None")}static from(t){return u(t)?e.some(t):e.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}e.singletonNone=new e(!1);const Fe=Array.prototype.indexOf,Me=Array.prototype.push,R=e=>{const t=[];for(let n=0,s=e.length;n<s;++n){if(!m(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);Me.apply(t,e[n])}return t},D=(t,n)=>{for(let e=0;e<t.length;e++){const s=n(t[e],e);if(s.isSome())return s}return e.none()},z=(e,t,n=Te)=>e.exists(e=>n(e,t)),Se=e=>{const t=[],n=e=>{t.push(e)};for(let t=0;t<e.length;t++)e[t].each(n);return t},y=(t,n)=>t?e.some(n):e.none(),t=e=>t=>t.options.get(e),T=t("link_assume_external_targets"),Ae=t("link_context_toolbar"),ke=t("link_list"),C=t("link_default_target"),Ee=t("link_default_protocol"),k=t("link_target_list"),O=t("link_rel_list"),Ce=t("link_class_list"),xe=t("link_title"),F=t("allow_unsafe_link_target"),_e=t("link_quicklink");o=tinymce.util.Tools.resolve("tinymce.util.Tools");const v=e=>n(e.value)?e.value:"",N=(e,t)=>{const s=[];return o.each(e,e=>{const o=(e=>n(e.text)?e.text:n(e.title)?e.title:"")(e);if(void 0!==e.menu){const n=N(e.menu,t);s.push({text:o,items:n})}else{const n=t(e);s.push({text:o,value:n})}}),s},L=(t=v)=>n=>e.from(n).map(e=>N(e,t)),d=e=>L(v)(e),P=L,a=(e,t)=>n=>({name:e,type:"listbox",label:t,items:n}),je=v,he=Object.keys,de=Object.hasOwnProperty,l=(e,t)=>de.call(e,t);var o,M,B,W,oe=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),re=tinymce.util.Tools.resolve("tinymce.util.URI");const K=e=>u(e)&&"a"===e.nodeName.toLowerCase(),q=e=>K(e)&&!!h(e),Y=(e,t)=>{if(e.collapsed)return[];{const s=e.cloneContents(),o=s.firstChild,a=new oe(o,s),i=[];let n=o;do t(n)&&i.push(n);while(n=a.next())return i}},G=e=>/^\w+:/i.test(e),h=e=>{var t,n;return null!==(n=null!==(t=e.getAttribute("data-mce-href"))&&void 0!==t?t:e.getAttribute("href"))&&void 0!==n?n:""},Q=(e,t)=>{const n=["noopener"],s=e?e.split(/\s+/):[],i=e=>e.filter(e=>-1===o.inArray(n,e)),a=t?(e=>(e=i(e)).length>0?e.concat(n):n)(s):i(s);return a.length>0?(e=>o.trim(e.sort().join(" ")))(a):""},s=(t,n)=>(n=n||t.selection.getNode(),b(n)?e.from(t.dom.select("a[href]",n)[0]):e.from(t.dom.getParent(n,"a[href]"))),i=(e,t)=>s(e,t).isSome(),ee=(e,t)=>t.fold(()=>e.getContent({format:"text"}),e=>e.innerText||e.textContent||"").replace(/\uFEFF/g,""),te=e=>o.grep(e,q).length>0,ne=e=>{const n=e.schema.getTextInlineElements();if(s(e).exists(e=>e.hasAttribute("data-mce-block")))return!1;const t=e.selection.getRng();return!!t.collapsed||0===Y(t,e=>1===e.nodeType&&!K(e)&&!l(n,e.nodeName.toLowerCase())).length},b=e=>u(e)&&"FIGURE"===e.nodeName&&/\bimage\b/i.test(e.className),ae=(t,n,o)=>{const i=t.selection.getNode(),r=s(t,i),a=((t,n)=>{const s={...n};if(0===O(t).length&&!F(t)){const e=Q(s.rel,"_blank"===s.target);s.rel=e||null}return e.from(s.target).isNone()&&!1===k(t)&&(s.target=C(t)),s.href=((e,t)=>"http"!==t&&"https"!==t||G(e)?e:t+"://"+e)(s.href,T(t)),s})(t,(e=>{return n=["title","rel","class","target"],s=(t,n)=>(e[n].each(e=>{t[n]=e.length>0?e:null}),t),t={href:e.href},((e,t)=>{for(let n=0,s=e.length;n<s;n++)t(e[n],n)})(n,(e)=>{t=s(t,e)}),t;var t,n,s})(o));t.undoManager.transact(()=>{o.href===n.href&&n.attach(),r.fold(()=>{((e,t,n,s)=>{const o=e.dom;b(t)?le(o,t,s):n.fold(()=>{e.execCommand("mceInsertLink",!1,s)},t=>{e.insertContent(o.createHTML("a",s,o.encode(t)))})})(t,i,o.text,a)},e=>{t.focus(),((e,t,n,s)=>{n.each(e=>{l(t,"innerText")?t.innerText=e:t.textContent=e}),e.dom.setAttribs(t,s),e.selection.select(t)})(t,e,o.text,a)})})},ie=e=>{const{class:t,href:n,rel:s,target:o,text:i,title:a}=e;return((e)=>{const n={};var s;return((e,t,n,s)=>{((e,t)=>{const n=he(e);for(let s=0,i=n.length;s<i;s++){const o=n[s];t(e[o],o)}})(e,(e,o)=>{(t(e,o)?n:s)(e,o)})})(e,(e)=>!1===ze(e),(s=n,(e,t)=>{s[t]=e}),r),n})({class:t.getOrNull(),href:n,rel:s.getOrNull(),target:o.getOrNull(),text:i.getOrNull(),title:a.getOrNull()})},A=(e,t,n)=>{const s=((e,t)=>{const n=e.options.get,o={allow_html_data_urls:n("allow_html_data_urls"),allow_script_urls:n("allow_script_urls"),allow_svg_data_urls:n("allow_svg_data_urls")},s=t.href;return{...t,href:re.isDomSafe(s,"a",o)?s:""}})(e,n);e.hasPlugin("rtc",!0)?e.execCommand("createlink",!1,ie(s)):ae(e,t,s)},c=e=>{e.hasPlugin("rtc",!0)?e.execCommand("unlink"):(e=>{e.undoManager.transact(()=>{const t=e.selection.getNode();b(t)?ce(e,t):(e=>{const s=e.dom,n=e.selection,a=n.getBookmark(),t=n.getRng().cloneRange(),o=s.getParent(t.startContainer,"a[href]",e.getBody()),i=s.getParent(t.endContainer,"a[href]",e.getBody());o&&t.setStartBefore(o),i&&t.setEndAfter(i),n.setRng(t),e.execCommand("unlink"),n.moveToBookmark(a)})(e),e.focus()})})(e)},ce=(e,t)=>{var n;const s=e.dom.select("img",t)[0];if(s){const o=e.dom.getParents(s,"a[href]",t)[0];o&&(null===(n=o.parentNode)||void 0===n||n.insertBefore(s,o),e.dom.remove(o))}},le=(e,t,n)=>{var o;const s=e.select("img",t)[0];if(s){const t=e.create("a",n);null===(o=s.parentNode)||void 0===o||o.insertBefore(t,s),t.appendChild(s)}},V=(e,t)=>D(t,t=>(e=>{return l(t=e,n="items")&&void 0!==t[n]&&null!==t[n];var t,n})(t)?V(e,t.items):y(t.value===e,t)),ue=(t,n)=>{const s={text:t.text,title:t.title},o=(t,o)=>{const c=(i=n,a=o,"link"===a?i.link:"anchor"===a?i.anchor:e.none()).getOr([]);var i,a;return((t,n,s,o)=>{const i=o[n],a=t.length>0;return void 0!==i?V(i,s).map(e=>({url:{value:e.value,meta:{text:a?t:e.text,attach:r}},text:a?t:e.text})):e.none()})(s.text,o,c,t)};return{onChange:(t,n)=>{const i=n.name;return"url"===i?(t=>{const i=(n=t.url,y(s.text.length<=0,e.from(null===(o=n.meta)||void 0===o?void 0:o.text).getOr(n.value)));var n,o;const a=(t=>{var n;return y(s.title.length<=0,e.from(null===(n=t.meta)||void 0===n?void 0:n.title).getOr(""))})(t.url);return i.isSome()||a.isSome()?e.some({...i.map(e=>({text:e})).getOr({}),...a.map(e=>({title:e})).getOr({})}):e.none()})(t()):((e,t)=>Fe.call(e,t))(["anchor","link"],i)>-1?o(t(),i):"text"===i||"title"===i?(s[i]=t()[i],e.none()):e.none()}}};B=tinymce.util.Tools.resolve("tinymce.util.Delay");const me=t=>{const n=t.href;return n.indexOf("@")>0&&-1===n.indexOf("/")&&-1===n.indexOf("mailto:")?e.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:e=>({...e,href:"mailto:"+n})}):e.none()},fe=(t,n)=>s=>{const o=s.href;return 1===t&&!G(o)||0===t&&/^\s*www(\.|\d\.)/i.test(o)?e.some({message:`The URL you entered seems to be an external link. Do you want to add the required ${n}:// prefix?`,preprocess:e=>({...e,href:n+"://"+o})}):e.none()},pe=t=>{const s=t.dom.select("a:not([href])"),n=R(((e,t)=>{const n=e.length,s=new Array(n);for(let o=0;o<n;o++){const i=e[o];s[o]=t(i,o)}return s})(s,e=>{const t=e.name||e.id;return t?[{text:t,value:"#"+t}]:[]}));return n.length>0?e.some([{text:"None",value:""}].concat(n)):e.none()},ge=t=>{const n=Ce(t);return n.length>0?d(n):e.none()},ve=t=>{try{return e.some(JSON.parse(t))}catch{return e.none()}},be=(t,n)=>{const s=O(t);if(s.length>0){const e=z(n,"_blank"),o=t=>Q(je(t),e);return(!1===F(t)?P(o):d)(s)}return e.none()},x=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],ye=t=>{const n=k(t);return m(n)?d(n).orThunk(()=>e.some(x)):!1===n?e.none():e.some(x)},w=(t,n,s)=>{const o=t.getAttrib(n,s);return null!==o&&o.length>0?e.some(o):e.none()},we=(t,s)=>(t=>{const o=e=>t.convertURL(e.value||e.url||"","href"),s=ke(t);return new Promise(t=>{n(s)?fetch(s).then(e=>e.ok?e.text().then(ve):Promise.reject()).then(t,()=>t(e.none())):U(s)?s(n=>t(e.some(n))):t(e.from(s))}).then(e=>e.bind(P(o)).map(e=>e.length>0?[{text:"None",value:""}].concat(e):e))})(t).then(n=>{const o=((t,n)=>{const s=t.dom,o=ne(t)?e.some(ee(t.selection,n)):e.none(),i=n.bind(t=>e.from(s.getAttrib(t,"href"))),a=n.bind(t=>e.from(s.getAttrib(t,"target"))),r=n.bind(e=>w(s,e,"rel")),c=n.bind(e=>w(s,e,"class"));return{url:i,text:o,title:n.bind(e=>w(s,e,"title")),target:a,rel:r,linkClass:c}})(t,s);return{anchor:o,catalogs:{targets:ye(t),rels:be(t,o.target),classes:ge(t),anchor:pe(t),link:n},optNode:s,flags:{titleEnabled:xe(t)}}}),Oe=t=>{const n=(e=>{const t=s(e);return we(e,t)})(t);n.then(n=>{const s=((t,n)=>s=>{const o=s.getData();if(!o.url.value)return c(t),void s.close();const i=t=>e.from(o[t]).filter(e=>!z(n.anchor[t],e)),a={href:o.url.value,text:i("text"),target:i("target"),rel:i("rel"),class:i("linkClass"),title:i("title")},l={href:o.url.value,attach:void 0!==o.url.meta&&o.url.meta.attach?o.url.meta.attach:r};((e,t)=>D([me,fe(T(e),Ee(e))],e=>e(t)).fold(()=>Promise.resolve(t),n=>new Promise(s=>{((e,t,n)=>{const s=e.selection.getRng();B.setEditorTimeout(e,()=>{e.windowManager.confirm(t,t=>{e.selection.setRng(s),n(t)})})})(e,n.message,e=>{s(e?n.preprocess(t):t)})})))(t,a).then(e=>{A(t,l,e)}),s.close()})(t,n);return((t,n,s)=>{const r=t.anchor.text.map(()=>({name:"text",type:"input",label:"Text to display"})).toArray(),c=t.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],i=((e,t)=>{const n=e.anchor,s=n.url.getOr("");return{url:{value:s,meta:{original:{value:s}}},text:n.text.getOr(""),title:n.title.getOr(""),anchor:s,link:s,rel:n.rel.getOr(""),target:n.target.or(t).getOr(""),linkClass:n.linkClass.getOr("")}})(t,e.from(C(s))),o=t.catalogs,l=ue(i,o);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:R([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],r,c,Se([o.anchor.map(a("anchor","Anchors")),o.rels.map(a("rel","Rel")),o.targets.map(a("target","Open link in...")),o.link.map(a("link","Link list")),o.classes.map(a("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:i,onChange:(e,{name:t})=>{l.onChange(e.getData,{name:t}).each(t=>{e.setData(t)})},onSubmit:n}})(n,s,t)}).then(e=>{t.windowManager.open(e)})};M=tinymce.util.Tools.resolve("tinymce.util.VK");const S=(e,t)=>e.dom.getParent(t,"a[href]"),E=e=>S(e,e.selection.getStart()),g=(e,t)=>{if(t){const n=h(t);if(/^#/.test(n)){const t=e.dom.select(n);t.length&&e.selection.scrollIntoView(t[0],!0)}else(e=>{const t=document.createElement("a");t.target="_blank",t.href=e,t.rel="noreferrer noopener";const n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),((e,t)=>{document.body.appendChild(e),e.dispatchEvent(t),document.body.removeChild(e)})(t,n)})(t.href)}},I=e=>()=>{e.execCommand("mceLink",!1,{dialog:!0})},j=e=>()=>{g(e,E(e))},p=(e,t)=>(e.on("NodeChange",t),()=>e.off("NodeChange",t)),f=e=>t=>{const n=()=>t.setActive(!e.mode.isReadOnly()&&i(e,e.selection.getNode()));return n(),p(e,n)},H=e=>t=>{const n=()=>t.setEnabled(i(e,e.selection.getNode()));return n(),p(e,n)},Z=e=>t=>{const n=t=>{return te(t)||(n=e.selection.getRng(),Y(n,q).length>0);var n},s=e.dom.getParents(e.selection.getStart());return t.setEnabled(n(s)),p(e,e=>t.setEnabled(n(e.parents)))};W.add("link",t=>{(e=>{const t=e.options.register;t("link_assume_external_targets",{processor:e=>{const t=n(e)||X(e);return t?!0===e?{value:1,valid:t}:"http"===e||"https"===e?{value:e,valid:t}:{value:0,valid:t}:{valid:!1,message:"Must be a string or a boolean."}},default:!1}),t("link_context_toolbar",{processor:"boolean",default:!1}),t("link_list",{processor:e=>n(e)||U(e)||$(e,J)}),t("link_default_target",{processor:"string"}),t("link_default_protocol",{processor:"string",default:"https"}),t("link_target_list",{processor:e=>X(e)||$(e,J),default:!0}),t("link_rel_list",{processor:"object[]",default:[]}),t("link_class_list",{processor:"object[]",default:[]}),t("link_title",{processor:"boolean",default:!0}),t("allow_unsafe_link_target",{processor:"boolean",default:!1}),t("link_quicklink",{processor:"boolean",default:!1})})(t),(e=>{e.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:I(e),onSetup:f(e)}),e.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:j(e),onSetup:H(e)}),e.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:()=>c(e),onSetup:Z(e)})})(t),(e=>{e.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:j(e),onSetup:H(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:I(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:()=>c(e),onSetup:Z(e)})})(t),(e=>{e.ui.registry.addContextMenu("link",{update:t=>te(e.dom.getParents(t,"a"))?"link unlink openlink":"link"})})(t),(t=>{const n=e=>{const n=t.selection.getNode();return e.setEnabled(i(t,n)),r};t.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:f(t)},label:"Link",predicate:e=>Ae(t)&&i(t,e),initValue:()=>s(t).fold(()=>"",h),commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:e=>{const n=t.selection.getNode();return e.setActive(i(t,n)),f(t)(e)},onAction:n=>{const o=n.getValue(),i=(n=>{const o=s(t),i=ne(t);if(o.isNone()&&i){const s=ee(t.selection,o);return e.some(s.length>0?s:n)}return e.none()})(o);A(t,{href:o,attach:r},{href:o,text:i,title:e.none(),rel:e.none(),target:e.none(),class:e.none()}),(e=>{e.selection.collapse(!1)})(t),n.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:n,onAction:e=>{c(t),e.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:n,onAction:e=>{j(t)(),e.hide()}}]})})(t),(e=>{e.on("click",t=>{const n=S(e,t.target);n&&M.metaKeyPressed(t)&&(t.preventDefault(),g(e,n))}),e.on("keydown",t=>{if(!t.isDefaultPrevented()&&13===t.keyCode&&(e=>!0===e.altKey&&!1===e.shiftKey&&!1===e.ctrlKey&&!1===e.metaKey)(t)){const n=E(e);n&&(t.preventDefault(),g(e,n))}})})(t),(e=>{e.addCommand("mceLink",(t,n)=>{!0!==n?.dialog&&_e(e)?e.dispatch("contexttoolbar-show",{toolbarKey:"quicklink"}):Oe(e)})})(t),(e=>{e.addShortcut("Meta+K","",()=>{e.execCommand("mceLink")})})(t)})}()