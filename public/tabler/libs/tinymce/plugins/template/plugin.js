(function(){"use strict";var n,r,p,C=tinymce.util.Tools.resolve("tinymce.PluginManager");const ee=(e,t,n)=>{var s;return!!n(e,t.prototype)||((s=e.constructor)===null||s===void 0?void 0:s.name)===t.name},q=e=>{const t=typeof e;return e===null?"null":t==="object"&&Array.isArray(e)?"array":t==="object"&&ee(e,String,(e,t)=>t.isPrototypeOf(e))?"string":t},c=e=>t=>q(t)===e,U=e=>t=>typeof t===e,u=c("string"),W=c("object"),V=c("array"),T=e=>e==null,F=e=>!T(e),o=U("function"),M=(e,t)=>{if(V(e)){for(let n=0,s=e.length;n<s;++n)if(!t(e[n]))return!1;return!0}return!1},E=e=>()=>e;function O(e,...t){return(...n)=>{const s=t.concat(n);return e.apply(null,s)}}const y=E(!1),N=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");n=tinymce.util.Tools.resolve("tinymce.util.Tools");const t=e=>t=>t.options.get(e),b=e=>{const t=e.options.register;t("template_cdate_classes",{processor:"string",default:"cdate"}),t("template_mdate_classes",{processor:"string",default:"mdate"}),t("template_selected_content_classes",{processor:"string",default:"selcontent"}),t("template_preview_replace_values",{processor:"object"}),t("template_replace_values",{processor:"object"}),t("templates",{processor:e=>u(e)||M(e,W)||o(e),default:[]}),t("template_cdate_format",{processor:"string",default:e.translate("%Y-%m-%d")}),t("template_mdate_format",{processor:"string",default:e.translate("%Y-%m-%d")})},j=t("template_cdate_classes"),f=t("template_mdate_classes"),_=t("template_selected_content_classes"),w=t("template_preview_replace_values"),m=t("template_replace_values"),x=t("templates"),g=t("template_cdate_format"),h=t("template_mdate_format"),k=t("content_style"),A=t("content_css_cors"),S=t("body_class"),s=(e,t)=>{if(e=""+e,e.length<t)for(let n=0;n<t-e.length;n++)e="0"+e;return e},a=(e,t,n=new Date)=>{const o="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),i="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),a="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),r="January February March April May June July August September October November December".split(" ");return t=t.replace("%D","%m/%d/%Y"),t=t.replace("%r","%I:%M:%S %p"),t=t.replace("%Y",""+n.getFullYear()),t=t.replace("%y",""+n.getYear()),t=t.replace("%m",s(n.getMonth()+1,2)),t=t.replace("%d",s(n.getDate(),2)),t=t.replace("%H",""+s(n.getHours(),2)),t=t.replace("%M",""+s(n.getMinutes(),2)),t=t.replace("%S",""+s(n.getSeconds(),2)),t=t.replace("%I",""+((n.getHours()+11)%12+1)),t=t.replace("%p",""+(n.getHours()<12?"AM":"PM")),t=t.replace("%B",""+e.translate(r[n.getMonth()])),t=t.replace("%b",""+e.translate(a[n.getMonth()])),t=t.replace("%A",""+e.translate(i[n.getDay()])),t=t.replace("%a",""+e.translate(o[n.getDay()])),t=t.replace("%%","%"),t};class e{constructor(e,t){this.tag=e,this.value=t}static some(t){return new e(!0,t)}static none(){return e.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?e.some(t(this.value)):e.none()}bind(t){return this.tag?t(this.value):e.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(t){return!this.tag||t(this.value)?this:e.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e??"Called getOrDie on None")}static from(t){return F(t)?e.some(t):e.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}e.singletonNone=new e(!1);const z=(e,t)=>{for(let n=0,s=e.length;n<s;n++){const o=e[n];if(t(o,n))return!0}return!1},D=(e,t)=>{const n=e.length,s=new Array(n);for(let o=0;o<n;o++){const i=e[o];s[o]=t(i,o)}return s},v=(t,n,s)=>{for(let o=0,a=t.length;o<a;o++){const i=t[o];if(n(i,o))return e.some(i);if(s(i,o))break}return e.none()},L=(e,t)=>v(e,t,y),R=Object.hasOwnProperty,P=(t,n)=>H(t,n)?e.from(t[n]):e.none(),H=(e,t)=>R.call(e,t),I={'"':"&quot;","<":"&lt;",">":"&gt;","&":"&amp;","'":"&#039;"},B=e=>e.replace(/["'<>&]/g,e=>P(I,e).getOr(e)),i=(e,t,n)=>z(n.split(/\s+/),n=>e.hasClass(t,n)),$=(e,t)=>()=>{const n=x(e);o(n)?n(t):u(n)?fetch(n).then(e=>{e.ok&&e.json().then(t)}):t(n)},d=(e,t)=>(n.each(t,(t,n)=>{o(t)&&(t=t(n)),e=e.replace(new RegExp("\\{\\$"+N(n)+"\\}","g"),t)}),e),l=(e,t)=>{const s=e.dom,i=m(e);n.each(s.select("*",t),e=>{n.each(i,(t,n)=>{s.hasClass(e,n)&&o(t)&&t(e)})})},K=(e,t,s)=>{const o=e.dom,u=e.selection.getContent();s=d(s,m(e));let r=o.create("div",{},s);const c=o.select(".mceTmpl",r);c&&c.length>0&&(r=o.create("div"),r.appendChild(c[0].cloneNode(!0))),n.each(o.select("*",r),t=>{i(o,t,j(e))&&(t.innerHTML=a(e,g(e))),i(o,t,f(e))&&(t.innerHTML=a(e,h(e))),i(o,t,_(e))&&(t.innerHTML=u)}),l(e,r),e.execCommand("mceInsertContent",!1,r.innerHTML),e.addVisual()};r=tinymce.util.Tools.resolve("tinymce.Env");const Y=(e,t)=>{var s;if(t.indexOf("<html>")===-1){let o="";const a=(s=k(e))!==null&&s!==void 0?s:"",l=A(e)?' crossorigin="anonymous"':"";n.each(e.contentCSS,t=>{o+='<link type="text/css" rel="stylesheet" href="'+e.documentBaseURI.toAbsolute(t)+'"'+l+">"}),a&&(o+='<style type="text/css">'+a+"</style>");const d=S(e),i=e.dom.encode,u=r.os.isMacOS()||r.os.isiOS()?"e.metaKey":"e.ctrlKey && !e.altKey",h='<script>document.addEventListener && document.addEventListener("click", function(e) {for (var elm = e.target; elm; elm = elm.parentNode) {if (elm.nodeName === "A" && !('+u+")) {e.preventDefault();}}}, false);<\/script> ",c=e.getBody().dir,m=c?' dir="'+i(c)+'"':"";t='<!DOCTYPE html><html><head><base href="'+i(e.documentBaseURI.getURI())+'">'+o+h+'</head><body class="'+i(d)+'"'+m+">"+t+"</body></html>"}return d(t,w(e))},G=(t,s)=>{const r=()=>{if(!s||s.length===0){const n=t.translate("No templates defined.");return t.notificationManager.open({text:n,type:"info"}),e.none()}return e.from(n.map(s,(t,n)=>{const s=e=>e.url!==void 0;return{selected:n===0,text:t.title,value:{url:s(t)?e.from(t.url):e.none(),content:s(t)?e.none():e.from(t.content),description:t.description}}}))},c=e=>D(e,e=>({text:e.text,value:e.text})),a=(e,t)=>L(e,e=>e.text===t),o=e=>{t.windowManager.alert("Could not load the specified template.",()=>e.focus("template"))},i=e=>e.value.url.fold(()=>Promise.resolve(e.value.content.getOr("")),e=>fetch(e).then(e=>e.ok?e.text():Promise.reject())),l=(e,t)=>(n,s)=>{if(s.name==="template"){const s=n.getData().template;a(e,s).each(e=>{n.block("Loading..."),i(e).then(s=>{t(n,e,s)}).catch(()=>{t(n,e,""),n.setEnabled("save",!1),o(n)})})}},d=e=>n=>{const s=n.getData();a(e,s.template).each(e=>{i(e).then(e=>{t.execCommand("mceInsertTemplate",!1,e),n.close()}).catch(()=>{n.setEnabled("save",!1),o(n)})})},u=e=>{const r=c(e),a=(t,n)=>({title:"Insert Template",size:"large",body:{type:"panel",items:t},initialData:n,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:d(e),onChange:l(e,s)}),s=(e,n,s)=>{const o=Y(t,s),i=[{type:"selectbox",name:"template",label:"Templates",items:r},{type:"htmlpanel",html:`<p aria-live="polite">${B(n.value.description)}</p>`},{label:"Preview",type:"iframe",name:"preview",sandboxed:!1,transparent:!1}],c={template:n.text,preview:o};e.unblock(),e.redial(a(i,c)),e.focus("template")},n=t.windowManager.open(a([],{template:"",preview:""}));n.block("Loading..."),i(e[0]).then(t=>{s(n,e[0],t)}).catch(()=>{s(n,e[0],""),n.setEnabled("save",!1),o(n)})},h=r();h.each(u)},X=e=>t=>{G(e,t)},Q=e=>{e.addCommand("mceInsertTemplate",O(K,e)),e.addCommand("mceTemplate",$(e,X(e)))},Z=e=>{e.on("PreProcess",t=>{const s=e.dom,o=h(e);n.each(s.select("div",t.node),t=>{s.hasClass(t,"mceTmpl")&&(n.each(s.select("*",t),t=>{i(s,t,f(e))&&(t.innerHTML=a(e,o))}),l(e,t))})})},J=e=>{const t=()=>e.execCommand("mceTemplate");e.ui.registry.addButton("template",{icon:"template",tooltip:"Insert template",onAction:t}),e.ui.registry.addMenuItem("template",{icon:"template",text:"Insert template...",onAction:t})};p=()=>{C.add("template",e=>{b(e),J(e),Q(e),Z(e)})},p()})()