(function(){"use strict";var o,y,S,Es=tinymce.util.Tools.resolve("tinymce.PluginManager"),Ie,de,we,Ve,pe;const Ns=(e,t,n)=>{var s;return!!n(e,t.prototype)||((s=e.constructor)===null||s===void 0?void 0:s.name)===t.name},ks=e=>{const t=typeof e;return e===null?"null":t==="object"&&Array.isArray(e)?"array":t==="object"&&Ns(e,String,(e,t)=>t.isPrototypeOf(e))?"string":t},G=e=>t=>ks(t)===e,Y=e=>t=>typeof t===e,Ce=G("string"),L=G("object"),hs=G("array"),ss=Y("boolean"),Zn=e=>e==null,i=e=>!Zn(e),k=Y("function"),qn=Y("number"),Vn=()=>{},Pn=e=>()=>e,Re=(e,t)=>e===t,Pe=e=>t=>!e(t),Be=Pn(!1);class e{constructor(e,t){this.tag=e,this.value=t}static some(t){return new e(!0,t)}static none(){return e.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?e.some(t(this.value)):e.none()}bind(t){return this.tag?t(this.value):e.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(t){return!this.tag||t(this.value)?this:e.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e??"Called getOrDie on None")}static from(t){return i(t)?e.some(t):e.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}e.singletonNone=new e(!1);const zn=Array.prototype.slice,Tn=Array.prototype.indexOf,pt=Array.prototype.push,_n=(e,t)=>Tn.call(e,t),Ye=(e,t)=>_n(e,t)>-1,Qe=(e,t)=>{for(let n=0,s=e.length;n<s;n++){const o=e[n];if(t(o,n))return!0}return!1},a=(e,t)=>{const n=e.length,s=new Array(n);for(let o=0;o<n;o++){const i=e[o];s[o]=t(i,o)}return s},s=(e,t)=>{for(let n=0,s=e.length;n<s;n++){const o=e[n];t(o,n)}},h=(e,t)=>{const n=[];for(let s=0,i=e.length;s<i;s++){const o=e[s];t(o,s)&&n.push(o)}return n},Rt=(e,t)=>{if(e.length===0)return[];let o=t(e[0]);const s=[];let n=[];for(let i=0,c=e.length;i<c;i++){const a=e[i],r=t(a);r!==o&&(s.push(n),n=[]),o=r,n.push(a)}return n.length!==0&&s.push(n),s},ne=(e,t,n)=>(s(e,(e,s)=>{n=t(n,e,s)}),n),M=(t,n,s)=>{for(let o=0,a=t.length;o<a;o++){const i=t[o];if(n(i,o))return e.some(i);if(s(i,o))break}return e.none()},ee=(e,t)=>M(e,t,Be),At=e=>{const t=[];for(let n=0,s=e.length;n<s;++n){if(!hs(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);pt.apply(t,e[n])}return t},at=(e,t)=>At(a(e,t)),Q=e=>{const t=zn.call(e,0);return t.reverse(),t},ct=(t,n)=>n>=0&&n<t.length?e.some(t[n]):e.none(),$=e=>ct(e,0),R=e=>ct(e,e.length-1),lt=(e,t)=>{const n=[],s=k(t)?e=>Qe(n,n=>t(n,e)):e=>Ye(n,e);for(let t=0,i=e.length;t<i;t++){const o=e[t];s(o)||n.push(o)}return n},mt=(e,t,n=Re)=>e.exists(e=>n(e,t)),xt=(e,t,n=Re)=>B(e,t,n).getOr(e.isNone()&&t.isNone()),B=(t,n,s)=>t.isSome()&&n.isSome()?e.some(s(t.getOrDie(),n.getOrDie())):e.none(),nt=1,Nt=(e,t)=>{const s=t||document,n=s.createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||n.childNodes.length>1){const t="HTML does not have a single root node";throw console.error(t,e),new Error(t)}return b(n.childNodes[0])},It=(e,t)=>{const n=t||document,s=n.createElement(e);return b(s)},en=(e,t)=>{const n=t||document,s=n.createTextNode(e);return b(s)},b=e=>{if(e==null)throw new Error("Node cannot be null or undefined");return{dom:e}},dn=(t,n,s)=>e.from(t.dom.elementFromPoint(n,s)).map(b),t={fromHtml:Nt,fromTag:It,fromText:en,fromDom:b,fromPoint:dn},Fn=(e,t)=>{const s=e.dom;if(s.nodeType!==nt)return!1;const n=s;if(n.matches!==void 0)return n.matches(t);if(n.msMatchesSelector!==void 0)return n.msMatchesSelector(t);if(n.webkitMatchesSelector!==void 0)return n.webkitMatchesSelector(t);if(n.mozMatchesSelector!==void 0)return n.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},X=(e,t)=>e.dom===t.dom,Dn=(e,t)=>{const n=e.dom,s=t.dom;return n!==s&&n.contains(s)},Nn=Fn;Ie=(t,n,s,o,i)=>t(s,o)?e.some(s):k(i)&&i(s)?e.none():n(s,o,i),typeof window!="undefined"?window:Function("return this;")();const F=e=>{const t=e.dom.nodeName;return t.toLowerCase()},Ln=e=>e.dom.nodeType,Rn=e=>t=>Ln(t)===e,Le=Rn(nt),Te=e=>t=>Le(t)&&F(t)===e,ie=n=>e.from(n.dom.parentNode).map(t.fromDom),ts=n=>e.from(n.dom.parentElement).map(t.fromDom),ys=n=>e.from(n.dom.nextSibling).map(t.fromDom),C=e=>a(e.dom.childNodes,t.fromDom),Oe=(n,s)=>{const o=n.dom.childNodes;return e.from(o[s]).map(t.fromDom)},me=e=>Oe(e,0),ye=e=>Oe(e,e.dom.childNodes.length-1),Ls=(n,s,o)=>{let i=n.dom;const a=k(o)?o:Be;for(;i.parentNode;){i=i.parentNode;const n=t.fromDom(i);if(s(n))return e.some(n);if(a(n))break}return e.none()},ge=(e,t,n)=>{const s=(e,t)=>t(e);return Ie(s,Ls,e,t,n)},Ge=(e,t)=>{const n=ie(e);n.each(n=>{n.dom.insertBefore(t.dom,e.dom)})},Ws=(e,t)=>{const n=ys(e);n.fold(()=>{const n=ie(e);n.each(e=>{v(e,t)})},e=>{Ge(e,t)})},v=(e,t)=>{e.dom.appendChild(t.dom)},Is=(e,t)=>{s(t,t=>{Ge(e,t)})},he=(e,t)=>{s(t,t=>{v(e,t)})},je=e=>{e.dom.textContent="",s(C(e),e=>{ue(e)})},ue=e=>{const t=e.dom;t.parentNode!==null&&t.parentNode.removeChild(t)};de=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),we=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),y=tinymce.util.Tools.resolve("tinymce.util.VK");const xe=e=>a(e,t.fromDom),ws=Object.keys,re=(e,t)=>{const n=ws(e);for(let s=0,i=n.length;s<i;s++){const o=n[s],a=e[o];t(a,o)}},ls=e=>(t,n)=>{e[n]=t},cs=(e,t,n,s)=>{re(e,(e,o)=>{(t(e,o)?n:s)(e,o)})},rs=(e,t)=>{const n={};return cs(e,t,ls(n),Vn),n},os=(e,t,n)=>{if(Ce(n)||ss(n)||qn(n))e.setAttribute(t,n+"");else throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple")},g=(e,t)=>{const n=e.dom;re(t,(e,t)=>{os(n,t,e)})},oe=e=>ne(e.dom.attributes,(e,t)=>(e[t.name]=t.value,e),{}),Qn=(e,n)=>t.fromDom(e.dom.cloneNode(n)),Wn=e=>Qn(e,!0),In=(e,n)=>{const s=t.fromTag(n),o=oe(e);return g(s,o),s},se=(e,t)=>{const n=In(e,t);Ws(e,n);const s=C(e);return he(n,s),ue(e),n};S=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),o=tinymce.util.Tools.resolve("tinymce.util.Tools");const He=e=>t=>i(t)&&t.nodeName.toLowerCase()===e,_=e=>t=>i(t)&&e.test(t.nodeName),f=e=>i(e)&&e.nodeType===3,j=e=>i(e)&&e.nodeType===1,n=_(/^(OL|UL|DL)$/),bn=_(/^(OL|UL)$/),Ue=He("ol"),q=_(/^(LI|DT|DD)$/),cn=_(/^(DT|DD)$/),rn=_(/^(TH|TD)$/),d=He("br"),Yt=e=>{var t;return((t=e.parentNode)===null||t===void 0?void 0:t.firstChild)===e},W=(e,t)=>i(t)&&t.nodeName in e.schema.getTextBlockElements(),Ze=(e,t)=>i(e)&&e.nodeName in t,Pt=(e,t)=>!!d(t)&&e.isBlock(t.nextSibling)&&!d(t.previousSibling),c=(e,t,n)=>{const s=e.isEmpty(t);return!(n&&e.select("span[data-mce-type=bookmark]",t).length>0)&&s},tt=(e,t)=>e.isChildOf(t,e.getRoot()),V=e=>t=>t.options.get(e),Dt=e=>{const t=e.options.register;t("lists_indent_on_tab",{processor:"boolean",default:!0})},zt=V("lists_indent_on_tab"),St=V("forced_root_block"),Et=V("forced_root_block_attrs"),rt=(e,t)=>{const o=e.dom,r=e.schema.getBlockElements(),i=o.createFragment(),c=St(e),l=Et(e);let s,n,a=!1;for(n=o.create(c,l),Ze(t.firstChild,r)||i.appendChild(n);s=t.firstChild;){const e=s.nodeName;!a&&(e!=="SPAN"||s.getAttribute("data-mce-type")!=="bookmark")&&(a=!0),Ze(s,r)?(i.appendChild(s),n=null):(n||(n=o.create(c,l),i.appendChild(n)),n.appendChild(s))}return!a&&n&&n.appendChild(o.create("br",{"data-mce-bogus":"1"})),i},r=S.DOM,jt=(e,t,n)=>{const l=e=>{const t=e.parentNode;t&&o.each(d,e=>{t.insertBefore(e,n.parentNode)}),r.remove(e)},d=r.select('span[data-mce-type="bookmark"]',t),u=rt(e,n),s=r.createRng();s.setStartAfter(n),s.setEndAfter(t);const i=s.extractContents();for(let t=i.firstChild;t;t=t.firstChild)if(t.nodeName==="LI"&&e.dom.isEmpty(t)){r.remove(t);break}e.dom.isEmpty(i)||r.insertAfter(i,t),r.insertAfter(u,t);const a=n.parentElement;a&&c(e.dom,a)&&l(a),r.remove(n),c(e.dom,t)&&r.remove(t)},bt=Te("dd"),ut=Te("dt"),vt=(e,t)=>{bt(t)?se(t,"dt"):ut(t)&&ts(t).each(n=>jt(e,n.dom,t.dom))},gt=e=>{ut(e)&&se(e,"dd")},Mn=(e,t,n)=>{t==="Indent"?s(n,gt):s(n,t=>vt(e,t))},fe=(e,t)=>{if(f(e))return{container:e,offset:t};const n=de.getNode(e,t);return f(n)?{container:n,offset:t>=e.childNodes.length?n.data.length:0}:n.previousSibling&&f(n.previousSibling)?{container:n.previousSibling,offset:n.previousSibling.data.length}:n.nextSibling&&f(n.nextSibling)?{container:n.nextSibling,offset:0}:{container:e,offset:t}},z=e=>{const t=e.cloneRange(),n=fe(e.startContainer,e.startOffset);t.setStart(n.container,n.offset);const s=fe(e.endContainer,e.endOffset);return t.setEnd(s.container,s.offset),t},ht=["OL","UL","DL"],dt=ht.join(","),l=(e,t)=>{const n=t||e.selection.getStart(!0);return e.dom.getParent(n,dt,T(e,n))},yt=(e,t)=>i(e)&&t.length===1&&t[0]===e,_t=e=>h(e.querySelectorAll(dt),n),wt=e=>{const t=l(e),s=e.selection.getSelectedBlocks();return yt(t,s)?_t(t):h(s,e=>n(e)&&t!==e)},Ot=(e,t)=>{const n=o.map(t,t=>{const n=e.dom.getParent(t,"li,dd,dt",T(e,t));return n||t});return lt(n)},K=e=>{const t=e.selection.getSelectedBlocks();return h(Ot(e,t),q)},Ct=e=>h(K(e),cn),H=(e,t)=>{const n=e.dom.getParents(t,"TD,TH");return n.length>0?n[0]:e.getBody()},kt=(e,t)=>!n(t)&&!q(t)&&Qe(ht,n=>e.isValidChild(t.nodeName,n)),T=(e,t)=>{const n=e.dom.getParents(t,e.dom.isBlock),s=ee(n,t=>kt(e.schema,t));return s.getOr(e.getBody())},it=(e,t)=>{const n=e.dom.getParents(t,"ol,ul",T(e,t));return R(n)},Mt=e=>{const t=it(e,e.selection.getStart()),n=h(e.selection.getSelectedBlocks(),bn);return t.toArray().concat(n)},Ft=e=>{const t=Mt(e);return Tt(e,t)},Tt=(e,t)=>{const n=a(t,t=>it(e,t).getOr(t));return lt(n)},ot=e=>/\btox-/.test(e.className),st=(e,t)=>M(e,n,rn).exists(e=>e.nodeName===t&&!ot(e)),et=(e,t)=>t!==null&&e.dom.getContentEditableParent(t)==="false",Lt=e=>{const t=l(e);return et(e,t)},u=(e,t)=>{const n=e.dom.getParent(t,"ol,ul,dl");return et(e,n)},Je=(e,t)=>{const n=e.selection.getNode();return t({parents:e.dom.getParents(n),element:n}),e.on("NodeChange",t),()=>e.off("NodeChange",t)},Ht=(e,n)=>{const i=n||document,o=i.createDocumentFragment();return s(e,e=>{o.appendChild(e.dom)}),t.fromDom(o)},x=(e,t,n)=>e.dispatch("ListMutation",{action:t,element:n}),Bt=e=>t=>t.replace(e,""),Vt=Bt(/^\s+|\s+$/g),$t=e=>e.length>0,Wt=e=>!$t(e),Ut=e=>e.style!==void 0&&k(e.style.getPropertyValue),Kt=(e,t,n)=>{if(!Ce(n))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",n,":: Element ",e),new Error("CSS value must be a string: "+n);Ut(e)&&e.style.setProperty(t,n)},qt=(e,t,n)=>{const s=e.dom;Kt(s,t,n)},Xe=(e,t)=>{v(e.item,t.list)},Gt=e=>{for(let t=1;t<e.length;t++)Xe(e[t-1],e[t])},Xt=(e,t)=>{B(R(e),$(t),Xe)},Qt=(e,n)=>{const s={list:t.fromTag(n,e),item:t.fromTag("li",e)};return v(s.list,s.item),s},Zt=(e,t,n)=>{const s=[];for(let o=0;o<n;o++)s.push(Qt(e,t.listType));return s},Jt=(e,t)=>{for(let t=0;t<e.length-1;t++)qt(e[t].item,"list-style-type","none");R(e).each(e=>{g(e.list,t.listAttributes),g(e.item,t.itemAttributes),he(e.item,t.content)})},ft=(e,t)=>{F(e.list)!==t.listType&&(e.list=se(e.list,t.listType)),g(e.list,t.listAttributes)},tn=(e,n,s)=>{const o=t.fromTag("li",e);return g(o,n),he(o,s),o},nn=(e,t)=>{v(e.list,t),e.item=t},sn=(e,t,n)=>{const s=t.slice(0,n.depth);return R(s).each(t=>{const s=tn(e,n.itemAttributes,n.content);nn(t,s),ft(t,n)}),s},on=(e,t,n)=>{const s=Zt(e,n,n.depth-t.length);return Gt(s),Jt(s,n),Xt(t,s),t.concat(s)},an=(e,t)=>{const n=ne(t,(t,n)=>n.depth>t.length?on(e,t,n):sn(e,t,n),[]);return $(n).map(e=>e.list)},O=e=>Nn(e,"OL,UL"),qe=e=>me(e).exists(O),ln=e=>ye(e).exists(O),Ke=e=>e.depth>0,un=e=>e.isSelected,hn=e=>{const t=C(e),n=ln(e)?t.slice(0,-1):t;return a(n,Wn)},mn=(e,t,n)=>ie(e).filter(Le).map(s=>({depth:t,dirty:!1,isSelected:n,content:hn(e),itemAttributes:oe(e),listAttributes:oe(s),listType:F(s)})),fn=(e,t)=>{switch(e){case"Indent":t.depth++;break;case"Outdent":t.depth--;break;case"Flatten":t.depth=0}t.dirty=!0},pn=(e,t)=>{e.listType=t.listType,e.listAttributes={...t.listAttributes}},gn=e=>{e.listAttributes=rs(e.listAttributes,(e,t)=>t!=="start")},vn=(e,t)=>{const n=e[t].depth,s=e=>e.depth===n&&!e.dirty,o=e=>e.depth<n;return M(Q(e.slice(0,t)),s,o).orThunk(()=>M(e.slice(t+1),s,o))},We=e=>(s(e,(t,n)=>{vn(e,n).fold(()=>{t.dirty&&gn(t)},e=>pn(t,e))}),e),jn=e=>{let t=e;const n=()=>t,s=e=>{t=e};return{get:n,set:s}},yn=(e,t,n,s)=>me(s).filter(O).fold(()=>{t.each(e=>{X(e.start,s)&&n.set(!0)});const o=mn(s,e,n.get());t.each(e=>{X(e.end,s)&&n.set(!1)});const i=ye(s).filter(O).map(s=>A(e,t,n,s)).getOr([]);return o.toArray().concat(i)},s=>A(e,t,n,s)),A=(e,t,n,s)=>at(C(s),s=>{const o=O(s)?A:yn,i=e+1;return o(i,t,n,s)}),wn=(e,t)=>{const n=jn(!1),s=0;return a(e,e=>({sourceList:e,entries:A(s,t,n,e)}))},On=(e,n)=>{const s=We(n);return a(s,n=>{const s=Ht(n.content);return t.fromDom(rt(e,s.dom))})},xn=(e,t)=>{const n=We(t);return an(e.contentDocument,n).toArray()},Cn=(e,t)=>at(Rt(t,Ke),t=>{const n=$(t).exists(Ke);return n?xn(e,t):On(e,t)}),En=(e,t)=>{s(h(e,un),e=>fn(t,e))},kn=e=>{const n=a(K(e),t.fromDom);return B(ee(n,Pe(qe)),ee(Q(n),Pe(qe)),(e,t)=>({start:e,end:t}))},An=(e,t,n)=>{const o=wn(t,kn(e));s(o,t=>{En(t.entries,n);const o=Cn(e,t.entries);s(o,t=>{x(e,n==="Indent"?"IndentList":"OutdentList",t.dom)}),Is(t.sourceList,o),ue(t.sourceList)})},Sn=(e,t)=>{const n=xe(Ft(e)),s=xe(Ct(e));let o=!1;if(n.length||s.length){const i=e.selection.getBookmark();An(e,n,t),Mn(e,t,s),e.selection.moveToBookmark(i),e.selection.setRng(z(e.selection.getRng())),e.nodeChanged(),o=!0}return o},ce=(e,t)=>!Lt(e)&&Sn(e,t),$e=e=>ce(e,"Indent"),le=e=>ce(e,"Outdent"),D=e=>ce(e,"Flatten");Ve=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager");const m=S.DOM,w=e=>{const t={},n=n=>{let s=e[n?"startContainer":"endContainer"],o=e[n?"startOffset":"endOffset"];if(j(s)){const e=m.create("span",{"data-mce-type":"bookmark"});s.hasChildNodes()?(o=Math.min(o,s.childNodes.length-1),n?s.insertBefore(e,s.childNodes[o]):m.insertAfter(e,s.childNodes[o])):s.appendChild(e),s=e,o=0}t[n?"startContainer":"endContainer"]=s,t[n?"startOffset":"endOffset"]=o};return n(!0),e.collapsed||n(),t},p=e=>{const n=t=>{const o=e=>{let t=(n=e.parentNode)===null||n===void 0?void 0:n.firstChild,s=0;for(var n;t;){if(t===e)return s;(!j(t)||t.getAttribute("data-mce-type")!=="bookmark")&&s++,t=t.nextSibling}return-1};let n=e[t?"startContainer":"endContainer"],s=e[t?"startOffset":"endOffset"];if(!n)return;if(j(n)&&n.parentNode){const e=n;s=o(n),n=n.parentNode,m.remove(e),!n.hasChildNodes()&&m.isBlock(n)&&n.appendChild(m.create("br"))}e[t?"startContainer":"endContainer"]=n,e[t?"startOffset":"endOffset"]=s};n(!0),n();const t=m.createRng();return t.setStart(e.startContainer,e.startOffset),e.endContainer&&t.setEnd(e.endContainer,e.endOffset),z(t)},N=e=>{switch(e){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},Hn=(e,t,n)=>{const s=n["list-style-type"]?n["list-style-type"]:null;e.setStyle(t,"list-style-type",s)},Ne=(e,t)=>{o.each(t,(t,n)=>{e.setAttribute(n,t)})},Bn=(e,t,n)=>{Ne(t,n["list-attributes"]),o.each(e.select("li",t),e=>{Ne(e,n["list-item-attributes"])})},E=(e,t,n)=>{Hn(e,t,n),Bn(e,t,n)},$n=(e,t,n)=>{o.each(n,n=>e.setStyle(t,n,""))},De=(e,t,n,s)=>{let o=t[n?"startContainer":"endContainer"];const i=t[n?"startOffset":"endOffset"];for(j(o)&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!n&&d(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==s;){const t=o.parentNode;if(W(e,o))return o;if(/^(TD|TH)$/.test(t.nodeName))return o;o=t}return o},Un=(e,t,s)=>{const a=[],r=e.dom,l=De(e,t,!0,s),u=De(e,t,!1,s);let i;const c=[];for(let e=l;e;e=e.nextSibling)if(c.push(e),e===u)break;return o.each(c,t=>{var o;if(W(e,t)){a.push(t),i=null;return}if(r.isBlock(t)||d(t)){d(t)&&r.remove(t),i=null;return}const c=t.nextSibling;if(Ve.isBookmarkNode(t)&&(n(c)||W(e,c)||!c&&t.parentNode===s)){i=null;return}i||(i=r.create("p"),(o=t.parentNode)===null||o===void 0?void 0:o.insertBefore(i,t),a.push(i)),i.appendChild(t)}),a},Kn=(e,t,n)=>{const o=e.getStyle(t,"list-style-type");let s=n?n["list-style-type"]:"";return s=s===null?"":s,o===s},ae=(e,t,s)=>{const r=e.selection.getRng();let a="LI";const c=T(e,e.selection.getStart(!0)),i=e.dom;if(i.getContentEditable(e.selection.getNode())==="false")return;t=t.toUpperCase(),t==="DL"&&(a="DT");const l=w(r),d=Un(e,r,c);o.each(d,o=>{let r;const c=o.previousSibling,l=o.parentNode;q(l)||(c&&n(c)&&c.nodeName===t&&Kn(i,c,s)?(r=c,o=i.rename(o,a),c.appendChild(o)):(r=i.create(t),l.insertBefore(r,o),r.appendChild(o),o=i.rename(o,a)),$n(i,o,["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"]),E(i,r,s),P(e.dom,r))}),e.selection.setRng(p(l))},Yn=(e,t)=>n(e)&&e.nodeName===t?.nodeName,Gn=(e,t,n)=>{const s=e.getStyle(t,"list-style-type",!0),o=e.getStyle(n,"list-style-type",!0);return s===o},Xn=(e,t)=>e.className===t.className,ze=(e,t,n)=>Yn(t,n)&&Gn(e,t,n)&&Xn(t,n),P=(e,t)=>{let s,n=t.nextSibling;if(ze(e,t,n)){const o=n;for(;s=o.firstChild;)t.appendChild(s);e.remove(o)}if(n=t.previousSibling,ze(e,t,n)){const o=n;for(;s=o.lastChild;)t.insertBefore(s,t.firstChild);e.remove(o)}},Jn=(e,t,n,s)=>{if(t.nodeName!==n){const o=e.dom.rename(t,n);E(e.dom,o,s),x(e,N(n),o)}else E(e.dom,t,s),x(e,N(n),t)},es=(e,t,s,i,a)=>{const r=n(t);if(r&&t.nodeName===i&&!Fe(a))D(e);else{ae(e,i,a);const n=w(e.selection.getRng()),c=r?[t,...s]:s;o.each(c,t=>{Jn(e,t,i,a)}),e.selection.setRng(p(n))}},Fe=e=>"list-style-type"in e,ns=(e,t,n,s)=>{if(t===e.getBody())return;if(t)if(t.nodeName===n&&!Fe(s)&&!ot(t))D(e);else{const i=w(e.selection.getRng());E(e.dom,t,s);const o=e.dom.rename(t,n);P(e.dom,o),e.selection.setRng(p(i)),ae(e,n,s),x(e,N(n),o)}else ae(e,n,s),x(e,N(n),t)},J=(e,t,n)=>{const s=l(e);if(u(e,s))return;const o=wt(e),i=L(n)?n:{};o.length>0?es(e,s,o,t,i):ns(e,s,t,i)},Me=S.DOM,is=(e,t)=>{const s=t.parentElement;if(s&&s.nodeName==="LI"&&s.firstChild===t){const n=s.previousSibling;n&&n.nodeName==="LI"?(n.appendChild(t),c(e,s)&&Me.remove(s)):Me.setStyle(s,"listStyleType","none")}if(n(s)){const e=s.previousSibling;e&&e.nodeName==="LI"&&e.appendChild(t)}},Se=(e,t)=>{const n=o.grep(e.select("ol,ul",t));o.each(n,t=>{is(e,t)})},Ae=(e,t,n,s)=>{let o=t.startContainer;const a=t.startOffset;if(f(o)&&(n?a<o.data.length:a>0))return o;const r=e.schema.getNonEmptyElements();j(o)&&(o=de.getNode(o,a));const i=new we(o,s);n&&Pt(e.dom,o)&&i.next();const c=n?i.next.bind(i):i.prev2.bind(i);for(;o=c();){if(o.nodeName==="LI"&&!o.hasChildNodes())return o;if(r[o.nodeName])return o;if(f(o)&&o.data.length>0)return o}return null},ke=(e,t)=>{const s=t.childNodes;return s.length===1&&!n(s[0])&&e.isBlock(s[0])},ds=(e,t)=>{ke(e,t)&&e.remove(t.firstChild,!0)},us=(e,t,n)=>{let s;const o=ke(e,n)?n.firstChild:n;if(ds(e,t),!c(e,t,!0))for(;s=t.firstChild;)o.appendChild(s)},I=(e,o,i)=>{let a;const r=o.parentNode;if(!tt(e,o)||!tt(e,i))return;n(i.lastChild)&&(a=i.lastChild),r===i.lastChild&&d(r.previousSibling)&&e.remove(r.previousSibling);const l=i.lastChild;l&&d(l)&&o.hasChildNodes()&&e.remove(l),c(e,i,!0)&&je(t.fromDom(i)),us(e,o,i),a&&i.appendChild(a);const u=Dn(t.fromDom(i),t.fromDom(o)),h=u?e.getParents(o,n,i):[];e.remove(o),s(h,t=>{c(e,t)&&t!==e.getRoot()&&e.remove(t)})},ms=(e,n,s)=>{je(t.fromDom(s)),I(e.dom,n,s),e.selection.setCursorLocation(s,0)},fs=(e,t,n,s)=>{const o=e.dom;if(o.isEmpty(s))ms(e,n,s);else{const i=w(t);I(o,n,s),e.selection.setRng(p(i))}},ps=(e,t,n,s)=>{const o=w(t);I(e.dom,n,s);const i=p(o);e.selection.setRng(i)},gs=(e,t)=>{const s=e.dom,o=e.selection,a=o.getStart(),i=H(e,a),n=s.getParent(o.getStart(),"LI",i);if(n){const l=n.parentElement;if(l===e.getBody()&&c(s,l))return!0;const a=z(o.getRng()),r=s.getParent(Ae(e,a,t,i),"LI",i);if(r&&r!==n)return e.undoManager.transact(()=>{t?fs(e,a,r,n):Yt(n)?le(e):ps(e,a,n,r)}),!0;if(!r&&!t&&a.startOffset===0&&a.endOffset===0)return e.undoManager.transact(()=>{D(e)}),!0}return!1},vs=(e,t,n)=>{const s=e.getParent(t.parentNode,e.isBlock,n);e.remove(t),s&&e.isEmpty(s)&&e.remove(s)},bs=(e,n)=>{const s=e.dom,a=e.selection.getStart(),o=H(e,a),i=s.getParent(a,s.isBlock,o);if(i&&s.isEmpty(i)){const r=z(e.selection.getRng()),a=s.getParent(Ae(e,r,n,o),"LI",o);if(a){const c=e=>Ye(["td","th","caption"],F(e)),l=e=>e.dom===o,d=ge(t.fromDom(a),c,l),u=ge(t.fromDom(r.startContainer),c,l);return!!xt(d,u,X)&&(e.undoManager.transact(()=>{vs(s,i,o),P(s,a.parentNode),e.selection.select(a,!0),e.selection.collapse(n)}),!0)}}return!1},js=(e,t)=>gs(e,t)||bs(e,t),Ee=e=>{const t=e.selection.getStart(),n=H(e,t),s=e.dom.getParent(t,"LI,DT,DD",n);return s||K(e).length>0},_s=e=>!!Ee(e)&&(e.undoManager.transact(()=>{e.execCommand("Delete"),Se(e.dom,e.getBody())}),!0),U=(e,t)=>{const n=e.selection;return!u(e,n.getNode())&&(n.isCollapsed()?js(e,t):_s(e))},Os=e=>{e.on("ExecCommand",t=>{const n=t.command.toLowerCase();(n==="delete"||n==="forwarddelete")&&Ee(e)&&Se(e.dom,e.getBody())}),e.on("keydown",t=>{t.keyCode===y.BACKSPACE?U(e,!1)&&t.preventDefault():t.keyCode===y.DELETE&&U(e,!0)&&t.preventDefault()})},xs=e=>({backspaceDelete:t=>{U(e,t)}}),Cs=(e,t)=>{const n=l(e);if(n===null||u(e,n))return;e.undoManager.transact(()=>{L(t.styles)&&e.dom.setStyles(n,t.styles),L(t.attrs)&&re(t.attrs,(t,s)=>e.dom.setAttrib(n,s,t))})},_e=e=>{const t=Q(Vt(e).split("")),n=a(t,(e,t)=>{const n=e.toUpperCase().charCodeAt(0)-"A".charCodeAt(0)+1;return Math.pow(26,t)*n});return ne(n,(e,t)=>e+t,0)},Z=e=>{if(e--,e<0)return"";const t=e%26,n=Math.floor(e/26),s=Z(n),o=String.fromCharCode("A".charCodeAt(0)+t);return s+o},As=e=>/^[A-Z]+$/.test(e),Ss=e=>/^[a-z]+$/.test(e),Ms=e=>/^[0-9]+$/.test(e),Fs=e=>Ms(e)?2:As(e)?0:Ss(e)?1:Wt(e)?3:4,Ts=t=>{switch(Fs(t)){case 2:return e.some({listStyleType:e.none(),start:t});case 0:return e.some({listStyleType:e.some("upper-alpha"),start:_e(t).toString()});case 1:return e.some({listStyleType:e.some("lower-alpha"),start:_e(t).toString()});case 3:return e.some({listStyleType:e.none(),start:""});case 4:return e.none()}},zs=e=>{const t=parseInt(e.start,10);return mt(e.listStyleType,"upper-alpha")?Z(t):mt(e.listStyleType,"lower-alpha")?Z(t).toLowerCase():e.start},Ds=t=>{const n=l(t);if(!Ue(n)||u(t,n))return;t.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:zs({start:t.dom.getAttrib(n,"start","1"),listStyleType:e.from(t.dom.getStyle(n,"list-style-type"))})},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:e=>{const n=e.getData();Ts(n.start).each(e=>{t.execCommand("mceListUpdate",!1,{attrs:{start:e.start==="1"?"":e.start},styles:{"list-style-type":e.listStyleType.getOr("")}})}),e.close()}})},te=(e,t)=>()=>{const n=l(e);return i(n)&&n.nodeName===t},be=e=>{e.addCommand("mceListProps",()=>{Ds(e)})},Rs=e=>{e.on("BeforeExecCommand",t=>{const n=t.command.toLowerCase();n==="indent"?$e(e):n==="outdent"&&le(e)}),e.addCommand("InsertUnorderedList",(t,n)=>{J(e,"UL",n)}),e.addCommand("InsertOrderedList",(t,n)=>{J(e,"OL",n)}),e.addCommand("InsertDefinitionList",(t,n)=>{J(e,"DL",n)}),e.addCommand("RemoveList",()=>{D(e)}),be(e),e.addCommand("mceListUpdate",(t,n)=>{L(n)&&Cs(e,n)}),e.addQueryStateHandler("InsertUnorderedList",te(e,"UL")),e.addQueryStateHandler("InsertOrderedList",te(e,"OL")),e.addQueryStateHandler("InsertDefinitionList",te(e,"DL"))},Ps=e=>{e.on("keydown",t=>{if(t.keyCode!==y.TAB||y.metaKeyPressed(t))return;e.undoManager.transact(()=>{(t.shiftKey?le(e):$e(e))&&t.preventDefault()})})},Hs=e=>{zt(e)&&Ps(e),Os(e)},ve=(e,t)=>n=>{const s=s=>{n.setActive(st(s.parents,t)),n.setEnabled(!u(e,s.element))};return Je(e,s)},Bs=e=>{const t=t=>()=>e.execCommand(t);e.hasPlugin("advlist")||(e.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:t("InsertOrderedList"),onSetup:ve(e,"OL")}),e.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:t("InsertUnorderedList"),onSetup:ve(e,"UL")}))},Vs=(e,t)=>n=>{const s=s=>n.setEnabled(st(s.parents,t)&&!u(e,s.element));return Je(e,s)},$s=e=>{const t={text:"List properties...",icon:"ordered-list",onAction:()=>e.execCommand("mceListProps"),onSetup:Vs(e,"OL")};e.ui.registry.addMenuItem("listprops",t),e.ui.registry.addContextMenu("lists",{update:t=>{const n=l(e,t);return Ue(n)?["listprops"]:[]}})};pe=()=>{Es.add("lists",e=>(Dt(e),e.hasPlugin("rtc",!0)?be(e):(Hs(e),Rs(e)),Bs(e),$s(e),xs(e)))},pe()})()