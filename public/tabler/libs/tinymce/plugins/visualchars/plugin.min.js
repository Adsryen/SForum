!function(){"use strict";var A=tinymce.util.Tools.resolve("tinymce.PluginManager");const b=e=>t=>typeof t===e,v=e=>"string"===(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&(s=o=e,(i=String).prototype.isPrototypeOf(s)||(null===(n=o.constructor)||void 0===n?void 0:n.name)===i.name)?"string":t;var n,s,o,i})(e),p=(null,e=>null===e),D=b("boolean"),F=b("number");class e{constructor(e,t){this.tag=e,this.value=t}static some(t){return new e(!0,t)}static none(){return e.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?e.some(t(this.value)):e.none()}bind(t){return this.tag?t(this.value):e.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(t){return!this.tag||t(this.value)?this:e.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e??"Called getOrDie on None")}static from(t){return t==null?e.none():e.some(t)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}e.singletonNone=new e(!1);const i=(e,t)=>{for(let n=0,s=e.length;n<s;n++)t(e[n],n)},M=Object.keys,l=(e,t)=>{const n=M(e);for(let s=0,i=n.length;s<i;s++){const o=n[s];t(e[o],o)}};"undefined"!=typeof window?window:Function("return this;")();const d=e=>e.dom.nodeValue,S=e=>3===(e=>e.dom.nodeType)(e),h=(e,t,n)=>{((e,t,n)=>{if(!(v(n)||D(n)||F(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")})(e.dom,t,n)},r=(e,t)=>{e.dom.removeAttribute(t)},o=(e,t)=>{const n=((e,t)=>{const n=e.dom.getAttribute(t);return null===n?void 0:n})(e,t);return void 0===n||""===n?[]:n.split(" ")},s=e=>void 0!==e.dom.classList,w=e=>{if(e==null)throw new Error("Node cannot be null or undefined");return{dom:e}},n=w,t={"\xa0":"nbsp","\xad":"shy"},j=(e,t)=>{let n="";return l(e,(e,t)=>{n+=t}),new RegExp("["+n+"]",t?"g":"")},k=j(t),E=j(t,!0),O=(e=>{let t="";return l(e,e=>{t&&(t+=","),t+="span.mce-"+e}),t})(t),m="mce-nbsp",x=e=>'<span data-mce-bogus="1" class="mce-'+t[e]+'">'+e+"</span>",C=e=>{const t=d(e);return S(e)&&v(t)&&k.test(t)},_=(e,t)=>{let s=[];const o=((e,t)=>{const n=e.length,s=new Array(n);for(let o=0;o<n;o++){const i=e[o];s[o]=t(i,o)}return s})(e.dom.childNodes,n);return i(o,e=>{t(e)&&(s=s.concat([e])),s=s.concat(_(e,t))}),s},y=e=>"span"===e.nodeName.toLowerCase()&&e.classList.contains("mce-nbsp-wrap"),g=(e,t)=>{const a=e.dom,r=_(n(t),C);i(r,t=>{const l=t.dom.parentNode;if(y(l))i=n(l),c=m,s(i)?i.dom.classList.add(c):((e,t)=>{((e,t,n)=>{const s=o(e,t).concat([n]);h(e,t,s.join(" "))})(e,"class",t)})(i,c);else{const s=a.encode(null!==(r=d(t))&&void 0!==r?r:"").replace(E,x),o=a.create("div",{},s);let n;for(var i,r,c;n=o.lastChild;)a.insertAfter(n,t.dom);e.dom.remove(t.dom)}})},u=(e,t)=>{const a=e.dom.select(O,t);i(a,t=>{var i,a;y(t)?(i=n(t),a=m,s(i)?i.dom.classList.remove(a):((e,t)=>{((e,t,n)=>{const s=((e)=>{const s=[];for(let t=0,i=e.length;t<i;t++){const o=e[t];o!==n&&s.push(o)}return s})(o(e,t));s.length>0?h(e,t,s.join(" ")):r(e,t)})(e,"class",t)})(i,a),(e=>{const t=s(e)?e.dom.classList:(e=>o(e,"class"))(e);0===t.length&&r(e,"class")})(i)):e.dom.remove(t,!0)})},c=e=>{const n=e.getBody(),s=e.selection.getBookmark();let t=((e,t)=>{for(;e.parentNode;){if(e.parentNode===t)return t;e=e.parentNode}})(e.selection.getNode(),n);t=void 0!==t?t:n,u(e,t),g(e,t),e.selection.moveToBookmark(s)},a=(e,t)=>{((e,t)=>{e.dispatch("VisualChars",{state:t})})(e,t.get());const n=e.getBody();!0===t.get()?g(e,n):u(e,n)},T=("visualchars_default_state",e=>e.options.get("visualchars_default_state")),z=(e,t)=>{const n=((e)=>{let n=null;return{cancel:()=>{p(n)||(clearTimeout(n),n=null)},throttle:(...t)=>{p(n)&&(n=setTimeout(()=>{n=null,e.apply(null,t)},300))}}})(()=>{c(e)});e.on("keydown",s=>{!0===t.get()&&(13===s.keyCode?c(e):n.throttle())}),e.on("remove",n.cancel)},f=(e,t)=>n=>{n.setActive(t.get());const s=e=>n.setActive(e.state);return e.on("VisualChars",s),()=>e.off("VisualChars",s)};A.add("visualchars",e=>{(e=>{(0,e.options.register)("visualchars_default_state",{processor:"boolean",default:!1})})(e);const t=(e=>{let t=e;return{get:()=>t,set:e=>{t=e}}})(T(e));return((e,t)=>{e.addCommand("mceVisualChars",()=>{((e,t)=>{t.set(!t.get());const n=e.selection.getBookmark();a(e,t),e.selection.moveToBookmark(n)})(e,t)})})(e,t),((e,t)=>{const n=()=>e.execCommand("mceVisualChars");e.ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:n,onSetup:f(e,t)}),e.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:n,onSetup:f(e,t)})})(e,t),z(e,t),((e,t)=>{e.on("init",()=>{a(e,t)})})(e,t),(e=>({isEnabled:()=>e.get()}))(t)})}()