!function(){"use strict";var a=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),c=tinymce.util.Tools.resolve("tinymce.util.Tools");const l=("allow_html_in_named_anchor",e=>e.options.get("allow_html_in_named_anchor")),e="a:not([href])",t=e=>!e,n=e=>e.getAttribute("id")||e.getAttribute("name")||"",s=e=>(e=>"a"===e.nodeName.toLowerCase())(e)&&!e.getAttribute("href")&&""!==n(e),o=t=>t.dom.getParent(t.selection.getStart(),e),d=(e,t)=>{const n=o(e);n?((e,t,n)=>{n.removeAttribute("name"),n.id=t,e.addVisual(),e.undoManager.add()})(e,t,n):((e,t)=>{e.undoManager.transact(()=>{l(e)||e.selection.collapse(!0),e.selection.isCollapsed()?e.insertContent(e.dom.createHTML("a",{id:t})):((e=>{const t=e.dom;r(t).walk(e.selection.getRng(),e=>{c.each(e,e=>{var n;s(n=e)&&!n.firstChild&&t.remove(e,!1)})})})(e),e.formatter.remove("namedAnchor",void 0,void 0,!0),e.formatter.apply("namedAnchor",{value:t}),e.addVisual())})})(e,t),e.focus()},u=e=>(e=>t(e.attr("href"))&&!t(e.attr("id")||e.attr("name")))(e)&&!e.firstChild,i=e=>t=>{for(let n=0;n<t.length;n++){const s=t[n];u(s)&&s.attr("contenteditable",e)}};a.add("anchor",t=>{(e=>{(0,e.options.register)("allow_html_in_named_anchor",{processor:"boolean",default:!1})})(t),(e=>{e.on("PreInit",()=>{e.parser.addNodeFilter("a",i("false")),e.serializer.addNodeFilter("a",i(null))})})(t),(e=>{e.addCommand("mceAnchor",()=>{(e=>{const t=(e=>{const t=o(e);return t?n(t):""})(e);e.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:t},onSubmit:t=>{((e,t)=>/^[A-Za-z][A-Za-z0-9-:._]*$/.test(t)?(d(e,t),!0):(e.windowManager.alert("ID should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),!1))(e,t.getData().id)&&t.close()}})})(e)})})(t),(e=>{const t=()=>e.execCommand("mceAnchor");e.ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:t,onSetup:t=>e.selection.selectorChangedWithUnbind("a:not([href])",t.setActive).unbind}),e.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:t})})(t),t.on("PreInit",()=>{(t=>{t.formatter.register("namedAnchor",{inline:"a",selector:e,remove:"all",split:!0,deep:!0,attributes:{id:"%value"},onmatch:(e)=>s(e)})})(t)})})}()