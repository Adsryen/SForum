(function(){"use strict";var n,A=tinymce.util.Tools.resolve("tinymce.PluginManager"),p=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),f=tinymce.util.Tools.resolve("tinymce.util.Tools");const x=e=>t=>t.options.get(e),r=e=>{const t=e.options.register;t("allow_html_in_named_anchor",{processor:"boolean",default:!1})},b=x("allow_html_in_named_anchor"),a="a:not([href])",t=e=>!e,i=e=>{const t=e.getAttribute("id")||e.getAttribute("name");return t||""},l=e=>e.nodeName.toLowerCase()==="a",o=e=>l(e)&&!e.getAttribute("href")&&i(e)!=="",g=e=>o(e)&&!e.firstChild,h=e=>{const t=e.dom;p(t).walk(e.selection.getRng(),e=>{f.each(e,e=>{g(e)&&t.remove(e,!1)})})},m=e=>/^[A-Za-z][A-Za-z0-9-:._]*$/.test(e),e=e=>e.dom.getParent(e.selection.getStart(),a),d=t=>{const n=e(t);return n?i(n):""},u=(e,t)=>{e.undoManager.transact(()=>{b(e)||e.selection.collapse(!0),e.selection.isCollapsed()?e.insertContent(e.dom.createHTML("a",{id:t})):(h(e),e.formatter.remove("namedAnchor",void 0,void 0,!0),e.formatter.apply("namedAnchor",{value:t}),e.addVisual())})},v=(e,t,n)=>{n.removeAttribute("name"),n.id=t,e.addVisual(),e.undoManager.add()},c=(t,n)=>{const s=e(t);s?v(t,n,s):u(t,n),t.focus()},j=(e,t)=>m(t)?(c(e,t),!0):(e.windowManager.alert("ID should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),!1),y=e=>{const t=d(e);e.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:t},onSubmit:t=>{j(e,t.getData().id)&&t.close()}})},_=e=>{e.addCommand("mceAnchor",()=>{y(e)})},w=e=>t(e.attr("href"))&&!t(e.attr("id")||e.attr("name")),O=e=>w(e)&&!e.firstChild,s=e=>t=>{for(let n=0;n<t.length;n++){const s=t[n];O(s)&&s.attr("contenteditable",e)}},C=e=>{e.on("PreInit",()=>{e.parser.addNodeFilter("a",s("false")),e.serializer.addNodeFilter("a",s(null))})},E=e=>{e.formatter.register("namedAnchor",{inline:"a",selector:a,remove:"all",split:!0,deep:!0,attributes:{id:"%value"},onmatch:(e)=>o(e)})},k=e=>{const t=()=>e.execCommand("mceAnchor");e.ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:t,onSetup:t=>e.selection.selectorChangedWithUnbind("a:not([href])",t.setActive).unbind}),e.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:t})};n=()=>{A.add("anchor",e=>{r(e),C(e),_(e),k(e),e.on("PreInit",()=>{E(e)})})},n()})()