(function(){"use strict";var n,i,p,g,b,M,P,oe=tinymce.util.Tools.resolve("tinymce.PluginManager");const Be=(e,t,n)=>{var s;return!!n(e,t.prototype)||((s=e.constructor)===null||s===void 0?void 0:s.name)===t.name},Ne=e=>{const t=typeof e;return e===null?"null":t==="object"&&Array.isArray(e)?"array":t==="object"&&Be(e,String,(e,t)=>t.isPrototypeOf(e))?"string":t},v=e=>t=>Ne(t)===e,y=v("string"),x=v("object"),ze=v("array"),Se=e=>e==null,r=e=>!Se(e);class e{constructor(e,t){this.tag=e,this.value=t}static some(t){return new e(!0,t)}static none(){return e.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?e.some(t(this.value)):e.none()}bind(t){return this.tag?t(this.value):e.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(t){return!this.tag||t(this.value)?this:e.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e??"Called getOrDie on None")}static from(t){return r(t)?e.some(t):e.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}e.singletonNone=new e(!1);const Ae=Array.prototype.push,o=(e,t)=>{for(let n=0,s=e.length;n<s;n++){const o=e[n];t(o,n)}},Ee=e=>{const t=[];for(let n=0,s=e.length;n<s;++n){if(!ze(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);Ae.apply(t,e[n])}return t},_e=e=>{let t=e;const n=()=>t,s=e=>{t=e};return{get:n,set:s}},je=Object.keys,ve=Object.hasOwnProperty,pe=(e,t)=>{const n=je(e);for(let s=0,i=n.length;s<i;s++){const o=n[s],a=e[o];t(a,o)}},t=(t,n)=>h(t,n)?e.from(t[n]):e.none(),h=(e,t)=>ve.call(e,t),s=e=>t=>t.options.get(e),I=e=>{const t=e.options.register;t("audio_template_callback",{processor:"function"}),t("video_template_callback",{processor:"function"}),t("iframe_template_callback",{processor:"function"}),t("media_live_embeds",{processor:"boolean",default:!0}),t("media_filter_html",{processor:"boolean",default:!0}),t("media_url_resolver",{processor:"function"}),t("media_alt_source",{processor:"boolean",default:!0}),t("media_poster",{processor:"boolean",default:!0}),t("media_dimensions",{processor:"boolean",default:!0})},me=s("audio_template_callback"),ce=s("video_template_callback"),re=s("iframe_template_callback"),H=s("media_live_embeds"),ne=s("media_filter_html"),te=s("media_url_resolver"),U=s("media_alt_source"),W=s("media_poster"),V=s("media_dimensions");i=tinymce.util.Tools.resolve("tinymce.util.Tools"),g=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),p=tinymce.util.Tools.resolve("tinymce.html.DomParser");const B=g.DOM,D=e=>e.replace(/px$/,""),fe=e=>{const n=e.attr("style"),s=n?B.parseStyle(n):{};return{type:"ephox-embed-iri",source:e.attr("data-ephox-embed-iri"),altsource:"",poster:"",width:t(s,"max-width").map(D).getOr(""),height:t(s,"max-height").map(D).getOr("")}},l=(e,t)=>{let n={};const s=p({validate:!1,forced_root_block:!1},t),o=s.parse(e);for(let e=o;e;e=e.walk())if(e.type===1){const t=e.name;if(e.attr("data-ephox-embed-iri")){n=fe(e);break}!n.source&&t==="param"&&(n.source=e.attr("movie")),(t==="iframe"||t==="object"||t==="embed"||t==="video"||t==="audio")&&(n.type||(n.type=t),n=i.extend(e.attributes.map,n)),t==="script"&&(n={type:"script",source:e.attr("src")}),t==="source"&&(n.source?n.altsource||(n.altsource=e.attr("src")):n.source=e.attr("src")),t==="img"&&!n.poster&&(n.poster=e.attr("src"))}return n.source=n.source||n.src||"",n.altsource=n.altsource||"",n.poster=n.poster||"",n},R=e=>{var n;const s={mp3:"audio/mpeg",m4a:"audio/x-m4a",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"},o=(n=e.toLowerCase().split(".").pop())!==null&&n!==void 0?n:"";return t(s,o).getOr("")};n=tinymce.util.Tools.resolve("tinymce.html.Node"),b=tinymce.util.Tools.resolve("tinymce.html.Serializer");const f=(e,t={})=>p({forced_root_block:!1,validate:!1,allow_conditional_comments:!0,...t},e),z=g.DOM,S=e=>/^[0-9.]+$/.test(e)?e+"px":e,$=(e,t)=>{const s=t.attr("style"),n=s?z.parseStyle(s):{};r(e.width)&&(n["max-width"]=S(e.width)),r(e.height)&&(n["max-height"]=S(e.height)),t.attr("style",z.serializeStyle(n))},a=["source","altsource"],m=(e,t,s,o)=>{let r=0,i=0;const c=f(o);c.addNodeFilter("source",e=>r=e.length);const l=c.parse(e);for(let e=l;e;e=e.walk())if(e.type===1){const o=e.name;if(e.attr("data-ephox-embed-iri")){$(t,e);break}switch(o){case"video":case"object":case"embed":case"img":case"iframe":t.height!==void 0&&t.width!==void 0&&(e.attr("width",t.width),e.attr("height",t.height));break}if(s)switch(o){case"video":e.attr("poster",t.poster),e.attr("src",null);for(let s=r;s<2;s++)if(t[a[s]]){const o=new n("source",1);o.attr("src",t[a[s]]),o.attr("type",t[a[s]+"mime"]||null),e.append(o)}break;case"iframe":e.attr("src",t.source);break;case"object":const s=e.getAll("img").length>0;if(t.poster&&!s){e.attr("src",t.poster);const s=new n("img",1);s.attr("src",t.poster),s.attr("width",t.width),s.attr("height",t.height),e.append(s)}break;case"source":if(i<2&&(e.attr("src",t[a[i]]),e.attr("type",t[a[i]+"mime"]||null),!t[a[i]])){e.remove();continue}i++;break;case"img":t.poster||e.remove();break}}return b({},o).serialize(l)},K=[{regex:/youtu\.be\/([\w\-_?&=.]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)(&([a-z0-9&=\-_]+))?/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$2?$4",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9?&=\-_]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?title=0&amp;byline=0",allowFullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0},{regex:/dai\.ly\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0}],q=e=>{const t=e.match(/^(https?:\/\/|www\.)(.+)$/i);return t&&t.length>1?t[1]==="www."?"https://":t[1]:"https://"},Y=(e,t)=>{const o=q(t),n=e.regex.exec(t);let s=o+e.url;if(r(n))for(let e=0;e<n.length;e++)s=s.replace("$"+e,()=>n[e]?n[e]:"");return s.replace(/\?$/,"")},G=e=>{const t=K.filter(t=>t.regex.test(e));return t.length>0?i.extend({},t[0],{url:Y(t[0],e)}):null},X=(e,t)=>{if(t)return t(e);const n=e.allowfullscreen?' allowFullscreen="1"':"";return'<iframe src="'+e.source+'" width="'+e.width+'" height="'+e.height+'"'+n+"></iframe>"},Q=e=>{let t='<object data="'+e.source+'" width="'+e.width+'" height="'+e.height+'" type="application/x-shockwave-flash">';return e.poster&&(t+='<img src="'+e.poster+'" width="'+e.width+'" height="'+e.height+'" />'),t+="</object>",t},Z=(e,t)=>t?t(e):'<audio controls="controls" src="'+e.source+'">'+(e.altsource?`
<source src="`+e.altsource+'"'+(e.altsourcemime?' type="'+e.altsourcemime+'"':"")+` />
`:"")+"</audio>",J=(e,t)=>t?t(e):'<video width="'+e.width+'" height="'+e.height+'"'+(e.poster?' poster="'+e.poster+'"':"")+` controls="controls">
<source src="`+e.source+'"'+(e.sourcemime?' type="'+e.sourcemime+'"':"")+` />
`+(e.altsource?'<source src="'+e.altsource+'"'+(e.altsourcemime?' type="'+e.altsourcemime+'"':"")+` />
`:"")+"</video>",ee=e=>'<script src="'+e.source+'"><\/script>',E=(e,t)=>{var o;const n=i.extend({},t);if(!n.source&&(i.extend(n,l((o=n.embed)!==null&&o!==void 0?o:"",e.schema)),!n.source))return"";n.altsource||(n.altsource=""),n.poster||(n.poster=""),n.source=e.convertURL(n.source,"source"),n.altsource=e.convertURL(n.altsource,"source"),n.sourcemime=R(n.source),n.altsourcemime=R(n.altsource),n.poster=e.convertURL(n.poster,"poster");const s=G(n.source);if(s&&(n.source=s.url,n.type=s.type,n.allowfullscreen=s.allowFullscreen,n.width=n.width||String(s.w),n.height=n.height||String(s.h)),n.embed)return m(n.embed,n,!0,e.schema);const a=me(e),r=ce(e),c=re(e);return n.width=n.width||"300",n.height=n.height||"150",i.each(n,(t,s)=>{n[s]=e.dom.encode(""+t)}),n.type==="iframe"?X(n,c):n.sourcemime==="application/x-shockwave-flash"?Q(n):n.sourcemime.indexOf("audio")!==-1?Z(n,a):n.type==="script"?ee(n):J(n,r)},C=e=>e.hasAttribute("data-mce-object")||e.hasAttribute("data-ephox-embed-iri"),se=e=>{e.on("click keyup touchend",()=>{const t=e.selection.getNode();t&&e.dom.hasClass(t,"mce-preview-object")&&e.dom.getAttrib(t,"data-mce-selected")&&t.setAttribute("data-mce-selected","2")}),e.on("ObjectSelected",e=>{const t=e.target.getAttribute("data-mce-object");t==="script"&&e.preventDefault()}),e.on("ObjectResized",t=>{const n=t.target;if(n.getAttribute("data-mce-object")){let s=n.getAttribute("data-mce-html");s&&(s=unescape(s),n.setAttribute("data-mce-html",escape(m(s,{width:String(t.width),height:String(t.height)},!1,e.schema))))}})},d={},ie=(e,t,n)=>new Promise((s,o)=>{const i=n=>(n.html&&(d[e.source]=n),s({url:e.source,html:n.html?n.html:t(e)}));d[e.source]?i(d[e.source]):n({url:e.source},i,o)}),ae=(e,t)=>Promise.resolve({html:t(e),url:e.source}),O=e=>t=>E(e,t),w=(e,t)=>{const n=te(e);return n?ie(t,O(e),n):ae(t,O(e))},le=e=>h(d,e),de=(e,n)=>t(n,e).bind(e=>t(e,"meta")),ue=(n,s,o)=>i=>{const r=()=>t(n,i),a=()=>t(s,i),c=n=>t(n,"value").bind(t=>t.length>0?e.some(t):e.none()),l=()=>r().bind(t=>x(t)?c(t).orThunk(a):a().orThunk(()=>e.from(t))),d=()=>a().orThunk(()=>r().bind(t=>x(t)?c(t):e.from(t)));return{[i]:(i===o?l():d()).getOr("")}},he=(e,n)=>{const s={};return t(e,"dimensions").each(e=>{o(["width","height"],o=>{t(n,o).orThunk(()=>t(e,o)).each(e=>s[o]=e)})}),s},c=(e,t)=>{const s=t&&t!=="dimensions"?de(t,e).getOr({}):{},n=ue(e,s,t);return{...n("source"),...n("altsource"),...n("poster"),...n("embed"),...he(e,s)}},u=e=>{const n={...e,source:{value:t(e,"source").getOr("")},altsource:{value:t(e,"altsource").getOr("")},poster:{value:t(e,"poster").getOr("")}};return o(["width","height"],s=>{t(e,s).each(e=>{const t=n.dimensions||{};t[s]=e,n.dimensions=t})}),n},F=e=>t=>{const n=t&&t.msg?"Media embed handler error: "+t.msg:"Media embed handler threw unknown error.";e.notificationManager.open({type:"error",text:n})},ge=e=>{const t=e.selection.getNode(),n=C(t)?e.serializer.serialize(t,{selection:!0}):"";return{embed:n,...l(n,e.schema)}},T=(e,t)=>n=>{if(y(n.url)&&n.url.trim().length>0){const s=n.html,o=l(s,t.schema),i={...o,source:n.url,embed:s};e.setData(u(i))}},be=(e,t)=>{const n=e.dom.select("*[data-mce-object]");for(let e=0;e<t.length;e++)for(let s=n.length-1;s>=0;s--)t[e]===n[s]&&n.splice(s,1);e.selection.select(n[0])},N=(e,t)=>{const n=e.dom.select("*[data-mce-object]");e.insertContent(t),be(e,n),e.nodeChanged()},ye=(e,t,n)=>{var s;t.embed=m((s=t.embed)!==null&&s!==void 0?s:"",t,!1,n.schema),t.embed&&(e.source===t.source||le(t.source))?N(n,t.embed):w(n,t).then(e=>{N(n,e.html)}).catch(F(n))},k=e=>{const s=ge(e),n=_e(s),j=u(s),v=(t,n)=>{const s=c(n.getData(),"source");t.source!==s.source&&(T(o,e)({url:s.source,html:""}),w(e,s).then(T(o,e)).catch(F(e)))},p=t=>{var n;const s=c(t.getData()),o=l((n=s.embed)!==null&&n!==void 0?n:"",e.schema);t.setData(u(o))},h=(t,n)=>{const s=c(t.getData(),n),o=E(e,s);t.setData(u({...s,embed:o}))},r=[{name:"source",type:"urlinput",filetype:"media",label:"Source"}],d=V(e)?[{type:"sizeinput",name:"dimensions",label:"Constrain proportions",constrain:!0}]:[],a={title:"General",name:"general",items:Ee([r,d])},m={type:"textarea",name:"embed",label:"Paste your embed code below:"},f={title:"Embed",items:[m]},t=[];U(e)&&t.push({name:"altsource",type:"urlinput",filetype:"media",label:"Alternative source URL"}),W(e)&&t.push({name:"poster",type:"urlinput",filetype:"image",label:"Media poster (Image URL)"});const g={title:"Advanced",name:"advanced",items:t},i=[a,f];t.length>0&&i.push(g);const b={type:"tabpanel",tabs:i},o=e.windowManager.open({title:"Insert/Edit Media",size:"normal",body:b,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:t=>{const s=c(t.getData());ye(n.get(),s,e),t.close()},onChange:(e,t)=>{switch(t.name){case"source":v(n.get(),e);break;case"embed":p(e);break;case"dimensions":case"altsource":case"poster":h(e,t.name);break}n.set(c(e.getData()))},initialData:j})},we=e=>{const t=()=>{k(e)};return{showDialog:t}},Oe=e=>{const t=()=>{k(e)};e.addCommand("mceMedia",t)},xe=(e,t,n)=>t===""||e.length>=t.length&&e.substr(n,n+t.length)===t,Ce=(e,t)=>xe(e,t,0);M=tinymce.util.Tools.resolve("tinymce.Env");const ke=e=>{const t=e.name;return t==="iframe"||t==="video"||t==="audio"},j=(e,t,n,s=null)=>{const o=e.attr(n);return r(o)?o:h(t,n)?null:s},A=(e,t,n)=>{const s=t.name==="img"||e.name==="video",o=s?"300":null,i=e.name==="audio"?"30":"150",a=s?i:null;t.attr({width:j(e,n,"width",o),height:j(e,n,"height",a)})},Me=(e,t,n,s)=>{const o=f(e.schema).parse(s,{context:t});for(;o.firstChild;)n.append(o.firstChild)},Fe=(e,t)=>{const o=t.name,s=new n("img",1);return _(e,t,s),A(t,s,{}),s.attr({style:t.attr("style"),src:M.transparentSrc,"data-mce-object":o,class:"mce-object mce-object-"+o}),s},Te=(e,t)=>{var c;const a=t.name,s=new n("span",1);s.attr({contentEditable:"false",style:t.attr("style"),"data-mce-object":a,class:"mce-preview-object mce-object-"+a}),_(e,t,s);const d=e.dom.parseStyle((c=t.attr("style"))!==null&&c!==void 0?c:""),i=new n(a,1);if(A(t,i,d),i.attr({src:t.attr("src"),style:t.attr("style"),class:t.attr("class")}),a==="iframe")i.attr({allowfullscreen:t.attr("allowfullscreen"),frameborder:"0"});else{const c=["controls","crossorigin","currentTime","loop","muted","poster","preload"];o(c,e=>{i.attr(e,t.attr(e))});const n=s.attr("data-mce-html");r(n)&&Me(e,a,i,unescape(n))}const l=new n("span",1);return l.attr("class","mce-shim"),s.append(i),s.append(l),s},_=(e,t,s)=>{const a=(i=t.attributes)!==null&&i!==void 0?i:[];let r=a.length;for(var i;r--;){const t=a[r].name;let n=a[r].value;t!=="width"&&t!=="height"&&t!=="style"&&!Ce(t,"data-mce-")&&((t==="data"||t==="src")&&(n=e.convertURL(n,t)),s.attr("data-mce-p-"+t,n))}const d=b({inner:!0},e.schema),c=new n("div",1);o(t.children(),e=>c.append(e));const l=d.serialize(c);l&&(s.attr("data-mce-html",escape(l)),s.empty())},De=e=>{const t=e.attr("class");return y(t)&&/\btiny-pageembed\b/.test(t)},L=e=>{let t=e;for(;t=t.parent;)if(t.attr("data-ephox-embed-iri")||De(t))return!0;return!1},Le=e=>t=>{let s=t.length,n;for(;s--;){if(n=t[s],!n.parent)continue;if(n.parent.attr("data-mce-object"))continue;ke(n)&&H(e)?L(n)||n.replace(Te(e,n)):L(n)||n.replace(Fe(e,n))}},Re=(e,t,n)=>{const s=ne(e);return f(e.schema,{validate:s}).parse(n,{context:t})},Pe=e=>{e.on("PreInit",()=>{const{schema:t,serializer:s,parser:i}=e,a=t.getBoolAttrs();o("webkitallowfullscreen mozallowfullscreen".split(" "),e=>{a[e]={}}),pe({embed:["wmode"]},(e,n)=>{const s=t.getElementRule(n);s&&o(e,e=>{s.attributes[e]={},s.attributesOrder.push(e)})}),i.addNodeFilter("iframe,video,audio,object,embed,script",Le(e)),s.addAttributeFilter("data-mce-object",(t,s)=>{let a=t.length;for(;a--;){const r=t[a];if(!r.parent)continue;const l=r.attr(s),c=new n(l,1);if(l!=="audio"&&l!=="script"){const e=r.attr("class");e&&e.indexOf("mce-preview-object")!==-1&&r.firstChild?c.attr({width:r.firstChild.attr("width"),height:r.firstChild.attr("height")}):c.attr({width:r.attr("width"),height:r.attr("height")})}c.attr({style:r.attr("style")});const d=(i=r.attributes)!==null&&i!==void 0?i:[];let u=d.length;for(var i;u--;){const e=d[u].name;e.indexOf("data-mce-p-")===0&&c.attr(e.substr(11),d[u].value)}l==="script"&&c.attr("type","text/javascript");const h=r.attr("data-mce-html");if(h){const t=Re(e,l,unescape(h));o(t.children(),e=>c.append(e))}r.replace(c)}})}),e.on("SetContent",()=>{const t=e.dom;o(t.select("span.mce-preview-object"),e=>{t.select("span.mce-shim",e).length===0&&t.add(e,"span",{class:"mce-shim"})})})},He=e=>{e.on("ResolveName",e=>{let t;e.target.nodeType===1&&(t=e.target.getAttribute("data-mce-object"))&&(e.name=t)})},Ie=e=>{const t=()=>e.execCommand("mceMedia");e.ui.registry.addToggleButton("media",{tooltip:"Insert/edit media",icon:"embed",onAction:t,onSetup:t=>{const n=e.selection;return t.setActive(C(n.getNode())),n.selectorChangedWithUnbind("img[data-mce-object],span[data-mce-object],div[data-ephox-embed-iri]",t.setActive).unbind}}),e.ui.registry.addMenuItem("media",{icon:"embed",text:"Media...",onAction:t})};P=()=>{oe.add("media",e=>(I(e),Oe(e),Ie(e),He(e),Pe(e),se(e),we(e)))},P()})()