!function(){"use strict";z=tinymce.util.Tools.resolve("tinymce.PluginManager");const f=e=>t=>(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&(s=o=e,(i=String).prototype.isPrototypeOf(s)||(null===(n=o.constructor)||void 0===n?void 0:n.name)===i.name)?"string":t;var n,s,o,i})(t)===e,v=f("string"),P=f("object"),B=f("array"),a=e=>!(e=>e==null)(e);class e{constructor(e,t){this.tag=e,this.value=t}static some(t){return new e(!0,t)}static none(){return e.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?e.some(t(this.value)):e.none()}bind(t){return this.tag?t(this.value):e.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(t){return!this.tag||t(this.value)?this:e.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e??"Called getOrDie on None")}static from(t){return a(t)?e.some(t):e.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}e.singletonNone=new e(!1);const U=Array.prototype.push,o=(e,t)=>{for(let n=0,s=e.length;n<s;n++)t(e[n],n)},K=e=>{const t=[];for(let n=0,s=e.length;n<s;++n){if(!B(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);U.apply(t,e[n])}return t},I=Object.keys,G=Object.hasOwnProperty,t=(t,n)=>p(t,n)?e.from(t[n]):e.none(),p=(e,t)=>G.call(e,t),s=e=>t=>t.options.get(e),Y=s("audio_template_callback"),ce=s("video_template_callback"),$=s("iframe_template_callback"),X=s("media_live_embeds"),ae=s("media_filter_html"),se=s("media_url_resolver"),ne=s("media_alt_source"),ee=s("media_poster"),J=s("media_dimensions");var n,h,w,z,c=tinymce.util.Tools.resolve("tinymce.util.Tools"),C=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),E=tinymce.util.Tools.resolve("tinymce.html.DomParser");const Q=C.DOM,A=e=>e.replace(/px$/,""),H=e=>{const n=e.attr("style"),s=n?Q.parseStyle(n):{};return{type:"ephox-embed-iri",source:e.attr("data-ephox-embed-iri"),altsource:"",poster:"",width:t(s,"max-width").map(A).getOr(""),height:t(s,"max-height").map(A).getOr("")}},u=(e,t)=>{let n={};for(let s=E({validate:!1,forced_root_block:!1},t).parse(e);s;s=s.walk())if(1===s.type){const e=s.name;if(s.attr("data-ephox-embed-iri")){n=H(s);break}n.source||"param"!==e||(n.source=s.attr("movie")),"iframe"!==e&&"object"!==e&&"embed"!==e&&"video"!==e&&"audio"!==e||(n.type||(n.type=e),n=c.extend(s.attributes.map,n)),"script"===e&&(n={type:"script",source:s.attr("src")}),"source"===e&&(n.source?n.altsource||(n.altsource=s.attr("src")):n.source=s.attr("src")),"img"!==e||n.poster||(n.poster=s.attr("src"))}return n.source=n.source||n.src||"",n.altsource=n.altsource||"",n.poster=n.poster||"",n},F=e=>{var n;const s=null!==(n=e.toLowerCase().split(".").pop())&&void 0!==n?n:"";return t({mp3:"audio/mpeg",m4a:"audio/x-m4a",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"},s).getOr("")};n=tinymce.util.Tools.resolve("tinymce.html.Node"),h=tinymce.util.Tools.resolve("tinymce.html.Serializer");const m=(e,t={})=>E({forced_root_block:!1,validate:!1,allow_conditional_comments:!0,...t},e),N=C.DOM,L=e=>/^[0-9.]+$/.test(e)?e+"px":e,V=(e,t)=>{const s=t.attr("style"),n=s?N.parseStyle(s):{};a(e.width)&&(n["max-width"]=L(e.width)),a(e.height)&&(n["max-height"]=L(e.height)),t.attr("style",N.serializeStyle(n))},i=["source","altsource"],g=(e,t,s,o)=>{let r=0,a=0;const c=m(o);c.addNodeFilter("source",e=>r=e.length);const l=c.parse(e);for(let e=l;e;e=e.walk())if(1===e.type){const o=e.name;if(e.attr("data-ephox-embed-iri")){V(t,e);break}switch(o){case"video":case"object":case"embed":case"img":case"iframe":void 0!==t.height&&void 0!==t.width&&(e.attr("width",t.width),e.attr("height",t.height))}if(s)switch(o){case"video":e.attr("poster",t.poster),e.attr("src",null);for(let s=r;s<2;s++)if(t[i[s]]){const o=new n("source",1);o.attr("src",t[i[s]]),o.attr("type",t[i[s]+"mime"]||null),e.append(o)}break;case"iframe":e.attr("src",t.source);break;case"object":const s=e.getAll("img").length>0;if(t.poster&&!s){e.attr("src",t.poster);const s=new n("img",1);s.attr("src",t.poster),s.attr("width",t.width),s.attr("height",t.height),e.append(s)}break;case"source":if(a<2&&(e.attr("src",t[i[a]]),e.attr("type",t[i[a]+"mime"]||null),!t[i[a]])){e.remove();continue}a++;break;case"img":t.poster||e.remove()}}return h({},o).serialize(l)},oe=[{regex:/youtu\.be\/([\w\-_?&=.]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)(&([a-z0-9&=\-_]+))?/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$2?$4",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9?&=\-_]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?title=0&amp;byline=0",allowFullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0},{regex:/dai\.ly\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0}],W=(e,t)=>{const o=(e=>{const t=e.match(/^(https?:\/\/|www\.)(.+)$/i);return t&&t.length>1?"www."===t[1]?"https://":t[1]:"https://"})(t),n=e.regex.exec(t);let s=o+e.url;if(a(n))for(let e=0;e<n.length;e++)s=s.replace("$"+e,()=>n[e]?n[e]:"");return s.replace(/\?$/,"")},R=(e,t)=>{var o;const n=c.extend({},t);if(!n.source&&(c.extend(n,u(null!==(o=n.embed)&&void 0!==o?o:"",e.schema)),!n.source))return"";n.altsource||(n.altsource=""),n.poster||(n.poster=""),n.source=e.convertURL(n.source,"source"),n.altsource=e.convertURL(n.altsource,"source"),n.sourcemime=F(n.source),n.altsourcemime=F(n.altsource),n.poster=e.convertURL(n.poster,"poster");const s=(e=>{const t=oe.filter(t=>t.regex.test(e));return t.length>0?c.extend({},t[0],{url:W(t[0],e)}):null})(n.source);if(s&&(n.source=s.url,n.type=s.type,n.allowfullscreen=s.allowFullscreen,n.width=n.width||String(s.w),n.height=n.height||String(s.h)),n.embed)return g(n.embed,n,!0,e.schema);{const t=Y(e),s=ce(e),o=$(e);return n.width=n.width||"300",n.height=n.height||"150",c.each(n,(t,s)=>{n[s]=e.dom.encode(""+t)}),"iframe"===n.type?((e,t)=>{if(t)return t(e);{const t=e.allowfullscreen?' allowFullscreen="1"':"";return'<iframe src="'+e.source+'" width="'+e.width+'" height="'+e.height+'"'+t+"></iframe>"}})(n,o):"application/x-shockwave-flash"===n.sourcemime?(e=>{let t='<object data="'+e.source+'" width="'+e.width+'" height="'+e.height+'" type="application/x-shockwave-flash">';return e.poster&&(t+='<img src="'+e.poster+'" width="'+e.width+'" height="'+e.height+'" />'),t+="</object>",t})(n):-1!==n.sourcemime.indexOf("audio")?((e,t)=>t?t(e):'<audio controls="controls" src="'+e.source+'">'+(e.altsource?`
<source src="`+e.altsource+'"'+(e.altsourcemime?' type="'+e.altsourcemime+'"':"")+` />
`:"")+"</audio>")(n,t):"script"===n.type?(e=>'<script src="'+e.source+'"><\/script>')(n):((e,t)=>t?t(e):'<video width="'+e.width+'" height="'+e.height+'"'+(e.poster?' poster="'+e.poster+'"':"")+` controls="controls">
<source src="`+e.source+'"'+(e.sourcemime?' type="'+e.sourcemime+'"':"")+` />
`+(e.altsource?'<source src="'+e.altsource+'"'+(e.altsourcemime?' type="'+e.altsourcemime+'"':"")+` />
`:"")+"</video>")(n,s)}},D=e=>e.hasAttribute("data-mce-object")||e.hasAttribute("data-ephox-embed-iri"),d={},T=e=>t=>R(e,t),M=(e,t)=>{const n=se(e);return n?((e,t,n)=>new Promise((s,o)=>{const i=n=>(n.html&&(d[e.source]=n),s({url:e.source,html:n.html?n.html:t(e)}));d[e.source]?i(d[e.source]):n({url:e.source},i,o)}))(t,T(e),n):((e,t)=>Promise.resolve({html:t(e),url:e.source}))(t,T(e))},q=(e,n)=>{const s={};return t(e,"dimensions").each(e=>{o(["width","height"],o=>{t(n,o).orThunk(()=>t(e,o)).each(e=>s[o]=e)})}),s},r=(n,s)=>{const i=s&&"dimensions"!==s?((e,n)=>t(n,e).bind(e=>t(e,"meta")))(s,n).getOr({}):{},o=((n,s,o)=>i=>{const r=()=>t(n,i),a=()=>t(s,i),c=n=>t(n,"value").bind(t=>t.length>0?e.some(t):e.none());return{[i]:(i===o?r().bind(t=>P(t)?c(t).orThunk(a):a().orThunk(()=>e.from(t))):a().orThunk(()=>r().bind(t=>P(t)?c(t):e.from(t)))).getOr("")}})(n,i,s);return{...o("source"),...o("altsource"),...o("poster"),...o("embed"),...q(n,i)}},l=e=>{const n={...e,source:{value:t(e,"source").getOr("")},altsource:{value:t(e,"altsource").getOr("")},poster:{value:t(e,"poster").getOr("")}};return o(["width","height"],s=>{t(e,s).each(e=>{const t=n.dimensions||{};t[s]=e,n.dimensions=t})}),n},S=e=>t=>{const n=t&&t.msg?"Media embed handler error: "+t.msg:"Media embed handler threw unknown error.";e.notificationManager.open({type:"error",text:n})},k=(e,t)=>n=>{if(v(n.url)&&n.url.trim().length>0){const s=n.html,o={...u(s,t.schema),source:n.url,embed:s};e.setData(l(o))}},x=(e,t)=>{const n=e.dom.select("*[data-mce-object]");e.insertContent(t),((e,t)=>{const n=e.dom.select("*[data-mce-object]");for(let e=0;e<t.length;e++)for(let s=n.length-1;s>=0;s--)t[e]===n[s]&&n.splice(s,1);e.selection.select(n[0])})(e,n),e.nodeChanged()},O=e=>{const s=(e=>{const t=e.selection.getNode(),n=D(t)?e.serializer.serialize(t,{selection:!0}):"";return{embed:n,...u(n,e.schema)}})(e),n=(e=>{let t=e;return{get:()=>t,set:e=>{t=e}}})(s),a=l(s),c=J(e)?[{type:"sizeinput",name:"dimensions",label:"Constrain proportions",constrain:!0}]:[],h={title:"General",name:"general",items:K([[{name:"source",type:"urlinput",filetype:"media",label:"Source"}],c])},t=[];ne(e)&&t.push({name:"altsource",type:"urlinput",filetype:"media",label:"Alternative source URL"}),ee(e)&&t.push({name:"poster",type:"urlinput",filetype:"image",label:"Media poster (Image URL)"});const m={title:"Advanced",name:"advanced",items:t},o=[h,{title:"Embed",items:[{type:"textarea",name:"embed",label:"Paste your embed code below:"}]}];t.length>0&&o.push(m);const f={type:"tabpanel",tabs:o},i=e.windowManager.open({title:"Insert/Edit Media",size:"normal",body:f,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:t=>{const s=r(t.getData());((e,t,n)=>{var s,o;t.embed=g(null!==(s=t.embed)&&void 0!==s?s:"",t,!1,n.schema),t.embed&&(e.source===t.source||(o=t.source,p(d,o)))?x(n,t.embed):M(n,t).then(e=>{x(n,e.html)}).catch(S(n))})(n.get(),s,e),t.close()},onChange:(t,s)=>{switch(s.name){case"source":((t,n)=>{const s=r(n.getData(),"source");t.source!==s.source&&(k(i,e)({url:s.source,html:""}),M(e,s).then(k(i,e)).catch(S(e)))})(n.get(),t);break;case"embed":(t=>{var n;const s=r(t.getData()),o=u(null!==(n=s.embed)&&void 0!==n?n:"",e.schema);t.setData(l(o))})(t);break;case"dimensions":case"altsource":case"poster":((t,n)=>{const s=r(t.getData(),n),o=R(e,s);t.setData(l({...s,embed:o}))})(t,s.name)}n.set(r(t.getData()))},initialData:a})};w=tinymce.util.Tools.resolve("tinymce.Env");const te=e=>{const t=e.name;return"iframe"===t||"video"===t||"audio"===t},_=(e,t,n,s=null)=>{const o=e.attr(n);return a(o)?o:p(t,n)?null:s},y=(e,t,n)=>{const s="img"===t.name||"video"===e.name,o=s?"300":null,i="audio"===e.name?"30":"150",a=s?i:null;t.attr({width:_(e,n,"width",o),height:_(e,n,"height",a)})},Z=(e,t)=>{const o=t.name,s=new n("img",1);return j(e,t,s),y(t,s,{}),s.attr({style:t.attr("style"),src:w.transparentSrc,"data-mce-object":o,class:"mce-object mce-object-"+o}),s},ie=(e,t)=>{var c;const r=t.name,s=new n("span",1);s.attr({contentEditable:"false",style:t.attr("style"),"data-mce-object":r,class:"mce-preview-object mce-object-"+r}),j(e,t,s);const d=e.dom.parseStyle(null!==(c=t.attr("style"))&&void 0!==c?c:""),i=new n(r,1);if(y(t,i,d),i.attr({src:t.attr("src"),style:t.attr("style"),class:t.attr("class")}),"iframe"===r)i.attr({allowfullscreen:t.attr("allowfullscreen"),frameborder:"0"});else{o(["controls","crossorigin","currentTime","loop","muted","poster","preload"],e=>{i.attr(e,t.attr(e))});const n=s.attr("data-mce-html");a(n)&&((e,t,n,s)=>{const o=m(e.schema).parse(s,{context:t});for(;o.firstChild;)n.append(o.firstChild)})(e,r,i,unescape(n))}const l=new n("span",1);return l.attr("class","mce-shim"),s.append(i),s.append(l),s},j=(e,t,s)=>{const r=null!==(a=t.attributes)&&void 0!==a?a:[];let c=r.length;for(var i,a,l;c--;){const t=r[c].name;let n=r[c].value;"width"===t||"height"===t||"style"===t||(i="data-mce-",(l=t).length>=i.length&&l.substr(0,0+i.length)===i)||("data"!==t&&"src"!==t||(n=e.convertURL(n,t)),s.attr("data-mce-p-"+t,n))}const m=h({inner:!0},e.schema),d=new n("div",1);o(t.children(),e=>d.append(e));const u=m.serialize(d);u&&(s.attr("data-mce-html",escape(u)),s.empty())},re=e=>{const t=e.attr("class");return v(t)&&/\btiny-pageembed\b/.test(t)},b=e=>{let t=e;for(;t=t.parent;)if(t.attr("data-ephox-embed-iri")||re(t))return!0;return!1},le=(e,t,n)=>{const s=ae(e);return m(e.schema,{validate:s}).parse(n,{context:t})};z.add("media",e=>((e=>{const t=e.options.register;t("audio_template_callback",{processor:"function"}),t("video_template_callback",{processor:"function"}),t("iframe_template_callback",{processor:"function"}),t("media_live_embeds",{processor:"boolean",default:!0}),t("media_filter_html",{processor:"boolean",default:!0}),t("media_url_resolver",{processor:"function"}),t("media_alt_source",{processor:"boolean",default:!0}),t("media_poster",{processor:"boolean",default:!0}),t("media_dimensions",{processor:"boolean",default:!0})})(e),(e=>{e.addCommand("mceMedia",()=>{O(e)})})(e),(e=>{const t=()=>e.execCommand("mceMedia");e.ui.registry.addToggleButton("media",{tooltip:"Insert/edit media",icon:"embed",onAction:t,onSetup:t=>{const n=e.selection;return t.setActive(D(n.getNode())),n.selectorChangedWithUnbind("img[data-mce-object],span[data-mce-object],div[data-ephox-embed-iri]",t.setActive).unbind}}),e.ui.registry.addMenuItem("media",{icon:"embed",text:"Media...",onAction:t})})(e),(e=>{e.on("ResolveName",e=>{let t;1===e.target.nodeType&&(t=e.target.getAttribute("data-mce-object"))&&(e.name=t)})})(e),(e=>{e.on("PreInit",()=>{const{schema:t,serializer:s,parser:i}=e,a=t.getBoolAttrs();o("webkitallowfullscreen mozallowfullscreen".split(" "),e=>{a[e]={}}),((e,t)=>{const n=I(e);for(let s=0,i=n.length;s<i;s++){const o=n[s];t(e[o],o)}})({embed:["wmode"]},(e,n)=>{const s=t.getElementRule(n);s&&o(e,e=>{s.attributes[e]={},s.attributesOrder.push(e)})}),i.addNodeFilter("iframe,video,audio,object,embed,script",(e=>t=>{let n,s=t.length;for(;s--;)n=t[s],n.parent&&(n.parent.attr("data-mce-object")||(te(n)&&X(e)?b(n)||n.replace(ie(e,n)):b(n)||n.replace(Z(e,n))))})(e)),s.addAttributeFilter("data-mce-object",(t,s)=>{let a=t.length;for(;a--;){const r=t[a];if(!r.parent)continue;const l=r.attr(s),c=new n(l,1);if("audio"!==l&&"script"!==l){const e=r.attr("class");e&&-1!==e.indexOf("mce-preview-object")&&r.firstChild?c.attr({width:r.firstChild.attr("width"),height:r.firstChild.attr("height")}):c.attr({width:r.attr("width"),height:r.attr("height")})}c.attr({style:r.attr("style")});const d=null!==(i=r.attributes)&&void 0!==i?i:[];let u=d.length;for(var i;u--;){const e=d[u].name;0===e.indexOf("data-mce-p-")&&c.attr(e.substr(11),d[u].value)}"script"===l&&c.attr("type","text/javascript");const h=r.attr("data-mce-html");if(h){const t=le(e,l,unescape(h));o(t.children(),e=>c.append(e))}r.replace(c)}})}),e.on("SetContent",()=>{const t=e.dom;o(t.select("span.mce-preview-object"),e=>{0===t.select("span.mce-shim",e).length&&t.add(e,"span",{class:"mce-shim"})})})})(e),(e=>{e.on("click keyup touchend",()=>{const t=e.selection.getNode();t&&e.dom.hasClass(t,"mce-preview-object")&&e.dom.getAttrib(t,"data-mce-selected")&&t.setAttribute("data-mce-selected","2")}),e.on("ObjectSelected",e=>{"script"===e.target.getAttribute("data-mce-object")&&e.preventDefault()}),e.on("ObjectResized",t=>{const n=t.target;if(n.getAttribute("data-mce-object")){let s=n.getAttribute("data-mce-html");s&&(s=unescape(s),n.setAttribute("data-mce-html",escape(g(s,{width:String(t.width),height:String(t.height)},!1,e.schema))))}})})(e),(e=>({showDialog:()=>{O(e)}}))(e)))}()