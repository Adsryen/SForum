(function(e,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(t):e.Viz=t()})(this,function(){"use strict";var a,r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),t=Object.assign||function(e){for(var t,s,n=1;n<arguments.length;n++){t=arguments[n];for(s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},s=function(){function t(n){var s=this;e(this,t),this.worker=n,this.listeners=[],this.nextId=0,this.worker.addEventListener("message",function(e){var t=e.data.id,n=e.data.error,o=e.data.result;s.listeners[t](n,o),delete s.listeners[t]})}return n(t,[{key:"render",value:function(t,n){var s=this;return new Promise(function(e,o){var i=s.nextId++;s.listeners[i]=function(t,n){if(t){o(new Error(t.message,t.fileName,t.lineNumber));return}e(n)},s.worker.postMessage({id:i,src:t,options:n})})}}]),t}(),o=function t(n,s){e(this,t);var o=n();this.render=function(e,t){return new Promise(function(n,i){try{n(s(o,e,t))}catch(e){i(e)}})}};function c(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))}function i(){return"devicePixelRatio"in window&&window.devicePixelRatio>1?window.devicePixelRatio:1}function l(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.scale,s=n===void 0?i():n,o=t.mimeType,r=o===void 0?"image/png":o,a=t.quality,l=a===void 0?1:a;return new Promise(function(t,n){var o=new Image;o.onload=function(){var n,e=document.createElement("canvas");e.width=o.width*s,e.height=o.height*s,n=e.getContext("2d"),n.drawImage(o,0,0,e.width,e.height),e.toBlob(function(e){var n=new Image;n.src=URL.createObjectURL(e),n.width=o.width,n.height=o.height,t(n)},r,l)},o.onerror=function(e){var t;"error"in e?t=e.error:t=new Error("Error loading SVG"),n(t)},o.src="data:image/svg+xml;base64,"+c(e)})}function d(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=t.scale,c=s===void 0?i():s,o=t.mimeType,a=o===void 0?"image/png":o,r=t.quality,l=r===void 0?1:r,d=c,n=void 0;return a=="image/jpeg"?n="jpeg":a=="image/png"&&(n="png"),new Promise(function(t,s){fabric.loadSVGFromString(e,function(e,o){e.length==0&&s(new Error("Error loading SVG with Fabric"));var i,r,c,a=document.createElement("canvas");a.width=o.width,a.height=o.height,r=new fabric.Canvas(a,{enableRetinaScaling:!1}),c=fabric.util.groupSVGElements(e,o),r.add(c).renderAll(),i=new Image,i.src=r.toDataURL({format:n,multiplier:d,quality:l}),i.width=o.width,i.height=o.height,t(i)})})}return a=function(){function i(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=t.workerURL,a=t.worker,r=t.Module,c=t.render;if(e(this,i),typeof n!="undefined")this.wrapper=new s(new Worker(n));else if(typeof a!="undefined")this.wrapper=new s(a);else if(typeof r!="undefined"&&typeof c!="undefined")this.wrapper=new o(r,c);else if(typeof i.Module!="undefined"&&typeof i.render!="undefined")this.wrapper=new o(i.Module,i.render);else throw new Error("Must specify workerURL or worker option, Module and render options, or include one of full.render.js or lite.render.js after viz.js.")}return n(i,[{key:"renderString",value:function(t){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=n.format,m=u===void 0?"svg":u,r=n.engine,h=r===void 0?"dot":r,a=n.files,i=a===void 0?[]:a,c=n.images,o=c===void 0?[]:c,l=n.yInvert,f=l!==void 0&&l,d=n.nop,p=d===void 0?0:d,s=0;s<o.length;s++)i.push({path:o[s].path,data:`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="`+o[s].width+'" height="'+o[s].height+'"></svg>'});return this.wrapper.render(t,{format:m,engine:h,files:i,images:o,yInvert:f,nop:p})}},{key:"renderSVGElement",value:function(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.renderString(n,t({},s,{format:"svg"})).then(function(e){var t=new DOMParser;return t.parseFromString(e,"image/svg+xml").documentElement})}},{key:"renderImageElement",value:function(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=s.scale,i=s.mimeType,a=s.quality;return this.renderString(n,t({},s,{format:"svg"})).then(function(e){return(typeof fabric=="undefined"?"undefined":r(fabric))==="object"&&fabric.loadSVGFromString?d(e,{scale:o,mimeType:i,quality:a}):l(e,{scale:o,mimeType:i,quality:a})})}},{key:"renderJSONObject",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.format;return(s!=="json"||s!=="json0")&&(s="json"),this.renderString(n,t({},o,{format:s})).then(function(e){return JSON.parse(e)})}}]),i}(),a})