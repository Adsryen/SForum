(function(e,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(t):e.Viz=t()})(this,function(){"use strict";var n,r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var n,s=0;s<t.length;s++)n=t[s],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),t=Object.assign||function(e){for(var t,n,s=1;s<arguments.length;s++){t=arguments[s];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},o=function(){function t(n){var s=this;e(this,t),this.worker=n,this.listeners=[],this.nextId=0,this.worker.addEventListener("message",function(e){var t=e.data.id,n=e.data.error,o=e.data.result;s.listeners[t](n,o),delete s.listeners[t]})}return s(t,[{key:"render",value:function(e,t){var n=this;return new Promise(function(s,o){var i=n.nextId++;n.listeners[i]=function(e,t){if(e){o(new Error(e.message,e.fileName,e.lineNumber));return}s(t)},n.worker.postMessage({id:i,src:e,options:t})})}}]),t}(),i=function t(n,s){e(this,t);var o=n();this.render=function(e,t){return new Promise(function(n,i){try{n(s(o,e,t))}catch(e){i(e)}})}};function c(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))}function a(){return"devicePixelRatio"in window&&window.devicePixelRatio>1?window.devicePixelRatio:1}function l(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.scale,s=n===void 0?a():n,o=t.mimeType,r=o===void 0?"image/png":o,i=t.quality,l=i===void 0?1:i;return new Promise(function(t,n){var o=new Image;o.onload=function(){var n,e=document.createElement("canvas");e.width=o.width*s,e.height=o.height*s,n=e.getContext("2d"),n.drawImage(o,0,0,e.width,e.height),e.toBlob(function(e){var n=new Image;n.src=URL.createObjectURL(e),n.width=o.width,n.height=o.height,t(n)},r,l)},o.onerror=function(e){var t;"error"in e?t=e.error:t=new Error("Error loading SVG"),n(t)},o.src="data:image/svg+xml;base64,"+c(e)})}function d(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=t.scale,c=s===void 0?a():s,o=t.mimeType,i=o===void 0?"image/png":o,r=t.quality,l=r===void 0?1:r,d=c,n=void 0;return i=="image/jpeg"?n="jpeg":i=="image/png"&&(n="png"),new Promise(function(t,s){fabric.loadSVGFromString(e,function(e,o){e.length==0&&s(new Error("Error loading SVG with Fabric"));var i,a,c,r=document.createElement("canvas");r.width=o.width,r.height=o.height,a=new fabric.Canvas(r,{enableRetinaScaling:!1}),c=fabric.util.groupSVGElements(e,o),a.add(c).renderAll(),i=new Image,i.src=a.toDataURL({format:n,multiplier:d,quality:l}),i.width=o.width,i.height=o.height,t(i)})})}return n=function(){function n(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=t.workerURL,a=t.worker,r=t.Module,c=t.render;if(e(this,n),typeof s!="undefined")this.wrapper=new o(new Worker(s));else if(typeof a!="undefined")this.wrapper=new o(a);else if(typeof r!="undefined"&&typeof c!="undefined")this.wrapper=new i(r,c);else if(typeof n.Module!="undefined"&&typeof n.render!="undefined")this.wrapper=new i(n.Module,n.render);else throw new Error("Must specify workerURL or worker option, Module and render options, or include one of full.render.js or lite.render.js after viz.js.")}return s(n,[{key:"renderString",value:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=t.format,h=d===void 0?"svg":d,a=t.engine,u=a===void 0?"dot":a,i=t.files,o=i===void 0?[]:i,r=t.images,s=r===void 0?[]:r,c=t.yInvert,m=c!==void 0&&c,l=t.nop,f=l===void 0?0:l,n=0;n<s.length;n++)o.push({path:s[n].path,data:`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="`+s[n].width+'" height="'+s[n].height+'"></svg>'});return this.wrapper.render(e,{format:h,engine:u,files:o,images:s,yInvert:m,nop:f})}},{key:"renderSVGElement",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.renderString(e,t({},n,{format:"svg"})).then(function(e){var t=new DOMParser;return t.parseFromString(e,"image/svg+xml").documentElement})}},{key:"renderImageElement",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=n.scale,o=n.mimeType,i=n.quality;return this.renderString(e,t({},n,{format:"svg"})).then(function(e){return(typeof fabric=="undefined"?"undefined":r(fabric))==="object"&&fabric.loadSVGFromString?d(e,{scale:s,mimeType:o,quality:i}):l(e,{scale:s,mimeType:o,quality:i})})}},{key:"renderJSONObject",value:function(e){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=s.format;return(n!=="json"||n!=="json0")&&(n="json"),this.renderString(e,t({},s,{format:n})).then(function(e){return JSON.parse(e)})}}]),n}(),n})